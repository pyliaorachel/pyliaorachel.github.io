<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>MyCoon</title>
    <description>Homepage of pyliaorachel. Blog posts about web &amp; mobile app development, python, IoT, and more.
</description>
    <link>/</link>
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Tue, 15 Sep 2020 01:12:38 -0700</pubDate>
    <lastBuildDate>Tue, 15 Sep 2020 01:12:38 -0700</lastBuildDate>
    <generator>Jekyll v3.2.1</generator>
    
      <item>
        <title>Knock Knock! Deep Learning / Day 0 / å°è®€</title>
        <description>&lt;p&gt;æœ¬ç³»åˆ—æ–‡ã€ŠKnock Knock! Deep Learningã€‹æ—¨åœ¨ä»¥æ·ºé¡¯æ˜“æ‡‚çš„æ–‡å­—ï¼ŒåµŒå…¥æ·±åº¦å­¸ç¿’çš„æ¦‚å¿µèˆ‡è‡ªèº«åœ¨å²ä¸¹ä½›å¤§å­¸ä¿®è®€ç¢©å£«æœŸé–“çš„å­¸ç¿’å¿ƒå¾—ï¼ŒèåˆçŸ¥è­˜èˆ‡æ•…äº‹æ€§ï¼Œæˆç‚ºç„¡è«–ä½•æ™‚ä½•åœ°éƒ½ä¸åæ–¼é»é–‹çš„æŠ€è¡“åˆ†äº«æ–‡ã€‚&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;h2&gt;ä»€éº¼æ˜¯æ·±åº¦å­¸ç¿’ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;æ·±åº¦å­¸ç¿’ï¼ˆDeep Learningï¼‰ç‚ºæ©Ÿå™¨å­¸ç¿’ï¼ˆMachine Learningï¼‰çš„ä¸€ç¨®æ–¹æ³•ï¼Œåœ¨ AI ç•Œé¢¨è¡Œå¤šå¹´ï¼Œæ”¯æ’äº†ç„¡æ•¸çŸ¥åå°ˆæ¡ˆï¼Œå¦‚ Google çš„æ©Ÿå™¨ç¿»è­¯åŠæ“Šæ•—å„è·¯é ‚å°–æ£‹æ‰‹çš„åœæ£‹ AI AlphaGoã€‚å‰©ä¸‹çš„è‡ªå·±è®€ç³»åˆ—æ–‡ã€‚&lt;/p&gt;

&lt;h2&gt;é‚£éº¼æœƒæ¢è¨å“ªäº›æŠ€è¡“ï¼Ÿæ˜¯å¦æœƒä¸å¤ æ‰å¯¦ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;æœ¬ç³»åˆ—æ–‡æœƒåˆ†ç‚ºä»¥ä¸‹å¹¾å€‹éƒ¨åˆ†ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Deep Learning ç°¡ä»‹&lt;/li&gt;
&lt;li&gt;å¿…å‚™å¯¦ä½œçŸ¥è­˜èˆ‡å·¥å…·&lt;/li&gt;
&lt;li&gt;PyTorch ç°¡ä»‹&lt;/li&gt;
&lt;li&gt;DL x NLPï¼ˆè‡ªç„¶èªè¨€è™•ç†ï¼‰&lt;/li&gt;
&lt;li&gt;DL x CVï¼ˆæ©Ÿå™¨è¦–è¦ºï¼‰&lt;/li&gt;
&lt;li&gt;DL x RLï¼ˆå¼·åŒ–å­¸ç¿’ï¼‰&lt;/li&gt;
&lt;li&gt;DL çš„è³‡æºç«¶çˆ­&lt;/li&gt;
&lt;li&gt;çµèªèˆ‡å­¸ç¿’è³‡æº&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å‰æœŸåæ¦‚å¿µå’Œå¯¦ä½œå…¥é–€ï¼Œæ˜¯æ‰å¥½åŸºæœ¬åŠŸå¿…é ˆï¼Œæ•…äº‹æ€§è¼ƒå°‘ï¼›å¾ŒæœŸåæ‡‰ç”¨ï¼Œæœ‰è¨±å¤šå¯¦ä¾‹èˆ‡æ•…äº‹åˆ†äº«ã€‚&lt;/p&gt;

&lt;p&gt;è«–æ‰å¯¦æ€§ï¼Œå¿…ç„¶æ˜¯é é ä¸åŠå¤§å¸«æ’°å¯«çš„æ›¸åŠæ•™æˆçš„èª²ã€‚ä½†å¦‚æœç›®æ¨™æ˜¯é€™èˆ¬æ‰å¯¦ï¼Œå»ºè­°ç›´æ¥å»å¤©ç“æ‰¾æ›¸ï¼Œæˆ–æ˜¯ Coursera ä¿®èª²å§ã€‚ã€ŠKnock Knock! Deep Learningã€‹çš„æŠ€è¡“å…§å®¹æœƒåƒè€ƒå²ä¸¹ä½›å¤§å­¸ç›¸é—œèª²ç¨‹çš„èª²ç¶±åŠç­†è¨˜ã€å­¸è¡“ç•Œç™¼è¡¨çš„ paperã€çŸ¥ååŠå€‹äººçš„ project ç¶“é©—ä¾†é€²è¡Œåˆ†äº«ï¼Œè®€å®Œå¾Œæ‡‰èƒ½æŒæ¡æ·±åº¦å­¸ç¿’ç™¼å±•çš„æ¦‚è²Œï¼Œä¹Ÿèƒ½å°å¯¦éš›é–‹ç™¼è‡ªå·±çš„æ·±åº¦å­¸ç¿’ project æœ‰å¯¦ä½œä¸Šçš„æ¦‚å¿µã€‚&lt;/p&gt;

&lt;h2&gt;æ·±åº¦å­¸ç¿’çš„æŠ€è¡“æ–‡é€™éº¼å¤šï¼Œç‚ºä»€éº¼è¦çœ‹é€™å€‹ç³»åˆ—ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;ç¶²è·¯ä¸Šæ·±åº¦å­¸ç¿’ç›¸é—œçš„æŠ€è¡“æ–‡å¾ˆå¤šï¼Œä½†å¤šåŠé›¶æ•£ç„¡é€£è²«æ€§ï¼Œé©åˆå‰›å¥½éœ€è¦è£œè¶³æŸå€‹çŸ¥è­˜ç¢ç‰‡çš„å­¸ç¿’è€…é–±è®€ã€‚è‡³æ–¼æ·±åº¦å­¸ç¿’ç›¸é—œçš„æ›¸ä¹Ÿå¾ˆå¤šï¼Œä½†å…§å®¹å®Œæ•´çš„å¤šåŠç”±å¤§å¸«ç´šäººç‰©æ’°å¯«ï¼Œé›–ç„¶å…§å®¹åš´è¬¹ä¸”å¸¶æœ‰æ·±åº¦ï¼Œä½†çŸ¥è­˜é‡éæ–¼é¾å¤§çš„æƒ…æ³ä¸‹ï¼Œåˆ°ä¸­æœŸé›£å…ç–²æ–¼æŒæ¡å­¸ç¿’é‡é»ã€‚&lt;/p&gt;

&lt;p&gt;ã€ŠKnock Knock! Deep Learningã€‹çš„å–å‘è¼ƒç‚ºä¸åŒï¼Œåˆ†äº«çš„çŸ¥è­˜é›£ä»¥å‘å¤§å¸«ç´šæ•™ç§‘æ›¸ä¸¦é§•é½Šé©…ï¼Œä½†ä»¥å­¸ç”Ÿçš„è§’åº¦å‡ºç™¼æ’°å¯«ï¼Œå°‡å…§å®¹ç²¾ç°¡è‡³å¿…å‚™çŸ¥è­˜ï¼Œå› æ­¤ä½œç‚ºæ¦‚å¿µæ€§å…¥é–€å ªç¨±æœ‰åŠ›ï¼›æ–‡ä¸­æœƒå¸¶å…¥è¨±å¤šæ•…äº‹æ€§çš„æ•˜è¿°ï¼Œå«æ‹¬ç­†è€…åœ¨å²ä¸¹ä½›å¤§å­¸ä¿®è®€ç¢©å£«æ™‚æœŸçš„ä¸€äº›å­¸ç¿’å¿ƒå¾—ï¼Œä»¥åŠæ·±åº¦å­¸ç¿’ç™¼å±•ç›¸é—œçš„æ•…äº‹ã€‚æ˜¯å€‹å¯ä»¥ç”¨é–±è®€æ•…äº‹çš„æœŸå¾…æ‰“é–‹ï¼Œä¸¦å¸¶è‘—å°æ·±åº¦å­¸ç¿’æŠ€è¡“çš„æ¦‚å¿µç†è§£é—”ä¸Šçš„ç³»åˆ—æ–‡ã€‚&lt;/p&gt;

&lt;h2&gt;éœ€è¦å“ªäº›é å‚™çŸ¥è­˜&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Python æˆ–å…¶ä»–ç¨‹å¼èªè¨€æ¦‚å¿µ

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/numpy/numpy&quot;&gt;Numpy&lt;/a&gt;ï¼Œä¸€å€‹æ–¹ä¾¿é€²è¡Œå‘é‡ / çŸ©é™£é‹ç®—çš„ library&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Linear Algebraï¼ˆç·šæ€§ä»£æ•¸ï¼‰

&lt;ul&gt;
&lt;li&gt;åŸºæœ¬çŸ©é™£é‹ç®—&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Calculusï¼ˆå¾®ç©åˆ†ï¼‰

&lt;ul&gt;
&lt;li&gt;å¾®åˆ†çŸ¥è­˜æ¯”è¼ƒé‡è¦ï¼ŒçŸ¥é“ $\frac{d}{dx}f(x)$ çš„æ„ç¾©&lt;/li&gt;
&lt;li&gt;ç‰¹åˆ¥æ˜¯ Matrix Calculusï¼ˆçŸ©é™£å¾®ç©åˆ†ï¼‰ï¼Œä½†é€™å¯ä»¥é‚Šè®€é‚Šå­¸&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Probabilityï¼ˆæ©Ÿç‡ï¼‰

&lt;ul&gt;
&lt;li&gt;æ¢ä»¶æ©Ÿç‡è·Ÿè²æ°å®šç†è¼ƒç‚ºé‡è¦ï¼Œä¹Ÿå¯ä»¥é‚Šè®€é‚Šå­¸&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸éœ€è¦ç‰¹åœ°å»é‡ä¸Šä¸€å ‚èª²ï¼Œå¯ä»¥æ‰¾äº›ç°¡å–®çš„æ•™å­¸å½±ç‰‡æˆ–æ–‡ç« è¤‡ç¿’ä¸€ä¸‹å°±å¥½ã€‚æœ‰ç›´è¦ºå°±èƒ½è®€ä¸‹å»ï¼&lt;/p&gt;

&lt;p&gt;é€™é‚Šæœ‰ä¸€äº›æ¯”è¼ƒå®Œæ•´çš„è‹±æ–‡ç­†è¨˜ï¼Œå¯ä»¥äº‹å…ˆé–±è®€ï¼Œæˆ–æ˜¯è®€åˆ°ä¸€åŠè¦ºå¾—ä¸è¡Œäº†éœ€è¦é‡æ¸…æ¦‚å¿µï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Numpy

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://cs231n.github.io/python-numpy-tutorial/&quot;&gt;Python Numpy Tutorial (with Jupyter and Colab)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Calculus

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://web.stanford.edu/class/cs224n/readings/review-differential-calculus.pdf&quot;&gt;Review of differential calculus theory&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Linear Algebra &amp;amp; Matrix Calculus

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://cs229.stanford.edu/summer2020/cs229-linalg.pdf&quot;&gt;Linear Algebra Review and Reference&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Matrix calculus in Deep Learning

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://cs231n.stanford.edu/handouts/derivatives.pdf&quot;&gt;Derivatives, Backpropagation, and Vectorization&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://web.stanford.edu/class/cs224n/readings/gradient-notes.pdf&quot;&gt;Computing Neural Network Gradients&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://cs229.stanford.edu/summer2020/cs229-prob.pdf&quot;&gt;Review of Probability Theory&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;é‚„æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„å—ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;æ–‡ç« çš„æ¶æ§‹å¤§è‡´ç‚ºå¼•è¨€ã€ä¸»å…§å®¹ã€Checkpointã€åƒè€ƒè³‡æ–™ã€å»¶ä¼¸é–±è®€ï¼Œå¾Œä¸‰è€…å¯æœ‰å¯ç„¡ã€‚æ­¡è¿åˆ©ç”¨ Checkpoint ä¾†è‡ªæˆ‘æª¢é©—æ˜¯å¦ç†è§£æ–‡ä¸­çš„å…§å®¹äº†ï¼Œåƒè€ƒè³‡æ–™æ·±å…¥æ¢ç©¶ä¸æ‡‚çš„åœ°æ–¹ï¼Œä»¥åŠå»¶ä¼¸é–±è®€ä¾†æ‹“å±•çŸ¥è­˜ã€‚&lt;/p&gt;

&lt;p&gt;åƒè€ƒè³‡æ–™å’Œå»¶ä¼¸é–±è®€ï¼Œå¯«å¾—çœŸçš„å¾ˆæ£’çš„è³‡æ–™ï¼Œå‰é¢æœƒåŠ  ğŸ‘ï¼Œæœ‰èˆˆè¶£çš„äººå¯ä»¥é»é€£çµé–±è®€ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œæ–‡ä¸­çš„éƒ¨åˆ†å°ˆæ¥­åè©æœƒç”¨ Englishï¼Œå°±ä¸ç¿»æˆä¸­æ–‡äº†ã€‚æœ‰äº›ç¿»æˆä¸­æ–‡å¾ˆå½†æ‰­çš„è©æˆ‘ä¹Ÿæœƒç”¨è‹±æ–‡ï¼Œä¸Šé¢æœ‰ç¤ºç¯„ paper å’Œ projectã€‚åæ­£ä½ å€‘ä»¥å¾ŒæŸ¥è³‡æ–™ä¹Ÿæ‡‰è©²è¦ç”¨è‹±æ–‡ï¼Œä½•å¿…æµªè²»æ™‚é–“å†ç¿»è­¯ä¸€æ¬¡ã€‚&lt;/p&gt;

&lt;h2&gt;Code é€£çµ&lt;/h2&gt;

&lt;p&gt;åŸå§‹ç¢¼éƒ½æ”¾åœ¨ GitHubï¼š&lt;a href=&quot;https://github.com/pyliaorachel/knock-knock-deep-learning&quot;&gt;pyliaorachel/knock-knock-deep-learning&lt;/a&gt;ã€‚&lt;/p&gt;
</description>
        <pubDate>Tue, 15 Sep 2020 00:00:00 -0700</pubDate>
        <link>/blog/tech/ai/2020/09/15/day0-preread.html</link>
        <guid isPermaLink="true">/blog/tech/ai/2020/09/15/day0-preread.html</guid>
        
        <category>AI</category>
        
        <category>Deep Learning</category>
        
        <category>Knock Knock! Deep Learning</category>
        
        
        <category>Blog</category>
        
        <category>Tech</category>
        
        <category>AI</category>
        
      </item>
    
      <item>
        <title>ç”¨ Python ç©ç¡¬é«”ï¼šMicroPython ç°¡ä»‹èˆ‡å¯¦ä½œ</title>
        <description>&lt;p&gt;èªªåˆ°åµŒå…¥å¼ç³»çµ±ã€ç‰©è¯ç¶²ç­‰ç­‰ç¡¬é«”ï¼Œå¾ˆå¤šé  Python åƒé£¯çš„ PyBoys PyGirls å¯èƒ½è¦èˆ‰é›™æ‰‹æŠ•é™ï¼Œå› ç‚ºæ§åˆ¶é€™äº›åº•å±¤å¤§å¤šéœ€è¦é  C èªè¨€ã€‚ä½†æ™‚ä»£ä¸åŒäº†ï¼ŒMicroPython å¹¾å¹´å‰çš„æ¨å‡ºè®“ç”¨ Python æ§åˆ¶ç¡¬é«”ä¸æ˜¯å¤¢ã€‚æœ¬æ–‡å°‡æœƒç°¡ä»‹ MicroPython çš„æ‡‰ç”¨ï¼Œä¸¦ä»¥è¼‰æœ‰ ESP8266 Wi-Fi æ¨¡çµ„çš„ NodeMCU é€²è¡Œç°¡å–®è³‡æ–™å‚³è¼¸å¯¦ä½œã€‚é™¤äº† MicroPythonï¼Œç¡¬é«”æ–°æ‰‹å€‘ä¸å¦¨ä¹Ÿè—‰æ­¤ä¾†èªè­˜ä¸€ä¸‹ç‰©è¯ç¶²çš„ä¸–ç•Œã€‚&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;h2&gt;MicroPython ç°¡ä»‹&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/micropython/micropython&quot;&gt;MicroPython&lt;/a&gt; æ˜¯ 2013 å¹´åœ¨ Kickstarter ä¸Šå‹Ÿè³‡é–‹å§‹å»ºç«‹çš„ï¼Œé¡§åæ€ç¾©å°±æ˜¯å› ç‚ºå°å‹ç¡¬é«”è³‡æºæœ‰é™ï¼Œè€Œå°‡ Python æ¿ƒç¸®æˆä¸€æ¬¾å°å‹åŒ…ï¼Œè¼‰å…¥ç¡¬é«”å¾®æ§åˆ¶å™¨çš„ä¸€é …é–‹æºå°ˆæ¡ˆï¼Œç›®å‰å·²ç¶“èƒ½ç§»æ¤æ–¼ Arduino å’Œ ESP8266 ç­‰æ¿å­ï¼Œäº¦æœ‰è‡ªå·±å°ˆå±¬çš„é–‹ç™¼æ¿ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ MicroPython è¦æ€éº¼å¯«å‘¢ï¼Ÿå°ï¼Œå°±è·Ÿ Python ä¸€æ¨¡ä¸€æ¨£ã€‚MicroPython é™¤äº†ç•™æœ‰ Python çš„è¨±å¤šè¿·ä½ åŒ–çš„æ¨™æº–å‡½å¼åº«ï¼Œä¹Ÿæœ‰ä¾‹å¦‚ &lt;code&gt;machine&lt;/code&gt;ã€&lt;code&gt;network&lt;/code&gt; ç­‰ç¡¬é«”ç›¸é—œçš„å°ˆå±¬å‡½å¼åº«æ§åˆ¶ç¡¬é«”ç›¸é—œåŠŸèƒ½ã€‚è©³ç´°å¯åƒè€ƒ&lt;a href=&quot;https://docs.micropython.org/en/latest/esp8266/library/index.html#python-standard-libraries-and-micro-libraries&quot;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è½èµ·ä¾†çœŸæ–¹ä¾¿ï¼Œé‚£å°±ç›´æ¥ä¾†å¯¦ä½œå§ï¼&lt;/p&gt;

&lt;h2&gt;å¯¦ä½œ&lt;/h2&gt;

&lt;p&gt;é€™æ¬¡ç­†è€…çœ‹çœ‹æ‰‹ä¸Šçš„è³‡æºï¼Œé¸æ“‡ä¸å¤šï¼ŒæŒ‘äº†èƒ½è¼‰å…¥ MicroPython ä¸”æœ‰ Wi-Fi åŠŸèƒ½çš„ NodeMCU é–‹ç™¼å¥—ä»¶é€²è¡Œå° demoï¼Œä»»å‹™æ˜¯æŠŠï¼ˆå‡è£æœ‰çš„ï¼‰sensor æ”¶é›†åˆ°çš„ data é€éç¶²è·¯ä¸Šå‚³åˆ°è‡ªå·±å»ºç«‹çš„ APIã€‚å¦‚æœæ‰‹é‚Šå‰›å¥½ä¹Ÿæœ‰ï¼Œæˆ–æ˜¯æœ‰åœ¨åœ°ä¸Šæ’¿åˆ°é€™å¡Šæ¿å­ï¼Œå°±ä¸€èµ·è©¦è©¦å§ï¼Œä¸ç„¶ç­†è€…æ˜¯ä¸æ˜¯åœ¨å”¬çˆ›ä¹Ÿå¾ˆé›£çŸ¥é“ã€‚&lt;/p&gt;

&lt;p&gt;GitHub åŸå§‹ç¢¼ï¼š&lt;a href=&quot;https://github.com/pyliaorachel/esp8266-micropython&quot;&gt;https://github.com/pyliaorachel/esp8266-micropython&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;NodeMCU èˆ‡ ESP8266&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;https://5.imimg.com/data5/YK/YF/MY-25117786/nodemcu-esp8266-12e-wi-fi-module-500x500.png&quot; alt=&quot;NodeMCU&quot;&gt;&lt;/p&gt;

&lt;p&gt;è·Ÿå°ç‰©è¯ç¶²ä¸ç†Ÿæ‚‰çš„æœ‹å‹ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ã€‚ESP8266 å°±æ˜¯ç›¸ç‰‡å·¦é‚Šçªå‡ºçš„é‚£ä¸€å°å¡Šï¼Œå‚™æœ‰ Wi-Fi åŠŸèƒ½ï¼Œæœ¬èº«ä¹Ÿæ˜¯é›†æœ‰ GPIO ï¼ˆGeneral-Purpose I/Oï¼‰ã€serial è…³ä½ (TX / RX) ç­‰æ¥å£çš„æ§åˆ¶æ¿ã€‚GPIO å¯ä»¥æ¥æ”¶/å‚³è¼¸ binary dataï¼Œä¹Ÿå°±æ˜¯ 1 ï¼ˆé«˜é›»ä½ï¼‰æˆ– 0 ï¼ˆä½é›»ä½ï¼‰ï¼Œæˆ–æ˜¯è·Ÿ ADC ï¼ˆAnalog-to-Digital Converterï¼‰é€£æ¥ä»¥æ¥æ”¶é¡æ¯”è¨Šè™Ÿï¼Œæˆ–ä»¥ PWMï¼ˆPulse Width Modulationï¼‰ æ¨¡æ“¬é¡æ¯”è¨Šè™Ÿé€²è¡Œå‚³è¼¸ã€‚åœ¨ç‰©è¯ç¶²çš„ä¸–ç•Œè£¡ï¼Œ GPIO ä¸»è¦ç”¨ä¾†é€£æ¥å…¶ä»– sensor æ”¶é›†è³‡æ–™ï¼Œä¾‹å¦‚æº«åº¦ã€å…‰ç·šç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;ESP8266 æœ€åŸæ±åŸå‘³çš„ç‰ˆæœ¬ï¼ˆESP-01ï¼‰éå¸¸æœ‰æ„æ€ï¼Œä¸Šå‚³ä¸€ä»½ code è¦å„ç¨®è…³ä½äº¤äº’æ¥åœ°ï¼ŒGPIO åªæœ‰å…©å€‹æˆä¸äº†å¤§äº‹ç­‰ç­‰ï¼Œå¯ä»¥åƒè€ƒæˆ‘ä¹‹å‰çš„&lt;a href=&quot;https://pyliaorachel.github.io/tutorial/hardware/arduino/2017/04/13/esp8266-with-arduino-trials-and-errors.html&quot;&gt;è¡€æ·šç¶“é©—&lt;/a&gt;ï¼ˆç°¡çŸ­ç‰ˆï¼šçæƒœç”Ÿå‘½ï¼Œé é›¢ ESP-01ï¼‰ã€‚é€™å¡Š NodeMCU ååˆ†äº†è§£ä½ çš„ä¸ä¾¿ï¼Œå› æ­¤å¹«å¿™å°è£äº†ä¸€ç•ªï¼Œé™¤äº†æ¡ç”¨å…·æœ‰å¤šå€‹ GPIO çš„ ESP-12 ç‰ˆæœ¬ï¼Œé‚„é€£æ¥äº† micro USB è½‰æ¥å™¨ï¼Œè®“ä½ ç›´æ¥ç”¨ micro USB å‚³è¼¸ç·šå’Œé›»è…¦æºé€šï¼Œé¡ä¼¼æ–¼æœ‰ Wi-Fi çš„ Arduino é–‹ç™¼æ¿ã€‚å…§éƒ¨è¼‰æœ‰ NodeMCU éŸŒé«”ï¼Œå¯ä»¥ç”¨ Lua æ’°å¯«ç¨‹å¼æ§åˆ¶ç¡¬é«”ã€‚&lt;/p&gt;

&lt;p&gt;è€Œæ¥ä¸‹ä¾†æˆ‘å€‘è¦åšçš„å°±æ˜¯é‡æ–°ç‡’éŒ„ MicroPython éŸŒé«”ï¼Œä¾¿èƒ½é–‹å§‹ç”¨ Python æ§åˆ¶é€™å¡Šæ¿å­å•¦ã€‚&lt;/p&gt;

&lt;h3&gt;ç¡¬é«”è¨­ç½®&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.micropython.org/en/latest/esp8266/esp8266/tutorial/intro.html&quot;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;æœ‰å®Œæ•´æ•™å­¸ï¼Œæˆ‘ GitHub repo è£¡çš„ &lt;a href=&quot;https://github.com/pyliaorachel/esp8266-micropython&quot;&gt;README&lt;/a&gt; ä¹Ÿæœ‰ç°¡æ½”çš„æ­¥é©Ÿï¼Œé€™é‚Šç°¡å–®è¬›è§£ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;å®‰è£å·¥å…·

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;$pip install esptool&lt;/code&gt;ï¼Œç”¨ä¾†è·Ÿ ESP æ™¶ç‰‡æºé€š&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$pip install adafruit-ampy&lt;/code&gt;ï¼Œç”¨ä¾†å’Œæ¿å­é€²è¡Œå‚³è¼¸&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;ç‡’éŒ„éŸŒé«”

&lt;ol&gt;
&lt;li&gt;NodeMCU ç”¨ micro USB to USB ç·šæ¥åˆ°é›»è…¦&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹æ˜¯å“ªå€‹ USB portï¼ŒMac çš„è©±å¯ä»¥ç”¨ &lt;code&gt;$ ls /dev/tty.*&lt;/code&gt; æ‰¾ï¼Œå…¶ä»–è‡ªå·± google ï¼ˆè·©ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://micropython.org/download#esp8266&quot;&gt;ä¸‹è¼‰éŸŒé«”&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ç‡’æ¯€ï¼å¥½å•¦ç‡’éŒ„ï¼š&lt;code&gt;$ esptool.py --port &amp;lt;port-name&amp;gt; write_flash --flash_size=detect 0 &amp;lt;firmware-file&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3&gt;Data å‚³é€&lt;/h3&gt;

&lt;p&gt;æˆ‘å€‘çš„ä»»å‹™æ˜¯ï¼Œå‡è£æœ‰ä¸€å€‹ temperature sensorï¼Œæ¯ 10 ç§’æ”¶é›†ä¸€æ¬¡ dataï¼Œä¸¦å‚³åˆ° Firebase çš„ APIï¼Œå‚³å®Œæ™‚ LED é–ƒä¸€ä¸‹å‘ŠçŸ¥ã€‚é€™å€‹ API ç•¶ç„¶ä¸ç”¨æ˜¯ Firebase çš„ï¼Œå¯ä»¥è‡ªå·±å¦å»ºã€‚æˆ‘æŠŠå»ºç½® Firebase API çš„æ­¥é©Ÿå¯«åœ¨é™„éŒ„è£¡ä¾›æ–°æ‰‹åƒè€ƒã€‚&lt;/p&gt;

&lt;h4&gt;æ’°å¯«ä¸»ç¨‹å¼&lt;/h4&gt;

&lt;p&gt;MicroPython ä¸»è¦åµæ¸¬å…©å€‹æª”æ¡ˆã€‚ä¸€æ˜¯ &lt;code&gt;boot.py&lt;/code&gt;ï¼Œé–‹æ©Ÿæ™‚åŸ·è¡Œï¼Œå¯ä»¥åœ¨æ­¤åŸ·è¡Œä¸€äº›ç³»çµ±è¨­å®šï¼Œé€™è£æˆ‘æ²’æœ‰å¦å¤–åŠ æ±è¥¿ï¼Œå°±æ˜¯åŸæœ¬é è¨­çš„ codeã€‚äºŒæ˜¯ &lt;code&gt;main.py&lt;/code&gt;ï¼Œè·‘å®Œ &lt;code&gt;boot.py&lt;/code&gt; å°±ä¾†è·‘å®ƒï¼Œæ‰€ä»¥é€šå¸¸è£¡é¢æ˜¯ç„¡é™è¿´åœˆã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–é‚„æœ‰ä¸€å€‹è‡ªå·±åŠ çš„ &lt;code&gt;config.py&lt;/code&gt; æ”¾ä¸€äº›å®¢è£½åŒ–çš„è¨­å®šï¼Œå¦‚ç¶²è·¯ SSIDã€å¯†ç¢¼ã€å’Œ API URLã€‚GitHub ä¸Šæœ‰ä¸€å€‹ &lt;code&gt;config.py.template&lt;/code&gt; ä¾›åƒè€ƒï¼Œå› ç‚ºæˆ‘ä¸èƒ½è®“ä½ é€£æˆ‘å®¶ Wi-Fi æˆ– call çˆ†æˆ‘çš„ APIã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†ç¨‹å¼æœ‰å››å€‹éƒ¨åˆ†ï¼š&lt;/p&gt;

&lt;h6&gt;1. é€£æ¥ç¶²è·¯&lt;/h6&gt;

&lt;p&gt;ç¶²è·¯éƒ¨åˆ†ç”± &lt;code&gt;network&lt;/code&gt; module è² è²¬ã€‚æˆ‘å€‘å®šç¾©ä¸€å€‹ &lt;code&gt;do_connect&lt;/code&gt; è² è²¬é€£æ¥ç¶²è·¯ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;network&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;config&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;do_connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# è¨­ç½®æˆ station mode ä»¥é€£æ¥å¤–éƒ¨ç¶²è·¯ &lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sta_if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WLAN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;STA_IF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sta_if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isconnected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Connecting to network...'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sta_if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;active&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sta_if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SSID&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PASSWORD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# ç­‰ä¸€ä¸‹å®ƒé€£æ¥&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sta_if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isconnected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Network connected!'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6&gt;2. æ”¶é›† dataï¼Œä¸Šå‚³ API&lt;/h6&gt;

&lt;p&gt;å› ç‚ºæ‰‹é‚Šæ²’æœ‰çœŸçš„ sensorï¼Œé€™é‚Šç›´æ¥ hard code ä¸€å€‹å€¼ï¼Œå¯æ›¿æ›æˆå¾çœŸçš„ sensor è®€å€¼ã€‚
ä¸Šå‚³éƒ¨åˆ†ç”¨ &lt;code&gt;urequests&lt;/code&gt; moduleï¼Œä¹Ÿå°±æ˜¯ä¸€èˆ¬è¦‹åˆ°çš„ &lt;code&gt;requests&lt;/code&gt; module çš„è¿·ä½ ç‰ˆã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;urequests&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'temperature'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;25.6&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Sending data...'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;urequests&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;URL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Response: {}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;flash_led&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# Step 3&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6&gt;3. æ·»åŠ  LED æç¤ºç‡ˆ&lt;/h6&gt;

&lt;p&gt;æœ€å¾Œä¸Šå‚³å®Œæˆçš„æ™‚å€™ï¼Œå¸Œæœ› LED ç‡ˆèƒ½é–ƒä¸€ä¸‹å‘ŠçŸ¥ã€‚ç¡¬é«”æ§åˆ¶éƒ¨åˆ†ç”± &lt;code&gt;machine&lt;/code&gt; module è² è²¬ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;machine&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;time&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;flash_led&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;led&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;machine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;machine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# LED åœ¨ pin 2ï¼Œè¨­ç‚ºè¼¸å‡º&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;led&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# é€™é‚Šè¨­ç‚º 0ï¼ˆä½ä½ï¼‰å…¶å¯¦æ˜¯ onï¼Œ1ï¼ˆé«˜ä½ï¼‰æ˜¯ offï¼Œä½†åœ¨å…¶ä»–æ¿å­ä¸Šå¯èƒ½æœƒç›¸å&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# äº® 0.5 ç§’&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;led&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6&gt;4. çµ„åˆ&lt;/h6&gt;

&lt;p&gt;ä¸»è¦æ˜¯ä¸€å€‹ç„¡çª®è¿´åœˆï¼Œæ¯ 10 ç§’å‚³ä¸€æ¬¡ dataï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;do_connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;send_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœ€å¾Œæ”¾å€‹ &lt;code&gt;main()&lt;/code&gt; äº’å«ä¸»å‡½å¼å°±è¡Œå›‰ï¼&lt;/p&gt;

&lt;h5&gt;ä¸Šå‚³ç¨‹å¼ &amp;amp; æ¸¬è©¦&lt;/h5&gt;

&lt;p&gt;ä¸Šé¢çš„ç¨‹å¼éƒ½æ˜¯å…ˆåœ¨ local ç«¯æ’°å¯«ï¼Œå¯«å®Œå†ä¸Šå‚³æ¸¬è©¦ã€‚ä¸Šå‚³ç¨‹å¼åˆ°æ¿ä¸Šéœ€è¦ç”¨åˆ°ä¸€äº›å·¥å…·ï¼Œé€™é‚Šé¸ç”¨å‰›å‰›è£å¥½çš„ &lt;code&gt;ampy&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†å¹¾å€‹æ­¥é©Ÿä¸Šå‚³ä¸¦æ¸¬è©¦ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;ä¸Šå‚³ç¨‹å¼ï¼š&lt;code&gt;$ ampy --port &amp;lt;port-name&amp;gt; put boot.py main.py config.py&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æŒ‰ä½æ¿ä¸Šçš„ reset éˆ•ï¼Œæ”¾é–‹æ™‚ LED æœƒé–ƒä¸€ä¸‹ï¼Œæ¥è‘—å®ƒå°±æœƒé‡æ–°é–‹å§‹è·‘æ–°çš„ç¨‹å¼&lt;/li&gt;
&lt;li&gt;çœ‹çœ‹ LED æœ‰æ²’æœ‰é–ƒï¼Œçœ‹çœ‹ API æœ‰æ²’æœ‰æ”¶åˆ° data&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;æ”¶åˆ°çš„è©± Firebase æœƒé•·é€™æ¨£ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pyliaorachel/esp8266-micropython/blob/master/imgs/firebase.png?raw=true&quot; alt=&quot;Firebase console&quot;&gt;&lt;/p&gt;

&lt;p&gt;å°±æˆåŠŸäº†ï¼&lt;/p&gt;

&lt;h2&gt;çµèª&lt;/h2&gt;

&lt;p&gt;MicroPython çš„å‡ºç¾è®“è¨±å¤šç•æ‡¼ä½éšèªè¨€çš„é–‹ç™¼è€…æœ‰æ©Ÿæœƒä»¥é«˜éšèªè¨€ç©ç©ç¡¬é«”ç«¯ï¼Œä¹Ÿèƒ½åŠ å¿«åŸæœ¬ç‰©è¯ç¶²é–‹ç™¼è€…çš„é–‹ç™¼é€Ÿåº¦ã€‚ä½†ç›®å‰ MicroPython åŒ…å«çš„å‡½å¼åº«é‚„ååˆ†æœ‰é™ï¼Œæœ‰æ™‚å€™ä¸èƒ½åšå¤ªè¤‡é›œçš„å°ˆæ¡ˆï¼Œä¾‹å¦‚ email å‚³è¼¸å› ç‚ºæ²’æœ‰ &lt;code&gt;imaplib&lt;/code&gt; æˆ– &lt;code&gt;smtplib&lt;/code&gt; è€Œè®Šå¾—å›°é›£ã€‚æœŸå¾…æœªä¾†èƒ½æœ‰æ›´å¤šå¥—ä»¶æ”¯æ´ä»¥åˆ©æ›´å¤šæœ‰è¶£å°ˆæ¡ˆçš„å¯¦ç¾ï¼ŒåŒæ™‚äº¦ä¸å¤±è‡ªèº«ç²¾å·§çš„ç‰¹è³ªã€‚&lt;/p&gt;

&lt;h2&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.micropython.org/en/latest/esp8266/index.html&quot;&gt;MicroPython å®˜æ–¹æ–‡ä»¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.handsontec.com/pdf_learn/esp8266-V10.pdf&quot;&gt;NodeMCU ä½¿ç”¨æ‰‹å†Š&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://yhhuang1966.blogspot.com/2017/04/esp-01-esp8266-micropython.html&quot;&gt;MicroPython on ESP8266 -- å°ç‹ç‹¸äº‹å‹™æ‰€&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;é™„éŒ„ï¼šFirebase API å»ºç«‹&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;å» &lt;a href=&quot;https://firebase.google.com/&quot;&gt;Firebase å®˜ç¶²&lt;/a&gt; å»ºç«‹å¸³è™Ÿ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;GO TO CONSOLE &amp;gt; æ–°å¢å°ˆæ¡ˆ&lt;/code&gt;ï¼Œè¼¸å…¥å°ˆæ¡ˆåç¨±ä¸¦å»ºç«‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;é–‹ç™¼ -&amp;gt; Database -&amp;gt; Realtime Database å»ºç«‹è³‡æ–™åº« -&amp;gt; ä»¥æ¸¬è©¦æ¨¡å¼å•Ÿå‹•&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;https://&amp;lt;project-name&amp;gt;.firebaseio.com/&lt;/code&gt; å³ç‚º API ç¶²å€&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Tue, 24 Jul 2018 00:00:00 -0700</pubDate>
        <link>/blog/tech/python/2018/07/24/micropython-on-esp8266.html</link>
        <guid isPermaLink="true">/blog/tech/python/2018/07/24/micropython-on-esp8266.html</guid>
        
        <category>Python</category>
        
        <category>PyLadies</category>
        
        <category>MicroPython</category>
        
        <category>esp8266</category>
        
        
        <category>Blog</category>
        
        <category>Tech</category>
        
        <category>Python</category>
        
      </item>
    
      <item>
        <title>Reinforcement Learning é€²éšç¯‡ï¼šDeep Q-Learning</title>
        <description>&lt;p&gt;ç¹¼ä¸Šä¸€ç¯‡&lt;a href=&quot;https://pyliaorachel.github.io/blog/tech/python/2018/06/01/openai-gym-for-reinforcement-learning.html&quot;&gt;Reinforcement Learning å¥èº«æˆ¿ï¼šOpenAI Gym&lt;/a&gt; ä»‹ç´¹ä»¥ Q-table ç‚ºåŸºç¤çš„ Q-learning ä¹‹å¾Œï¼Œé€™ä¸€ç¯‡è¦ä¾†çµåˆ PyTorch å¯¦ç¾ä»¥æ·±åº¦å­¸ç¿’ç‚ºåŸºç¤çš„ Deep Q-Learningã€‚&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;p&gt;&lt;em&gt;* è«‹æ³¨æ„ï¼Œä»¥ä¸‹åªé‡å°Python3é€²è¡Œè¬›è§£èˆ‡æ¸¬è©¦ï¼Œä¸¦ä»¥ MacOSX ç‚ºç’°å¢ƒã€‚è®€è€…æ‡‰å…·å‚™åŸºç¤ neural network åŠ reinforcement learning çŸ¥è­˜ï¼Œå¯å…ˆé–±è®€ &lt;a href=&quot;https://pyliaorachel.github.io/blog/tech/deeplearning/2017/10/16/getting-started-with-deep-learning-with-pytorch.html&quot;&gt;PyTorch ä»‹ç´¹&lt;/a&gt; åŠ &lt;a href=&quot;https://pyliaorachel.github.io/blog/tech/python/2018/06/01/openai-gym-for-reinforcement-learning.html&quot;&gt;Reinforcement Learning ä»‹ç´¹&lt;/a&gt;ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;åœ¨&lt;a href=&quot;https://pyliaorachel.github.io/blog/tech/python/2018/06/01/openai-gym-for-reinforcement-learning.html&quot;&gt;ä¸Šä¸€ç¯‡&lt;/a&gt;çš„å¯¦ä½œä¸­ï¼Œé‹ç”¨ Q-table å¯ä»¥æˆåŠŸçš„è®“ agent å­¸ç¿’åˆ°å¦‚ä½•ç¶­æŒå°è»Šä¸ŠæŸ±å­çš„å¹³è¡¡ã€‚ä½†æ˜¯ Q-table ä¸¦ä¸èƒ½æœ‰æ•ˆè§£æ±ºæ‰€æœ‰å•é¡Œï¼Œç‚ºä»€éº¼å‘¢ï¼Ÿæ­¤ç¯‡å°‡å¾ Q-table çš„ä¾·é™è¬›èµ·ï¼Œå¸¶å…¥ Deep Q-Learning çš„åŸç†åŠç‚ºä½•å®ƒèƒ½çªç ´é™åˆ¶ï¼Œæœ€å¾Œè¬›è§£åƒè€ƒè‡ª&lt;a href=&quot;https://morvanzhou.github.io/tutorials/machine-learning/torch/4-05-DQN/&quot;&gt;è«å‡¡Python&lt;/a&gt;çš„ Deep Q-Learning å¯¦ä½œã€‚æ–‡æœ«ç»é†œä¸€ä¸‹è‡ªå·±åšçš„ï¼ˆå¾ˆå¼±æ²’æˆåŠŸçš„ï¼‰ç”¨ reinforcement learning è§£å¯†ç¢¼çš„å°å°ˆæ¡ˆï¼ŒæœŸå¾…æœ‰äººèƒ½æˆåŠŸè¨“ç·´å‡ºä¸€å€‹è§£ç¢¼å™¨ã€‚&lt;/p&gt;

&lt;h2&gt;Deep Q-Learning åŸç†&lt;/h2&gt;

&lt;p&gt;åœ¨ Q-table çš„å¯¦ä½œä¸­ï¼Œæˆ‘å€‘çŸ¥é“æ•´å€‹ Q-table å°±æ˜¯ä¸€å€‹ä»¥ state å’Œ action ç‚ºç´¢å¼•å„²å­˜ Q value çš„è¡¨æ ¼ã€‚ä¸éåœ¨ state å’Œ action æœ‰é™ä¸”ä¸éå¤šçš„æƒ…æ³ä¸‹ï¼Œé€™å€‹ç´¢å¼•è¡¨æ ¼æ‰æœ‰å¯èƒ½è¢«å»ºç«‹ï¼Œä¾‹å¦‚ CartPole å•é¡Œä¸­ state åªæœ‰å››å€‹ featureï¼Œæ¯å€‹çš„å€¼éƒ½åœ¨æœ‰é™ç¯„åœå…§ï¼ˆæˆ–æ˜¯å¯ä»¥å›ºå®šåœ¨æœ‰é™ç¯„åœï¼‰ï¼Œaction æ›´åªæœ‰å…©å€‹å€¼ã€‚&lt;/p&gt;

&lt;p&gt;ä½†å¦‚æœä»Šå¤©æˆ‘å€‘çš„ state ä¾†è‡ªéŠæˆ²ç•«é¢ï¼Œæˆ–åœæ£‹æ£‹ç›¤å‘¢ï¼Ÿä½ å¯ä»¥é¸æ“‡æ ¹æ“šä»»å‹™åŸç†ï¼Œå¾ˆè¾›è‹¦åˆå¯èƒ½å¾’å‹ç„¡åŠŸçš„æŠŠç’°å¢ƒç°¡åŒ–æˆå¹¾å€‹æœ‰æ•ˆçš„ feature ç•¶ä½œ stateï¼›æˆ–æ˜¯é¸æ“‡ç”¨ deep neural network å¹«æˆ‘å€‘æå– feature ä¸¦é€¼è¿‘æˆ‘å€‘è¦çš„ Q functionï¼Œäº¦å³ä»Šå¤©è¦ä»‹ç´¹çš„ Deep Q-Learningã€‚&lt;/p&gt;

&lt;p&gt;å° neural network æœ‰æ¦‚å¿µçš„è©±æ‡‰è©²ä¸é›£çœ‹å‡º deep Q-learning çš„ç†å¿µã€‚æ‰€è¬‚ neural network å°±æ˜¯è—‰ç”±ä¸æ–·è¢«é¤µé£Ÿ input-output pair å¾Œï¼Œæœ€çµ‚é€¼è¿‘ input-output å°æ‡‰é—œä¿‚çš„ functionï¼Œäº¦å³ &lt;code&gt;f(input) = output&lt;/code&gt;ã€‚æŠŠå®ƒè½‰æˆ policy &lt;code&gt;Ï€(state) = action&lt;/code&gt; çš„å½¢å¼ï¼Œæ˜¯ä¸æ˜¯å°±èƒ½çœ‹å‡ºç‚ºä»€éº¼å­¸è€…æœƒæƒ³æŠŠå®ƒå¡é€² Reinforcement Learning è£¡äº†å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://cdn-images-1.medium.com/max/1600/1*w5GuxedZ9ivRYqM_MLUxOQ.png&quot; alt=&quot;&quot;&gt; &lt;/p&gt;

&lt;p&gt;ç”± neural network å–ä»£ Q-table çš„å¥½è™•æ˜¯ï¼Œneural network å¯ä»¥æ­é…ä¸åŒè®Šå½¢ï¼Œå¾é¾å¤§çš„ state space ä¸­è‡ªå‹•æå–ç‰¹å¾µï¼Œä¾‹å¦‚ç¶“å…¸çš„ &lt;a href=&quot;https://arxiv.org/pdf/1312.5602v1.pdf&quot;&gt;Playing Atari with Deep Reinforcement Learning&lt;/a&gt; å³æ˜¯ä»¥ Convolutional Neural Network ç›´æ¥ä»¥éŠæˆ²ç•«é¢çš„ raw pixel ä¸‹å»è¨“ç·´ï¼›é€™æ˜¯åƒµåŒ–çš„ Q-table è¾¦ä¸åˆ°çš„ã€‚&lt;/p&gt;

&lt;h2&gt;Deep Q-Learning å¯¦ä½œ&lt;/h2&gt;

&lt;p&gt;GitHub å®Œæ•´ç¨‹å¼ç¢¼ï¼š&lt;a href=&quot;https://github.com/pyliaorachel/openai-gym-cartpole&quot;&gt;https://github.com/pyliaorachel/openai-gym-cartpole&lt;/a&gt;ï¼›åŸå§‹ç¢¼ä¿®æ”¹è‡ª&lt;a href=&quot;https://morvanzhou.github.io/tutorials/machine-learning/torch/4-05-DQN/&quot;&gt;é€™ç¯‡æ–‡ç« &lt;/a&gt;ï¼Œæœ‰87æˆåƒã€‚&lt;/p&gt;

&lt;p&gt;åŒæ¨£ä»¥ CartPole ç‚ºç¯„ä¾‹ï¼Œç”¨ PyTorch æ‰“é€  Deep Q-Network ä¾†å¯¦ä½œ Deep Q-Learningã€‚ä»¥ä¸‹ç¸½å…±æœ‰ä¸‰æ­¥é©Ÿï¼Œä¸éåœ¨é–‹å§‹å‰ï¼Œè¦å…ˆä»‹ç´¹ä¸€äº›å°æŠ€å·§ä¾†å¢é€²è¨“ç·´ç©©å®šæ€§ã€‚&lt;/p&gt;

&lt;h4&gt;Deep Q-Network ç©©å®šå°æŠ€å·§&lt;/h4&gt;

&lt;p&gt;åœ¨ &lt;a href=&quot;https://www.nature.com/articles/nature14236&quot;&gt;Human-level control through deep reinforcement learning&lt;/a&gt; é€™ç¯‡è«–æ–‡è£¡ï¼Œç‚º Deep Q-Learning çš„è¨“ç·´ç©©å®šæ€§æä¾›äº†ä¸‰é …è§£è—¥ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Use experience replayï¼Œäº¦å³æŠŠ experience å­˜åœ¨ memory ä¸­ï¼Œè¨“ç·´æ™‚éš¨æ©Ÿå¾ä¸­æŠ½æ¨£ã€‚é€™éº¼åšå¯ä»¥æ‰“äº‚é€™äº› experience ä¹‹é–“æ²’æœ‰å¿…è¦çš„æ™‚é–“é—œä¿‚ã€‚&lt;/li&gt;
&lt;li&gt;Freeze target Q-networkï¼Œå³å»ºç«‹å…©ç¨® Q-networkï¼Œä¸€ç‚ºå¯¦éš›é€²è¡Œè¨“ç·´çš„ evaluation networkï¼Œä¸€ç‚ºè¨“ç·´ç›®æ¨™ target networkï¼Œå…¶ä¸­ target network ä¹…ä¹…æ›´æ–°ä¸€æ¬¡ï¼Œæ›´æ–°æ™‚ç›´æ¥æŠŠ evaluation network çš„åƒæ•¸æ•´çµ„è¤‡è£½éä¾†ã€‚é‚„è¨˜å¾— Q function çš„éè¿´é—œä¿‚: &lt;code&gt;Q(s, a) = r + Î³ * max_a&amp;#39; Q(s&amp;#39;, a&amp;#39;)&lt;/code&gt; å—ï¼Ÿå¦‚æœåªè¨“ç·´ä¸€å€‹ networkï¼Œå‰‡æ¯æ›´æ–°ä¸€æ¬¡ï¼Œä¸åªæ˜¯æ­£åœ¨è¨“ç·´çš„ &lt;code&gt;Q(s, a)&lt;/code&gt; åœ¨è®Šï¼Œæˆ‘å€‘çš„ç›®æ¨™ &lt;code&gt;Q(s&amp;#39;, a&amp;#39;)&lt;/code&gt; ä¹Ÿè·Ÿè‘—åœ¨è®Šï¼æ•´å€‹ network æœƒåƒæ˜¯è‡ªå·±è¿½è‘—è‡ªå·±çš„å°¾å·´ä¸€æ¨£ï¼Œç„¡æ³•è¶¨æ–¼ç©©å®šã€‚&lt;/li&gt;
&lt;li&gt;Clip rewardsï¼Œå³é™ç¸® reward çš„å€¼ï¼Œä»¥åˆ© backpropagation ä¸­èƒ½æœ‰ç©©å®šçš„ gradient è¨ˆç®—ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é€™äº›å°æŠ€å·§å°‡æœƒèå…¥æˆ‘å€‘çš„å¯¦ä½œä¸­ã€‚&lt;/p&gt;

&lt;h4&gt;Step 1: å»ºç«‹ Network&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆå»ºç«‹ä¸€å±¤ hidden layer çš„ neural networkï¼ŒæŠŠ state å‚³å…¥å¾Œï¼Œå¾—å‡ºæ¯å€‹ action çš„åˆ†æ•¸ï¼Œåˆ†æ•¸è¶Šé«˜çš„ action è¶Šæœ‰æ©Ÿæœƒè¢«æŒ‘é¸ã€‚è€Œæˆ‘å€‘çš„ç›®æ¨™æ˜¯åœ¨ç•¶å‰ state ä¸‹ï¼Œè®“å°æœªä¾†è¶Šæœ‰åˆ©çš„ action åˆ†æ•¸èƒ½è¶Šé«˜ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# è¼¸å…¥å±¤ (state) åˆ°éš±è—å±¤ï¼Œéš±è—å±¤åˆ°è¼¸å‡ºå±¤ (action)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fc1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Linear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Linear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fc1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;relu&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# ReLU activation&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;actions_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actions_value&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Step 2: å»ºç«‹ Deep Q-Network&lt;/h4&gt;

&lt;p&gt;åœ¨å°æŠ€å·§ä¸­æåˆ°ï¼Œç¸½å…±éœ€è¦å…©å€‹ networkï¼Œevaluation network (&lt;code&gt;eval_net&lt;/code&gt;) åŠ target network (&lt;code&gt;target_net&lt;/code&gt;)ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé‚„è¦æœ‰ memory å„²å­˜ experienceï¼Œä»¥åŠè¨­å®šå¥½åƒæ•¸ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DQN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gamma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target_replace_iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eval_net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target_net&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zeros&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# æ¯å€‹ memory ä¸­çš„ experience å¤§å°ç‚º (state + next state + reward + action)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;optimizer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;optim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Adam&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eval_net&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loss_func&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MSELoss&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory_counter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;learn_step_counter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# è®“ target network çŸ¥é“ä»€éº¼æ™‚å€™è¦æ›´æ–°&lt;/span&gt;

        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gamma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gamma&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target_replace_iter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target_replace_iter&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;choose_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;store_transition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;learn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;pass&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;choose_action&lt;/code&gt; æœƒæ ¹æ“š epsilon-greedy policy é¸æ“‡ actionã€‚ä¸Šæ¬¡æœ‰æåˆ°ï¼Œepsilon è¡¨æ©Ÿç‡ï¼Œè¨“ç·´éç¨‹ä¸­æœ‰ epsilon çš„æ©Ÿç‡ agent æœƒé¸æ“‡äº‚ï¼ˆéš¨æ©Ÿï¼‰èµ°ï¼Œå¦‚æ­¤æ‰æœ‰æ©Ÿæœƒå­¸ç¿’åˆ°æ–°ç¶“é©—ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;choose_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unsqueeze&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FloatTensor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# epsilon-greedy&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uniform&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# éš¨æ©Ÿ&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# æ ¹æ“šç¾æœ‰ policy åšæœ€å¥½çš„é¸æ“‡&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;actions_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eval_net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# ä»¥ç¾æœ‰ eval net å¾—å‡ºå„å€‹ action çš„åˆ†æ•¸&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;actions_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# æŒ‘é¸æœ€é«˜åˆ†çš„ action&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å†ä¾† DQN éœ€è¦å„²å­˜ experienceï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;store_transition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# æ‰“åŒ… experience&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;transition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hstack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# å­˜é€² memoryï¼›èˆŠ memory å¯èƒ½æœƒè¢«è¦†è“‹&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory_counter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;transition&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory_counter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœ€å¾Œæ˜¯å¾ memory ä¸­å–æ¨£å­¸ç¿’ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;learn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# éš¨æ©Ÿå–æ¨£ batch_size å€‹ experience&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sample_index&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b_memory&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sample_index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FloatTensor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_memory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b_action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LongTensor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_memory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;astype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b_reward&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FloatTensor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_memory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;b_next_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FloatTensor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_memory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:])&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# è¨ˆç®—ç¾æœ‰ eval net å’Œ target net å¾—å‡º Q value çš„è½å·®&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;q_eval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eval_net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gather&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# é‡æ–°è¨ˆç®—é€™äº› experience ç•¶ä¸‹ eval net æ‰€å¾—å‡ºçš„ Q value&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;q_next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target_net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_next_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;detach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# detach æ‰ä¸æœƒè¨“ç·´åˆ° target net&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;q_target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b_reward&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gamma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q_next&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# è¨ˆç®—é€™äº› experience ç•¶ä¸‹ target net æ‰€å¾—å‡ºçš„ Q value&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loss_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;q_eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q_target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Backpropagation&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;optimizer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zero_grad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;optimizer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# æ¯éš”ä¸€æ®µæ™‚é–“ (target_replace_iter), æ›´æ–° target netï¼Œå³è¤‡è£½ eval net åˆ° target net&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;learn_step_counter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;learn_step_counter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target_replace_iter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target_net&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;load_state_dict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eval_net&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state_dict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Step 3: è¨“ç·´&lt;/h4&gt;

&lt;p&gt;è¨“ç·´éç¨‹æ˜¯ 1. é¸æ“‡ action 2. å„²å­˜ experience 3. è¨“ç·´ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gym&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'CartPole-v0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Environment parameters&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action_space&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation_space&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Hyper parameters&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;                 &lt;span class=&quot;c&quot;&gt;# learning rate&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.1&lt;/span&gt;             &lt;span class=&quot;c&quot;&gt;# epsilon-greedy&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gamma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.9&lt;/span&gt;               &lt;span class=&quot;c&quot;&gt;# reward discount factor&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;target_replace_iter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# target network æ›´æ–°é–“éš”&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2000&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_episodes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4000&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# å»ºç«‹ DQN&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;dqn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DQN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_states&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_hidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gamma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target_replace_iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# å­¸ç¿’&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i_episode&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_episodes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# é¸æ“‡ action&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dqn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choose_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# å„²å­˜ experience&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;dqn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;store_transition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# ç´¯ç© reward&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# æœ‰è¶³å¤  experience å¾Œé€²è¡Œè¨“ç·´&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dqn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;memory_counter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;memory_capacity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;dqn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;learn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# é€²å…¥ä¸‹ä¸€ state&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Episode finished after {} timesteps, total rewards {}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;çµæœ&lt;/h4&gt;

&lt;p&gt;è¨“ç·´æœ€å¾Œå¹¾æ­¥çš„çµæœå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pyliaorachel/openai-gym-cartpole/blob/master/img/dqn_no_cheat.png?raw=true&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;p&gt;ä»€éº¼ï¼Ÿä¹Ÿå¤ªç³Ÿäº†å§ã€‚æ•´å€‹è¨“ç·´çœ‹ä¸å‡ºæœ‰æ”¶æ–‚ï¼Œè‡³å°‘è·‘äº† 4000 å€‹ episode çš„æƒ…æ³ä¸‹æ˜¯å¦‚æ­¤ã€‚&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘é‡æ–°çœ‹çœ‹ reward æ˜¯æ€éº¼ç²å¾—çš„ã€‚ä¸€åˆ‡éƒ½åœ¨ &lt;a href=&quot;https://github.com/openai/gym/blob/master/gym/envs/classic_control/cartpole.py&quot;&gt;&lt;code&gt;gym&lt;/code&gt; çµ¦çš„ environment&lt;/a&gt; è£¡ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps_beyond_done&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# Pole just fell!&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps_beyond_done&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;steps_beyond_done&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.0&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯æŸ±å­å€’äº†ä¹‹å¾Œç²å¾— 0 åˆ†ï¼Œå…¶ä»–æƒ…æ³ä¸‹ç²å¾— 1 åˆ†ã€‚é€™éº¼ç¼ºä¹è³‡è¨Šçš„ rewardï¼Œå¾—æœ‰å‹ agent å˜—è©¦å¥½å¹¾å›æ‰èƒ½å­¸æœƒæ€éº¼ç¶­æŒæŸ±å­å¹³è¡¡ã€‚&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘ç¨å¾®ä½œå¼Šä¸€ä¸‹ï¼Œè‡ªå·±å»ºç«‹ reward åˆ†é…æ–¹æ³•ï¼Œè®“ reward æä¾›æ›´å¤šè³‡è¨Šã€‚å¾ˆç›´è¦ºçš„ï¼ŒæŸ±å­çš„è§’åº¦è¶Šæ­£ï¼Œreward æ‡‰è©²è¶Šå¤§ã€‚å¦å¤–è‹¥æƒ³è¦å°è»Šä¿æŒåœ¨ä¸­é–“ï¼Œé‚£éº¼å°è»Šè·Ÿä¸­é–“çš„è·é›¢è¶Šå°ï¼Œreward ä¹Ÿæ‡‰è©²è¶Šå¤§ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ä¿®æ”¹ rewardï¼ŒåŠ å¿«è¨“ç·´&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;omega&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x_threshold&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x_threshold&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.8&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# å°è»Šé›¢ä¸­é–“è¶Šè¿‘è¶Šå¥½&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theta_threshold_radians&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;theta_threshold_radians&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# æŸ±å­è¶Šæ­£è¶Šå¥½&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;dqn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;store_transition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æŠŠ episode èª¿åˆ° 400 æ¬¡ï¼Œå·²ç¶“èƒ½æœ‰ä¸éŒ¯çš„è¨“ç·´çµæœäº†ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pyliaorachel/openai-gym-cartpole/blob/master/img/dqn_cheat.png?raw=true&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

&lt;p&gt;é€™é‚Šæ³¨æ„ä¸èƒ½ç›´æ¥æ‹¿ reward çš„å€¼ç›¸æ¯”ï¼Œå› ç‚ºæ–¹æ³•ä¸åŒï¼Œä¸»è¦æ˜¯çœ‹ timestepï¼Œå°±æ˜¯æŸ±å­ç¶­æŒä¸å€’çš„æ™‚é–“ã€‚å¦‚æœè‡ªå·±è·‘è·‘çœ‹ï¼Œå¯ä»¥çœ‹åˆ°æŸ±å­åœ¨è¨“ç·´å¾ŒæœŸå¯ä»¥ç©©å®šç«™ç«‹åœ¨å°è»Šä¸Šã€‚&lt;/p&gt;

&lt;h2&gt;ä¸é‡è¦å°ç»é†œï¼šReinforcement Learning è§£ç¢¼å™¨&lt;/h2&gt;

&lt;p&gt;GitHub å®Œæ•´ç¨‹å¼ç¢¼ï¼š&lt;a href=&quot;https://github.com/pyliaorachel/reinforcement-learning-decipher&quot;&gt;https://github.com/pyliaorachel/reinforcement-learning-decipher&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¹‹å‰çš„èª²å ‚ä½œæ¥­è£¡ï¼Œæˆ‘é¸æ“‡å˜—è©¦ reinforcement learning ä¾†è§£&lt;a href=&quot;https://zh.wikipedia.org/zh-tw/%E5%87%B1%E6%92%92%E5%AF%86%E7%A2%BC&quot;&gt;å‡±è–©å¯†ç¢¼&lt;/a&gt;ï¼Œå°±æ˜¯ä¸€ç¨®å¾ˆç°¡å–®çš„æ›¿æ›åŠ å¯†æŠ€è¡“ã€‚é›£é»åœ¨æ–¼ï¼Œå¸Œæœ›ç”¨ RNN æ•æ‰ state å’Œ state ä¹‹é–“çš„æ™‚é–“é—œä¿‚ï¼Œä»¥åŠå­¸æœƒå¯†ç¢¼çš„åç§»é‡ã€‚&lt;/p&gt;

&lt;p&gt;çµæœå…¶å¯¦å¾ˆä¸ç†æƒ³ï¼Œé€£é•·åº¦ 2~4 çš„å¯†ç¢¼éƒ½è§£ä¸é–‹ï¼Œæœ€å¾Œå› ç‚ºæ™‚é–“é—œä¿‚å°±é¦¬é¦¬è™è™çš„äº¤äº†ï¼ˆåˆ†æ•¸é‚„æŒºé«˜çš„å°±æ˜¯ï¼‰ã€‚æˆ‘æœ‰å¯«ä¸€ä»½ &lt;a href=&quot;https://github.com/pyliaorachel/reinforcement-learning-decipher/blob/master/report.pdf&quot;&gt;report&lt;/a&gt;ï¼Œæœ‰èˆˆè¶£å¯ä»¥çœ‹çœ‹ï¼Œé‚„ç®—æœ‰ä¸€äº›å°æˆæœã€‚å°ˆæ¡ˆè£¡ä¹Ÿæœ‰æˆ‘è¨­ç½®çš„è§£å¯†ç’°å¢ƒï¼Œæœ‰èˆˆè¶£å¯ä»¥è¼‰ä¾†ç©ç©ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å¹«æˆ‘æ”¹å–„æ¼”ç®—æ³•ã€‚&lt;/p&gt;

&lt;h2&gt;çµèª&lt;/h2&gt;

&lt;p&gt;æœ¬ç¯‡ä»‹ç´¹äº†æœ€åŸºæœ¬çš„ Deep Q-Learning åŸç†åŠå¯¦ä½œï¼Œé›–ç„¶å¯ä»¥å…‹æœ Q-table çš„å®¹é‡é™åˆ¶ï¼Œä½†è¨“ç·´é›£åº¦å¢åŠ ä¸å°‘ï¼ŒåŒ…æ‹¬è¨“ç·´ç©©å®šæ€§åŠé€Ÿåº¦ç­‰ç­‰ï¼Œéƒ½è¦è²»æ™‚èª¿æ•™ä¸€ç•ªï¼Œæœ‰æ™‚é‚„éœ€è¦å¼•é€²æ—é–€å·¦é“...æˆ‘æ˜¯èªªï¼Œå°æ’‡æ­¥ï¼Œä¾†å¢åŠ è¨“ç·´æ•ˆç‡ã€‚å…¶å¯¦ Deep Reinforcement Learning é‚„æœ‰å¾ˆå¤šé€²åŒ–ä¹‹ä½œï¼Œå°±å¾…æœ‰èˆˆè¶£çš„è®€è€…è‡ªè¡Œæ·±å…¥æ¢è¨äº†ã€‚&lt;/p&gt;

&lt;h2&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://morvanzhou.github.io/tutorials/machine-learning/torch/4-05-DQN/&quot;&gt;DQN å¼ºåŒ–å­¦ä¹ &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.freecodecamp.org/an-introduction-to-deep-q-learning-lets-play-doom-54d02d8017d8&quot;&gt;An introduction to Deep Q-Learning: letâ€™s play Doom&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://llcao.net/cu-deeplearning17/pp/class11_DQN.pdf&quot;&gt;PowerPoint: Human-Level Control through Deep Reinforcement Learning&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;ç¶“å…¸è«–æ–‡é‰…ç»&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://arxiv.org/pdf/1312.5602v1.pdf&quot;&gt;Playing Atari with Deep Reinforcement Learning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.nature.com/articles/nature14236&quot;&gt;Human-level control through deep reinforcement learning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.nature.com/articles/nature24270&quot;&gt;Mastering the game of Go without human knowledge&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Thu, 14 Jun 2018 00:00:00 -0700</pubDate>
        <link>/blog/tech/python/2018/06/14/deep-q-learning.html</link>
        <guid isPermaLink="true">/blog/tech/python/2018/06/14/deep-q-learning.html</guid>
        
        <category>Python</category>
        
        <category>PyLadies</category>
        
        <category>OpenAI gym</category>
        
        <category>Reinforcement Learning</category>
        
        
        <category>Blog</category>
        
        <category>Tech</category>
        
        <category>Python</category>
        
      </item>
    
      <item>
        <title>Reinforcement Learning å¥èº«æˆ¿ï¼šOpenAI Gym</title>
        <description>&lt;p&gt;ä¸ä¹…å‰ç«ç†±çš„ AlphaGo åœæ£‹ AI ç³»çµ±å› æ‰“æ•—çœ¾å¤šäººé¡å¥½æ‰‹è€Œè²åå¤§å™ªï¼Œè€Œç¨å¾Œæ¨å‡ºçš„é€²åŒ–ç‰ˆ AlphaGo Zero æ›´æ˜¯ä¹¾æ·¨åˆ©è½çš„è—‰ç”±èˆ‡è‡ªèº«å°æŠ—è€Œç¿’å¾—æ£‹è—ï¼Œä»¤äººå˜–å˜–ç¨±å¥‡ã€‚è€Œé€™ç³»åˆ—åœæ£‹ AI ç³»çµ±èƒŒå¾Œå³æ˜¯ä»¥ &lt;strong&gt;Reinforcement Learning å¼·åŒ–å­¸ç¿’&lt;/strong&gt;ç‚ºåŸºç¤è¨“ç·´è€Œæˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Gym&lt;/code&gt; æ˜¯ OpenAI æ‰€é–‹æºçš„ Reinforcement Learning å·¥å…·åŒ…ã€‚ç„¡è«–æ˜¯æƒ³æ„Ÿå— Reinforcement Learning æ˜¯æ€éº¼ä¸€å›äº‹ï¼Œæˆ–æ˜¯æƒ³å˜—è©¦é€²éš Deep Q-Learning çš„é–‹ç™¼è€…ï¼Œéƒ½å¯ä»¥å¿«é€Ÿæ–¹ä¾¿çš„èª¿ç”¨ &lt;code&gt;gym&lt;/code&gt; æ‰€æä¾›çš„è¨±å¤šç¾æˆç’°å¢ƒï¼Œå°ˆæ³¨æ–¼æ¼”ç®—æ³•çš„è¨­è¨ˆèˆ‡å¯¦ç¾ã€‚å¿«è®“æˆ‘å€‘ä¸€èµ·ä¾†æˆç‚ºå¥èº«æˆ¿çš„æ°¸ä¹…å…è²»æœƒå“¡ï¼&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;p&gt;&lt;em&gt;* è«‹æ³¨æ„ï¼Œä»¥ä¸‹åªé‡å°Python3é€²è¡Œè¬›è§£èˆ‡æ¸¬è©¦ï¼Œä¸¦ä»¥ MacOSX ç‚ºç’°å¢ƒã€‚&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;æœ¬ç¯‡æœƒå¾åŸºç¤ Reinforcement Learning æ¦‚å¿µç°¡ä»‹é–‹å§‹ï¼Œé€²å…¥ OpenAI gym ç°¡ä»‹ï¼Œè·Ÿè‘—å…©å€‹ demo å¼çš„ç°¡å–®æ¼”ç®—æ³•å¯¦ä½œ -- &lt;strong&gt;Random Action&lt;/strong&gt; åŠ &lt;strong&gt;Hand-Made Policy&lt;/strong&gt;ï¼Œæœ€å¾Œå¸¶è‡³å…·æœ‰å­¸ç¿’èƒ½åŠ›çš„æ¼”ç®—æ³• --  &lt;strong&gt;Q table ç‚ºåŸºç¤çš„ Q-learning&lt;/strong&gt;ã€‚èˆ‡ Deep Learning çµåˆçš„ Deep Q-learning æœƒåœ¨ä¹‹å¾Œçš„é€²éšç¯‡å¯¦ä½œã€‚&lt;/p&gt;

&lt;h2&gt;Reinforcement Learning ä»‹ç´¹&lt;/h2&gt;

&lt;p&gt;è©¦æƒ³ä¸€å€‹å¤§å­¸ç”Ÿï¼ŒåŸæœ¬ç¸½æ˜¯åäºŒé»ç¡ï¼Œä½†é›¢é–‹å®¶ä½é€²å®¿èˆå¾Œï¼Œæ¯å¤©æ‰“é›»å‹•æ‰“åˆ°å…©é»æ‰ç¡ï¼Œéš”å¤©ä¸Šèª²æ˜æ˜æ²‰æ²‰ï¼ŒGPA 0.87ã€‚æŸå¤©ä»–å˜—è©¦åé»ä¸ŠåºŠç¡è¦ºï¼Œç™¼ç¾éš”å¤©ä¸Šèª²è…¦è¢‹æ¸…æ™°ã€ç¥é‡‡å¥•å¥•ï¼Œå…¨èº«èˆ’çˆ½çš„ä»–é–‹å§‹æ…¢æ…¢èª¿æ•´ä½œæ¯ï¼Œæœ€çµ‚ GPA 4.3ã€‚å¾å°ä¸€å€‹æ–°ç’°å¢ƒä¸€ç„¡æ‰€çŸ¥ï¼Œä¸æ–·å˜—è©¦ä¸åŒä½œæ¯æ™‚é–“ï¼Œé€²è€Œè—‰ç”±æ‰€ç²å¾—çš„å¥½è™•ï¼ˆèº«å¿ƒæ„Ÿå—ã€GPAç­‰ï¼‰å­¸æœƒæœ€é©åˆè‡ªå·±çš„ä½œæ¯ï¼Œé€™ç¨®å­¸ç¿’éç¨‹ä¾¿æ˜¯ Reinforcement Learningã€‚&lt;/p&gt;

&lt;p&gt;Reinforcement Learning æ˜¯ Machine Learning å®¶æ—çš„ä¸€å“¡ï¼Œç‚ºä¸€ç¨®&lt;strong&gt;ç›®æ¨™å°å‘(goal-oriented)&lt;/strong&gt;çš„å­¸ç¿’æ–¹æ³•ï¼Œæ—¨åœ¨ç¶“ç”±èˆ‡ç’°å¢ƒäº’å‹•éç¨‹ä¸­ç²å¾—çš„å„ç¨®çå‹µæˆ–æ‡²ç½°ï¼Œå­¸æœƒå¦‚ä½•åšæ±ºç­–ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://i.stack.imgur.com/eoeSq.png&quot; alt=&quot;reinforcement learning&quot;&gt;&lt;/p&gt;

&lt;p&gt;æ•´å€‹æ±ºç­–éç¨‹çš„æ¨¡æ“¬æœ‰ä»¥ä¸‹å¹¾å€‹è¦ç´ ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Agent&lt;/strong&gt;ï¼Œè—‰ç”± action è·Ÿ environment äº’å‹•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Environment&lt;/strong&gt;ï¼Œagent çš„è¡Œå‹•ç¯„åœï¼Œæ ¹æ“š agent çš„ action çµ¦äºˆä¸åŒç¨‹åº¦çš„ rewardã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;State&lt;/strong&gt;ï¼Œåœ¨ç‰¹å®šæ™‚é–“é» agent èº«è™•çš„ç‹€æ…‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Action&lt;/strong&gt;ï¼Œagent è—‰ç”±è‡ªèº« policy é€²è¡Œçš„å‹•ä½œã€‚ &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Reward&lt;/strong&gt;ï¼Œenvironment çµ¦äºˆ agent æ‰€åš action çš„çå‹µæˆ–æ‡²ç½°ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Agent çš„ç›®æ¨™æ˜¯è—‰ç”±èˆ‡ environment ä¸æ–·äº’å‹•åŠç²å¾— rewardï¼Œå­¸æœƒæœ€ä½³ &lt;strong&gt;policy&lt;/strong&gt;ï¼Œå³æ˜¯ agent æ ¹æ“šèº«è™•çš„ state æ±ºå®šé€²è¡Œæœ€ä½³ action çš„ç­–ç•¥ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šæ˜¯ Reinforcement Learning çš„ç°¡å–®ä»‹ç´¹ï¼Œæ¬²æ·±å…¥äº†è§£å¯åƒè€ƒæ–‡æœ«åƒè€ƒè³‡æ–™ã€‚&lt;/p&gt;

&lt;h2&gt;OpenAI Gym ä»‹ç´¹&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://gym.openai.com/&quot;&gt;OpenAI Gym&lt;/a&gt; æ˜¯ç”± OpenAI é–‹æºçš„ Reinforcement Learning å·¥å…·åŒ…ï¼Œè£¡é¢æœ‰è¨±å¤šç¾æˆ environment è™•ç†ç’°å¢ƒæ¨¡æ“¬åŠçå‹µç­‰ç­‰éç¨‹ï¼Œè®“é–‹ç™¼è€…å°ˆæ³¨æ–¼æ¼”ç®—æ³•é–‹ç™¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gym.openai.com/docs/&quot;&gt;å®‰è£éç¨‹&lt;/a&gt;éå¸¸ç°¡å–®ï¼Œé¦–å…ˆç¢ºä¿ä½ çš„ Python version åœ¨ 3.5 ä»¥ä¸Šï¼Œç„¶å¾Œä½¿ç”¨ pip å®‰è£ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;pip install gym
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¥è‘—åªéœ€è¦ &lt;code&gt;import gym&lt;/code&gt; å°±èƒ½é–‹å§‹é«”é©— Reinforcement Learningã€‚&lt;/p&gt;

&lt;h2&gt;æ¼”ç®—æ³•å¯¦ä½œ&lt;/h2&gt;

&lt;p&gt;&lt;code&gt;Gym&lt;/code&gt; ä¸€ç³»åˆ—çš„ environment éƒ½åœ¨&lt;a href=&quot;https://gym.openai.com/envs/#classic_control&quot;&gt;é€™è£¡&lt;/a&gt;ã€‚æˆ‘å€‘æŒ‘é¸ &lt;code&gt;CartPole-v0&lt;/code&gt; ç•¶ç¤ºç¯„ï¼Œä»»å‹™æ˜¯ç¶­æŒå°è»Šä¸Šçš„æŸ±å­çš„å¹³è¡¡ã€‚å®ƒçš„ environment åªæœ‰å››ç¨® featureï¼ˆå°è»Šä½ç½®ï¼Œå°è»Šé€Ÿåº¦ï¼ŒæŸ±å­è§’åº¦ï¼ŒæŸ±å°–é€Ÿåº¦ï¼‰ï¼Œagent åªæœ‰å…©ç¨® actionï¼ˆå‘å·¦ç§»ï¼Œå‘å³ç§»ï¼‰ã€‚ç¶²è·¯ä¸Šæœ‰éå¸¸å¤šå»ºç«‹åœ¨ CartPole çš„ç¯„ä¾‹ï¼Œé€™é‚ŠæŠŠå¸¸è¦‹æ¼”ç®—æ³•æ•´åˆï¼Œé€²éšçš„ Deep Q-Network å‰‡ç•™åˆ°ä¸‹ä¸€ç¯‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pyliaorachel/openai-gym-cartpole/blob/master/img/cartpole.png?raw=true&quot; alt=&quot;cart pole&quot;&gt;&lt;/p&gt;

&lt;p&gt;GitHub å®Œæ•´ç¨‹å¼ç¢¼ï¼š&lt;a href=&quot;https://github.com/pyliaorachel/openai-gym-cartpole&quot;&gt;https://github.com/pyliaorachel/openai-gym-cartpole&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;Random Action&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆç”¨æœ€ç°¡å–®çš„ä¾‹å­é«”é©— &lt;code&gt;gym&lt;/code&gt; çš„ä½¿ç”¨ â€”â€” ç„¡è«– environment å¦‚ä½•ï¼Œéš¨æ©Ÿé€²è¡Œ actionï¼Œä¹Ÿå°±æ˜¯éš¨æ©Ÿæ±ºå®šè¦å°‡å°è»Šå·¦ç§»æˆ–å³ç§»ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gym&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'CartPole-v0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# è·‘ 200 å€‹ episodeï¼Œæ¯å€‹ episode éƒ½æ˜¯ä¸€æ¬¡ä»»å‹™å˜—è©¦&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i_episode&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# è®“ environment é‡å›åˆå§‹ç‹€æ…‹ &lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# ç´¯è¨ˆå„ episode çš„ reward &lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# è¨­å€‹æ™‚é™ï¼Œæ¯å€‹ episode æœ€å¤šè·‘ 250 å€‹ action&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# å‘ˆç¾ environment&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# Key section&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action_space&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# åœ¨ environment æä¾›çš„ action ä¸­éš¨æ©ŸæŒ‘é¸&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# é€²è¡Œ actionï¼Œenvironment è¿”å›è©² action çš„ reward åŠå‰é€²ä¸‹å€‹ state&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# ç´¯è¨ˆ reward&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# ä»»å‹™çµæŸè¿”å› done = True&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Episode finished after {} timesteps, total rewards {}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç²¾è¯éƒ½åœ¨ Key sectionï¼Œagent é¸æ“‡ä¸¦é€²è¡Œä¸€å€‹ actionï¼Œä¸¦å¾ environment ä¸­ç²å¾— rewardã€‚å¯ä»¥çœ‹åˆ° agent ä¸¦æ²’æœ‰ä»»ä½•å­¸ç¿’è¡Œç‚ºï¼Œæ‰€ä»¥æ•´é«” reward ä¸¦ä¸é«˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pyliaorachel/openai-gym-cartpole/blob/master/img/random_action.png?raw=true&quot; alt=&quot;random action&quot;&gt;&lt;/p&gt;

&lt;h3&gt;Hand-Made Policy&lt;/h3&gt;

&lt;p&gt;ç‚ºäº†è®“ agent ä¸æœƒèµ°å¾—å¤ªç„¡è…¦ï¼Œå†ä¾†å¼•é€²ä¸€å€‹ç°¡å–®çš„ policy â€”â€” å¦‚æœæŸ±å­å‘å·¦å‚¾ï¼ˆè§’åº¦ &amp;lt; 0ï¼‰ï¼Œå‰‡å°è»Šå·¦ç§»ä»¥ç¶­æŒå¹³è¡¡ï¼Œå¦å‰‡å³ç§»ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å…¶å¯¦æ­£å¸¸ä¾†èªªï¼Œagent æ˜¯ä¸æœƒçŸ¥é“ environment æ‰€æä¾›çš„é€™äº› feature å’Œ action å„è‡ªæ˜¯ä»€éº¼æ„æ€ï¼Œå› æ­¤é€™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯ç¤ºç¯„ policy çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# å®šç¾© policy&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;choose_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ang&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rot&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ang&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# æŸ±å­å·¦å‚¾å‰‡å°è»Šå·¦ç§»ï¼Œå¦å‰‡å³ç§» &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gym&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'CartPole-v0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i_episode&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;choose_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Episode finished after {} timesteps, total rewards {}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;çµæœï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pyliaorachel/openai-gym-cartpole/blob/master/img/hand_made_policy.png?raw=true&quot; alt=&quot;hand-made rule&quot;&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° agent æ‰€ç²å¾—çš„æ•´é«” reward æ¯” random action é«˜å‡ºè¨±å¤šï¼Œä¸é agent ä¾ç„¶æ²’æœ‰æ ¹æ“šç¶“é©—åšå­¸ç¿’ï¼Œéå¸¸é ‘å›ºã€‚æ¥ä¸‹ä¾†è¦ä¾†ç¤ºç¯„çœŸæ­£å¯¦ç”¨çš„ learning process â€”â€” Q-learningã€‚&lt;/p&gt;

&lt;h3&gt;Q-Learning with Q Table&lt;/h3&gt;

&lt;p&gt;åœ¨é€²å…¥å¯¦ä½œå‰ï¼Œæœƒå…ˆç°¡å–®è¬›è§£ Q-learning åŠ Q table æ¦‚å¿µï¼Œå¯ç•¶ä½œè£œå……ã€‚&lt;/p&gt;

&lt;h6&gt;Q-Learning&lt;/h6&gt;

&lt;p&gt;ç‚ºäº†å­¸ç¿’åœ¨æŸå€‹ state ä¹‹ä¸‹åšå‡ºå¥½çš„ actionï¼Œæˆ‘å€‘å®šç¾©æ‰€è¬‚çš„ Q function &lt;code&gt;Q(s, a)&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯&lt;strong&gt;æ ¹æ“šèº«è™•çš„ state &lt;code&gt;s&lt;/code&gt; é€²è¡Œ action &lt;code&gt;a&lt;/code&gt; æ‰€é æœŸæœªä¾†æœƒå¾—åˆ°çš„ç¸½ reward&lt;/strong&gt;ã€‚å¦‚æœèƒ½æ±‚å‡ºæœ€ä½³ Q function&lt;code&gt;Q*(s, a)&lt;/code&gt;ï¼Œæˆ‘å€‘çš„ agent åœ¨ä»»ä½• state ä¹‹ä¸‹ï¼Œåªè¦æŒ‘é¸èƒ½æœ€å¤§åŒ–æœªä¾†ç¸½ reward çš„ action ï¼Œå³ &lt;code&gt;argmax_a Q*(s, a)&lt;/code&gt;ï¼Œå³èƒ½åœ¨ä»»å‹™ä¸­ç²å¾—æœ€å¤§ rewardã€‚è€Œç¿’å¾— Q function çš„éç¨‹æ­£æ˜¯ Q-learningã€‚&lt;/p&gt;

&lt;p&gt;åœ¨å­¸ç¿’ Q function å‰ï¼Œè¦å…ˆçŸ¥é“å¦‚ä½•è¡¨ç¤º Q functionã€‚ä¸é›£ç™¼ç¾ Q function æœ‰éè¿´ç‰¹è³ªï¼Œå¯ä»¥ç”¨éè¿´è¡¨ç¤ºï¼š&lt;/p&gt;

&lt;p style=&quot;text-align: center;&quot;&gt;
    &lt;img src=&quot;https://cdn-images-1.medium.com/max/1600/1*jamiG5MkFVHLTFmLggemVg.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;å³æ˜¯ç•¶å‰ reward å’Œé€²å…¥ä¸‹ä¸€å€‹ state &lt;code&gt;s&amp;#39;&lt;/code&gt; å¾Œæ‰€èƒ½ç²å¾—æœ€å¤§ discounted reward çš„å’Œã€‚é€™é‚Šçš„ Î³ ç¨±ç‚º discount factorï¼Œå¯ä»¥èªªæ˜¯å°æœªä¾† reward çš„é‡è¦–ç¨‹åº¦ã€‚Î³ è¶Šä½ï¼Œagent è¶Šé‡è¦–ç•¶å‰æ‰€ç²å¾—çš„ rewardï¼Œä¸¦è¦ºå¾—æœªä¾†ç²å¾—çš„ reward å¤ªé™é ï¼Œä¸è¶³ä»¥åœ¨ç•¶å‰ state çš„æ±ºç­–éç¨‹ä¸­ä½”æœ‰å¤ªå¤§ä»½é‡ã€‚&lt;/p&gt;

&lt;p&gt;æ¥è‘— agent è¦è—‰ç”±ä¸€æ¬¡æ¬¡è·Ÿ environment äº’å‹•ä¸­ç²å¾—çš„ reward ä¾†å­¸ç¿’ Q functionã€‚èµ·åˆ agent ä¸€ç„¡æ‰€çŸ¥æ™‚ï¼ŒQ function çš„åƒæ•¸éƒ½æ˜¯éš¨æ©Ÿçš„ã€‚æ¥è‘—å¾è·Ÿ environment äº’å‹•çš„æ¯ä¸€æ­¥ï¼Œæ…¢æ…¢æ›´æ–°åƒæ•¸ï¼Œé€¼è¿‘æˆ‘å€‘è¦çš„æœ€ä½³ Q functionï¼š&lt;/p&gt;

&lt;p style=&quot;text-align: center;&quot;&gt;
    &lt;img src=&quot;https://wikimedia.org/api/rest_v1/media/math/render/svg/845e1915e9fc3b55a3e88cb6fb5f40a41c1b6606&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;é€™è£¡ learned value æ˜¯æ¯æ¬¡ action å¸¶ä¾†çš„ä¸€é»æ–°è³‡è¨Šï¼Œä½†ä¸èƒ½ç›´æ¥å–ä»£èˆŠè³‡è¨Šï¼Œè€Œæ˜¯æ¯æ¬¡æ›´æ–° Î± é€™éº¼å¤šæ¯”ç‡çš„æ–°è³‡è¨Šï¼Œä¿ç•™ (1 - Î±) æ¯”ç‡çš„èˆŠè³‡è¨Šï¼Œæœ€çµ‚é€æ¼¸æ”¶æ–‚ã€‚&lt;/p&gt;

&lt;p&gt;æ•´é«” Q-learning æ­¥é©Ÿå¤§è‡´ä¸Šå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p style=&quot;text-align: center;&quot;&gt;
    &lt;img src=&quot;http://www.incompleteideas.net/book/ebook/pseudotmp9.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Îµ-greedy æ˜¯ä¸€ç¨®åœ¨ exploration å’Œ exploitation é–“å–å¾—å¹³è¡¡çš„æ–¹æ³•ã€‚Exploration æ˜¯è®“ agent å¤§è†½å˜—è©¦ä¸åŒ actionï¼Œç¢ºä¿èƒ½å¤ å¸æ”¶æ–°çŸ¥ï¼Œè€Œ exploitation æ˜¯è®“ agent ä¿å®ˆæ²¿ç”¨ç¾æœ‰ policyï¼Œè®“å­¸ç¿’éç¨‹æ”¶æ–‚ã€‚æ–¹æ³•å¾ˆç°¡å–®ï¼šÎµ æ˜¯éš¨æ©Ÿé¸æ“‡ action çš„æ©Ÿç‡ï¼Œæ‰€ä»¥å¹³å‡ä¸Šæœ‰ Îµ çš„æ™‚é–“ agent æœƒå˜—è©¦æ–° actionï¼Œè€Œ (1 - Îµ) çš„æ™‚é–“ agent æœƒæ ¹æ“šç¾æœ‰ policy åšæ±ºç­–ã€‚&lt;/p&gt;

&lt;h6&gt;Q Table&lt;/h6&gt;

&lt;p&gt;äº†è§£ Q-learning åŠ Îµ-greedy çš„æ¦‚å¿µå¾Œï¼Œé‚£å¯¦éš›ä¸Šé€™å€‹ Q function å­˜åœ¨å“ªè£¡å‘¢ï¼Ÿä¸€å€‹æ¨¸å¯¦ç„¡è¯çš„æ–¹æ³•å°±æ˜¯æŠŠå„å€‹ state-action pair çš„ Q value å­˜åœ¨ table è£¡ï¼Œç›´æ¥æŸ¥æ‰¾æˆ–æ›´æ–°ï¼Œå³æ˜¯æ‰€è¬‚ Q tableï¼Œä¹Ÿæ˜¯æ¥ä¸‹ä¾†è¦ç¤ºç¯„çš„æ–¹æ³•ã€‚ä¸éé€™å€‹æ–¹æ³•çš„å£è™•æ˜¯ table å¤§å°æœ‰é™ï¼Œä¸é©ç”¨æ–¼ state å’Œ action éå¤šçš„ä»»å‹™ã€‚&lt;/p&gt;

&lt;p&gt;å¦ä¸€å€‹æ–¹æ³•æ˜¯ç”¨ neural network å»é€¼è¿‘ Q functionï¼Œå³ Deep Q-Learningï¼Œå¦‚æ­¤ä¸€ä¾†å°±ä¸æœƒæœ‰å®¹é‡é™åˆ¶äº†ã€‚é€™å€‹æ–¹æ³•æœƒåœ¨ä¹‹å¾Œå¦å¯«æ–‡ç« ä»‹ç´¹ã€‚&lt;/p&gt;

&lt;h6&gt;å¯¦ä½œ&lt;/h6&gt;

&lt;p&gt;åŸå§‹ç¢¼ä¿®æ”¹è‡ª&lt;a href=&quot;https://medium.com/@tuzzer/cart-pole-balancing-with-q-learning-b54c6068d947&quot;&gt;é€™ç¯‡æ–‡ç« &lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å…ˆçµ±æ•´ä¸€ä¸‹ã€‚æˆ‘å€‘çš„ç›®æ¨™æ˜¯å­¸ç¿’åˆ°æœ€ä½³ Q functionï¼Œéç¨‹ä¸­ä»¥ Îµ-greedy æ–¹æ³•èˆ‡ environment äº’å‹•ï¼Œå¾ä¸­ç²å¾— reward ä»¥æ›´æ–° Q table è£¡çš„ Q valueã€‚å…ˆçœ‹ä¸€ä¸‹åŸºæ–¼ Îµ-greedy çš„ policy å®šç¾©ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;choose_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action_space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random_sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# æœ‰ Îµ çš„æ©Ÿç‡æœƒé¸æ“‡éš¨æ©Ÿ action&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;action_space&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sample&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; 
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# å…¶ä»–æ™‚é–“æ ¹æ“šç¾æœ‰ policy é¸æ“‡ actionï¼Œä¹Ÿå°±æ˜¯åœ¨ Q table è£¡ç›®å‰ state ä¸­ï¼Œé¸æ“‡æ“æœ‰æœ€å¤§ Q value çš„ action&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argmax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;q_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å†ä¾†æ˜¯ state çš„è¡¨ç¤ºã€‚åœ¨ &lt;code&gt;CartPole&lt;/code&gt; ç’°å¢ƒè£¡è§€å¯Ÿåˆ°çš„ feature éƒ½æ˜¯é€£çºŒå€¼ï¼Œä¸é©åˆä½œç‚ºä¸€å€‹ table çš„ indexï¼Œå› æ­¤è¦å°‡ä¸€å€‹å€é–“ä¸€å€‹å€é–“çš„å€¼åŒ…åœ¨ä¸€èµ·ç”¨é›¢æ•£æ•¸å€¼è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„ &lt;code&gt;bucket&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_buckets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state_bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;enumerate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# æ¯å€‹ feature æœ‰ä¸åŒçš„åˆ†é…&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state_bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state_bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# æ¯å€‹ feature å€¼çš„ç¯„åœä¸Šä¸‹é™&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# ä½æ–¼ä¸‹é™ï¼Œåˆ†é…ç‚º 0&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# é«˜æ–¼ä¸Šé™ï¼Œåˆ†é…ç‚ºæœ€å¤§å€¼&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_buckets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# ç¯„åœå…§ï¼Œä¾æ¯”ä¾‹åˆ†é…&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_buckets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;tuple&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœ€å¾Œæ˜¯å­¸ç¿’ã€‚å­¸ç¿’éç¨‹ä¸­ç‚ºäº†æ–¹ä¾¿æ”¶æ–‚ï¼Œä¸€äº›åƒæ•¸åƒ Îµ å’Œ learning rate æœƒéš¨è‘—æ™‚é–“éæ¸›ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘å¾å¤§è†½äº‚èµ°ï¼Œåˆ°è¶Šä¾†è¶Šç›¸ä¿¡å·²ç¶“å­¸åˆ°çš„ç¶“é©—ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gym&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'CartPole-v0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# æº–å‚™ Q table&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Environment ä¸­å„å€‹ feature çš„ bucket åˆ†é…æ•¸é‡&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## 1 ä»£è¡¨ä»»ä½•å€¼çš†è¡¨åŒä¸€ stateï¼Œä¹Ÿå°±æ˜¯é€™å€‹ feature å…¶å¯¦ä¸é‡è¦&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_buckets&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;## Action æ•¸é‡ &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action_space&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;## State ç¯„åœ &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;state_bounds&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;zip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation_space&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;low&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation_space&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;high&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;state_bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;state_bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;radians&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;radians&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;## Q tableï¼Œæ¯å€‹ state-action pair å­˜ä¸€å€¼ &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;q_table&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zeros&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_buckets&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_actions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,))&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ä¸€äº›å­¸ç¿’éç¨‹ä¸­çš„åƒæ•¸&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;get_epsilon&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;# epsilon-greedy; éš¨æ™‚é–“éæ¸›&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;get_lr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# learning rate; éš¨æ™‚é–“éæ¸› &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;gamma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.99&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# reward discount factor&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Q-learning&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i_episode&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i_episode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_lr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i_episode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_buckets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state_bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# å°‡é€£çºŒå€¼è½‰æˆé›¢æ•£ &lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;choose_action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action_space&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epsilon&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;info&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;observation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_buckets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state_bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# æ›´æ–° Q table&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;q_next_max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;amax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;q_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# é€²å…¥ä¸‹ä¸€å€‹ state å¾Œï¼Œé æœŸå¾—åˆ°æœ€å¤§ç¸½ reward&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;q_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,)]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reward&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gamma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q_next_max&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q_table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;action&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,)])&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# å°±æ˜¯é‚£å€‹å…¬å¼&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# å‰é€²ä¸‹ä¸€ state &lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next_state&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Episode finished after {} timesteps, total rewards {}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rewards&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€™é‚Šå…¶å¯¦å·å·ä½œå¼Šï¼Œæ‰æœƒçŸ¥é“å“ªå€‹ feature é‡è¦å“ªå€‹ä¸é‡è¦ï¼Œä»¥åŠ state çš„ä¸Šä¸‹é™ã€‚åƒæ•¸ä¹Ÿæ˜¯åŸä½œè€…èª¿æ•´éçš„ã€‚ä¸éå¦‚æ­¤ä¸€ä¾†æ‰èƒ½å±•ç¾å¥½çµæœï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pyliaorachel/openai-gym-cartpole/blob/master/img/q_table.png?raw=true&quot; alt=&quot;Q table&quot;&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°åœ¨è¨“ç·´å¾ŒæœŸï¼Œagent å·²ç¶“å­¸æœƒå¦‚ä½•æœ€å¤§åŒ–è‡ªå·±çš„ rewardï¼Œä¹Ÿå°±æ˜¯ç¶­æŒä½å°è»Šä¸Šçš„æ£’å­äº†ã€‚&lt;/p&gt;

&lt;h2&gt;çµèª&lt;/h2&gt;

&lt;p&gt;AlphaGo å¸¶ä¾†çš„é©šå¥‡è®“äººå€‘æœŸå¾…è‘— Reinforcement Learning çš„ç„¡é™å¯èƒ½æ€§ã€‚æ­¤ç¯‡å¸¶å¤§å®¶ç°¡å–®ç†è§£ Reinforcement Learning çš„å­¸ç¿’éç¨‹å’Œ OpenAI Gym çš„æ“ä½œï¼Œä¸¦ç°¡å–®ç¤ºç¯„å¹¾å€‹æ¼”ç®—æ³•ã€‚é›–èªªç›®å‰ Reinforcement Learning æ‰“é€ å‡ºè¨±å¤šè¶…è¶Šäººé¡çš„éŠæˆ² AIï¼Œä½†åœ¨å…¶ä»–é ˜åŸŸçš„æ‡‰ç”¨ï¼Œä¾‹å¦‚ Computer Visionã€Natural Language Processingï¼Œä»æˆæœæœ‰é™ã€‚æœŸå¾…ä¸ä¹…çš„æœªä¾†ï¼ŒReinforcement Learning èƒ½åœ¨çœŸæ­£å°äººé¡ç¦ç¥‰æœ‰ç›Šçš„é ˜åŸŸæœ‰æ‰€çªç ´ã€‚&lt;/p&gt;

&lt;h2&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.nature.com/articles/nature24270&quot;&gt;Mastering the game of Go without human knowledge&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://deeplearning4j.org/deepreinforcementlearning&quot;&gt;A Beginner&amp;#39;s Guide to Deep Reinforcement Learning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/@curiousily/solving-an-mdp-with-q-learning-from-scratch-deep-reinforcement-learning-for-hackers-part-1-45d1d360c120&quot;&gt;Solving an MDP with Q-Learning from scratchâ€Šâ€”â€ŠDeep Reinforcement Learning for Hackers (Part 1)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.techbridge.cc/2017/11/04/openai-gym-intro-and-q-learning/&quot;&gt;Open AI Gym ç°¡ä»‹èˆ‡ Q learning æ¼”ç®—æ³•å¯¦ä½œ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://morvanzhou.github.io/tutorials/machine-learning/ML-intro/4-02-RL-methods/&quot;&gt;å¼ºåŒ–å­¦ä¹ æ–¹æ³•æ±‡æ€» (Reinforcement Learning)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/@tuzzer/cart-pole-balancing-with-q-learning-b54c6068d947&quot;&gt;Cart-Pole Balancing with Q-Learning&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Fri, 01 Jun 2018 00:00:00 -0700</pubDate>
        <link>/blog/tech/python/2018/06/01/openai-gym-for-reinforcement-learning.html</link>
        <guid isPermaLink="true">/blog/tech/python/2018/06/01/openai-gym-for-reinforcement-learning.html</guid>
        
        <category>Python</category>
        
        <category>PyLadies</category>
        
        <category>OpenAI gym</category>
        
        <category>Reinforcement Learning</category>
        
        
        <category>Blog</category>
        
        <category>Tech</category>
        
        <category>Python</category>
        
      </item>
    
      <item>
        <title>RLDecipher</title>
        <description>&lt;p align=&quot;center&quot;&gt;&lt;img width=&quot;518px&quot; height=&quot;178px&quot; src=&quot;https://github.com/pyliaorachel/reinforcement-learning-decipher/blob/master/img/task.png?raw=true&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/pyliaorachel/reinforcement-learning-decipher&quot;&gt;RLDecipher&lt;/a&gt; is a reinforcement learning model that learns to decipher Caesar ciphers and other types of simple ciphers. The model is essentially a Deep Q-Network written in PyTorch.&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;p align=&quot;center&quot;&gt;&lt;img width=&quot;596px&quot; height=&quot;439px&quot; src=&quot;https://github.com/pyliaorachel/reinforcement-learning-decipher/blob/master/img/model.png?raw=true&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Detailed technical report can be found &lt;a href=&quot;https://github.com/pyliaorachel/reinforcement-learning-decipher/blob/master/report.pdf&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Mon, 21 May 2018 00:00:00 -0700</pubDate>
        <link>/project/ai/2018/05/21/rl-decipher.html</link>
        <guid isPermaLink="true">/project/ai/2018/05/21/rl-decipher.html</guid>
        
        <category>reinforcement-learning</category>
        
        <category>pytorch</category>
        
        
        <category>Project</category>
        
        <category>AI</category>
        
      </item>
    
      <item>
        <title>å¦‚Pyä¼¼Cï¼šPython èˆ‡ C çš„å…±ç”Ÿæ³•å‰‡</title>
        <description>&lt;p&gt;ã€ŒCå›ï¼Œä½ åšäº‹é‚£éº¼å¿«ï¼Œcarry ä¸€ä¸‹æˆ‘çš„ä½œæ¥­å•¦ï¼ã€ã€Œå¥½å•ŠPyæ¡‘ï¼Œé‚£ä½ äººç·£é‚£éº¼å¥½ï¼Œè¨˜å¾—å¹«æˆ‘ä»‹ç´¹å¥³æœ‹å‹å–”ã€‚ã€&lt;/p&gt;

&lt;p&gt;C çš„é«˜æ•ˆèƒ½åŠæ¥è¿‘åº•å±¤ç¡¬é«”çš„ç‰¹æ€§ï¼Œä½¿å…¶æˆç‚ºåµŒå…¥å¼ç³»çµ±é–‹ç™¼çš„é¦–é¸ï¼Œå»æ¥µå°‘æœ‰äººæœƒå­ä¸–åˆ°æ‹¿å®ƒé–‹ç™¼ç¶²é ï¼›Python èªæ³•ç°¡æ½”ä¸”èƒ½å¿«é€Ÿé–‹ç™¼ï¼Œç„¡è«–ç¶²é ã€éŠæˆ²ã€è³‡æ–™ç§‘å­¸çš†æœ‰å…¶æ‡‰ç”¨ï¼Œä½†å…¶é€Ÿåº¦å»æœƒåœ¨å¾ˆå¤šè³‡æºæœ‰é™çš„åœ°æ–¹åƒé±‰ã€‚&lt;/p&gt;

&lt;p&gt;C èˆ‡ Python å¦‚ä½•äº’ç›¸æˆªé•·è£œçŸ­ã€å…±ç”Ÿå…±æ¦®ï¼Œæˆç‚ºç¨‹å¼èªè¨€ç•Œçš„ä¸€å¤§èª²é¡Œã€‚æ­¤ç¯‡å°‡æœƒç°¡ä»‹ä¸€äº› C èˆ‡ Python çš„æ•´åˆæ–¹æ³•ï¼Œè¦‹è­‰Cå›èˆ‡Pyæ¡‘å¦‚ä½•å¾æ­»å°é ­è®Šæˆç›¸äº’æ‰¶æŒçš„å¥½å‹ã€‚&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;p&gt;&lt;em&gt;* è«‹æ³¨æ„ï¼Œä»¥ä¸‹åªé‡å°Python3é€²è¡Œè¬›è§£èˆ‡æ¸¬è©¦ï¼Œä¸¦ä»¥ MacOSX ç‚ºç’°å¢ƒã€‚&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;å‡ä½¿ä½ æ­£åœ¨è·‘ Python çš„å°ˆæ¡ˆï¼Œå»å› ç‚ºå…¶ä¸­æŸå€‹éœ€è¦åšå¤§é‡é‹ç®—çš„ function ç­‰å¾—ä¸è€ç…©ï¼Œåˆä¸æƒ³æ•´å€‹å°ˆæ¡ˆæ”¹ç”¨æ•ˆèƒ½é«˜ä½†è¤‡é›œçš„ C é‡å¯«ï¼Œé‚£éº¼å¦‚ä½•èƒ½åªç¨ç«‹é€™å€‹ function æ”¹ç”¨ C ï¼Œä¸¦å°‡å®ƒç½®å…¥åŸæœ¬çš„ Python å°ˆæ¡ˆå‘¢ï¼Ÿåˆæˆ–æ˜¯ä½ çš„ C å°ˆæ¡ˆè£¡æœ‰ä¸€éƒ¨åˆ†å¯«èµ·ä¾†å¾ˆæ£˜æ‰‹ï¼Œèƒ½ä¸èƒ½æ”¹ç”¨ Python å¿«é€Ÿå¯¦ç¾é€™éƒ¨åˆ†çš„åŠŸèƒ½ï¼Œä¸¦æ’å…¥åŸæœ¬çš„ C å°ˆæ¡ˆï¼Ÿåˆæˆ–è€…ä½ æ‰‹é‚Šæ‹¿åˆ°çš„ç¨‹å¼ç¢¼å°±å‰›å¥½æ˜¯ C æˆ– Pythonï¼Œå¦‚ä½•ç”¨å¦ä¸€å€‹èªè¨€èª¿ç”¨æ‰‹é‚Šçš„ç¾æœ‰ç¨‹å¼è€Œä¸ç”¨é‡æ–°å¯¦ç¾å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†å°‡æœƒç°¡å–®ä»‹ç´¹å¹¾å€‹ Python èª¿ç”¨ C ä»¥åŠ C èª¿ç”¨ Python çš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;p&gt;GitHub åŸå§‹ç¢¼ï¼š&lt;a href=&quot;https://github.com/pyliaorachel/python-c-mixing&quot;&gt;https://github.com/pyliaorachel/python-c-mixing&lt;/a&gt;&lt;/p&gt;

&lt;h2&gt;Python èª¿ç”¨ C&lt;/h2&gt;

&lt;p&gt;å‡è¨­æˆ‘å€‘æœ‰ä¸€å€‹å¾ˆèŠ±æ™‚é–“çš„ function å«åš &lt;code&gt;slow_calc&lt;/code&gt;ï¼Œæƒ³ç”¨æ•ˆèƒ½é«˜çš„ C å¯¦ç¾ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;slow_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»¥ä¸‹ç°¡ä»‹å¹¾å€‹å¯ä»¥è®“ Python èª¿ç”¨é€™å€‹ C function çš„ library æˆ–å·¥å…·ã€‚&lt;/p&gt;

&lt;h3&gt;&lt;a href=&quot;https://docs.python.org/3/c-api/intro.html&quot;&gt;Python/C API&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.python.org/3/extending/building.html&quot;&gt;Python extension module&lt;/a&gt; æ˜¯ä»¥ Python ä»¥å¤–çš„èªè¨€å»ºç«‹ä¸”èƒ½å¤ è®“ Python åŒ¯å…¥çš„ moduleã€‚Python/C API å³æ˜¯ C è£¡èƒ½å¤ å»ºç«‹ Python extension module çš„åª’ä»‹ï¼Œåªéœ€è¦å¼•å…¥ &lt;code&gt;Python.h&lt;/code&gt; é€™å€‹æ¨™é ­æª”å³å¯é–‹å§‹æ‰‹åˆ»ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;Python.h&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€™é‚Šæ³¨æ„ï¼Œé€™äº› extension module éƒ½æ˜¯é‡å° CPythonï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹ä»¥ C å¯¦ç¾çš„ Python ç›´è­¯å™¨ã€‚&lt;/p&gt;

&lt;p&gt;ç‚ºäº†å»ºç«‹ &lt;code&gt;slow_calc&lt;/code&gt; function çš„æ¥å£ï¼Œæˆ‘å€‘æŠŠå®ƒå¯«é€² &lt;code&gt;speedup_performance.c&lt;/code&gt; æª”ä¸¦æ‰“åŒ…æˆ Python extension moduleï¼Œå¤§è‡´ä¸Šæœ‰äº”å€‹æ­¥é©Ÿï¼š&lt;/p&gt;

&lt;h5&gt;Step 1: åŒ…è£ Function&lt;/h5&gt;

&lt;p&gt;Python è£¡çš„ä»»ä½• type éƒ½å°æ‡‰åˆ° C è£¡çš„ &lt;code&gt;PyObject&lt;/code&gt;ï¼Œæ‰€ä»¥æˆ‘å€‘è¦æŠŠåŸæœ¬çš„ function åŒ…è£ä¸€ä¸‹ï¼Œè®“åƒæ•¸å’Œå›å‚³å€¼çš†ç‚º &lt;code&gt;PyObject&lt;/code&gt;ã€‚é€™å€‹åŒ…è£å¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç¨®åƒæ•¸å½¢å¼ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;(PyObject *self, PyObject *args)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;(PyObject *self, PyObject *args, PyObject *kwargs)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;(PyObject *self)&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;code&gt;args&lt;/code&gt; æ˜¯ positional argumentsï¼Œ&lt;code&gt;kwargs&lt;/code&gt; æ˜¯ keyword argumentsã€‚è®“æˆ‘å€‘è©¦è©¦æœ‰ keyword argument çš„ä¾‹å­ï¼ŒæŠŠå‰é¢å®šç¾©çš„ &lt;code&gt;slow_calc&lt;/code&gt; function åŒ…æˆ &lt;code&gt;_slow_calc&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyObject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;_slow_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PyObject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyObject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyObject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kwargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// åƒæ•¸å€¼
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// kwlist è£¡å­˜æ”¾ keyword çš„åå­—ï¼Œä»¥ NULL çµæŸ
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kwlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// å›å‚³å€¼
&lt;/span&gt;    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// PyArg_ParseTupleAndKeywords æœƒå˜—è©¦æŠŠæ¥æ”¶çš„ args åŠ kwargs 
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// åŒ…æˆæˆ‘å€‘è¦çš„ formatï¼Œä¹Ÿå°±æ˜¯ &quot;i|ii&quot;
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// i å³ intï¼Œnon-optional å’Œ optional arguments ä»¥ | å€éš”
&lt;/span&gt;    &lt;span class=&quot;c1&quot;&gt;// æˆåŠŸåŒ…å¥½çš„å€¼å­˜åœ¨ xï¼Œaï¼Œb ä¸­ï¼Œæ‰“åŒ…å¤±æ•—å‰‡æ•´å€‹ function å›å‚³ 0ï¼Œä¸å†ç¹¼çºŒä¸‹å»
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PyArg_ParseTupleAndKeywords&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kwargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;i|ii&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kwlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// å‘¼å«åŸ functionï¼Œå‚³å…¥åŒ…å¥½çš„å€¼ 
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;slow_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// æŠŠå›å‚³å€¼ç”¨ Py_BuildValue åŒ…æˆ PyObject ä»¥å›é€çµ¦ Python
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Py_BuildValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;i&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;Step 2: å»ºç«‹ Module&amp;#39;s Method Table&lt;/h5&gt;

&lt;p&gt;æŠŠ module è£¡çš„ function éƒ½ä¸€ä¸€åŒ…å¥½å¾Œï¼Œå°±è¦å»ºç«‹ä¸€å€‹ module&amp;#39;s method tableï¼Œä¹Ÿå°±æ˜¯é€™å€‹ module çš„ method åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// æ¯ç­†å½¢å¼ç‚º { name, method, flags, doc }
// å³ { åç¨±, å°æ‡‰å‡½æ•¸, å“ªç¨® argument å½¢å¼, æè¿° }
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyMethodDef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SpeedupPerformanceMethods&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;slow_calc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_slow_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;METH_VARARGS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;METH_KEYWORDS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;A slow calculation method.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ä»¥ NULL ä½œçµ
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€™é‚Šçš„ &lt;code&gt;flags&lt;/code&gt; å¯æä¾›çš„å€¼å¯åƒç…§&lt;a href=&quot;https://docs.python.org/3/c-api/structures.html#c.PyMethodDef&quot;&gt;æ–‡ä»¶&lt;/a&gt;ï¼Œä¸»è¦æ˜¯å‘ŠçŸ¥ arguments æœƒå¦‚ä½•è¢«å‚³å…¥ã€‚&lt;/p&gt;

&lt;h5&gt;Step 3: å®šç¾© Module çµæ§‹&lt;/h5&gt;

&lt;p&gt;æ¥è‘—å†å®šç¾© moduleï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// å½¢å¼ç‚º { base, name, doc, size, module's method table }
// å³ { PyModuleDef_HEAD_INIT, åç¨±, æè¿°, åˆ†é… memory å¤§å°, method åˆ—è¡¨ }
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyModuleDef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;speedup_performance_module&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PyModuleDef_HEAD_INIT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;speedup_performance&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&quot;A module containing methods with faster performance.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// global state
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;SpeedupPerformanceMethods&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç¬¬ä¸€å€‹ &lt;code&gt;base&lt;/code&gt; çš†è¨­ç‚º &lt;code&gt;PyModuleDef_HEAD_INIT&lt;/code&gt; å³å¯ã€‚&lt;code&gt;size&lt;/code&gt; å‰‡æ˜¯æ¯å€‹ &lt;code&gt;module&lt;/code&gt; å¯è¢«åˆ†é…å­˜æ”¾ &lt;code&gt;module state&lt;/code&gt; çš„ç©ºé–“å¤§å°ï¼Œè¨­ç‚º &lt;code&gt;-1&lt;/code&gt; å‰‡ç‚º &lt;code&gt;global state&lt;/code&gt;ã€‚è©³å¯åƒç…§&lt;a href=&quot;https://docs.python.org/3/c-api/module.html#c.PyModuleDef&quot;&gt;æ–‡ä»¶&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h5&gt;Step 4: å®šç¾© Module Initialization Method&lt;/h5&gt;

&lt;p&gt;ç•¶ Python import é€™å€‹ module æ™‚æœƒå‘¼å«ä¸€å€‹ initialization methodï¼Œé€™å€‹ method å¿…é ˆä»¥ &lt;code&gt;PyInit_&amp;lt;module&amp;gt;&lt;/code&gt; å½¢å¼å‘½åï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// PyMODINIT_FUNC é™¤äº†å›å‚³ PyObjectï¼Œé‚„æœƒè™•ç†ä¸åŒå¹³å°é–“çš„ linkage å•é¡Œ
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PyMODINIT_FUNC&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;PyInit_speedup_performance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyModule_Create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;speedup_performance_module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€™å€‹ initialization method è¢«å‘¼å«å¾Œï¼Œæœƒå»ºç«‹ä¸€å€‹ module objectï¼Œå…§å« method åˆ—è¡¨åˆ—å‡ºçš„ functionã€‚é€™æ¨£ Python å°±èƒ½ä½¿ç”¨ C è£¡æä¾›çš„ function äº†ï¼&lt;/p&gt;

&lt;h5&gt;Step 5: å»ºç«‹ Extension Module&lt;/h5&gt;

&lt;p&gt;ä¸Šè¿°ç¨‹å¼ç¢¼å¯«å®Œå¾Œå­˜åœ¨ &lt;code&gt;speedup_performance.c&lt;/code&gt;è£¡ã€‚æ¥è‘—è—‰è‘— &lt;code&gt;setup.py&lt;/code&gt; å’Œ &lt;code&gt;Distutils&lt;/code&gt; æŠŠ extension module çœŸçš„åšå‡ºä¾†ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;distutils.core&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Extension&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;speedup_performance_module&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Extension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'speedup_performance'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                       &lt;span class=&quot;n&quot;&gt;sources&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'speedup_performance.c'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'SpeedupPerformance'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'A package containing modules for speeding up performance.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;ext_modules&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;speedup_performance_module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶å¾Œä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;python3 setup.py build_ext --inplace
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æ­¤æœƒæœ‰ä¸€å€‹ &lt;code&gt;*.so&lt;/code&gt; å‡ºç¾åœ¨ç•¶å‰ç›®éŒ„ï¼Œé€™å°±æ˜¯ Python å¯ä»¥ä½¿ç”¨çš„ shared libraryã€‚è®“æˆ‘å€‘æ‰“é–‹ Python ç”¨ç”¨çœ‹:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;speedup_performance&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;slow_calc&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slow_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;a href=&quot;https://docs.python.org/3.6/library/ctypes.html&quot;&gt;ctypes&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;ctypes&lt;/code&gt; æ˜¯ Python æä¾›çš„ä¸€å€‹ libraryï¼Œå¯ä»¥åœ¨ Python ä¸­åŒ¯å…¥ä¸€äº›å¤–éƒ¨ dynamic-link library (DLL) æˆ– shared libraryï¼Œä¾†èª¿ç”¨å…¶ä¸­çš„ functionã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ˜¯å·²ç¶“å­˜åœ¨çš„ libraryï¼Œå¯ä»¥ç›´æ¥å¾ä¸‹é¢çš„ç¬¬äºŒæ­¥é–‹å§‹ã€‚ç¾åœ¨å‡è¨­æˆ‘å€‘æƒ³æŠŠå‰é¢æåˆ°è‡ªå·±å¯«çš„ï¼Œå¾ˆèŠ±æ™‚é–“é‹ç®—çš„ &lt;code&gt;slow_calc&lt;/code&gt; function æ‰“åŒ…çµ¦ &lt;code&gt;ctypes&lt;/code&gt; èª¿ç”¨ï¼Œä¸”é€™å€‹ function å¯«åœ¨ &lt;code&gt;speedup_performance.c&lt;/code&gt; è£¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;code&gt;ctypes&lt;/code&gt; ç°¡å–®ä¸‰æ­¥é©Ÿï¼š&lt;/p&gt;

&lt;h5&gt;Step 1: å»ºç«‹ Shared Library&lt;/h5&gt;

&lt;p&gt;é¦–å…ˆç”¨ gcc å»ºç«‹ shared libraryï¼Œç”¢ç”Ÿ &lt;code&gt;speedup_performance.so&lt;/code&gt; æª”ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;gcc -shared -fPIC speedup_performance.c -o speedup_performance.so
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;Step 2: åŒ¯å…¥ Library&lt;/h5&gt;

&lt;p&gt;æ¥è‘—åœ¨ Python ç”¨ &lt;code&gt;ctypes&lt;/code&gt; æä¾›çš„ function ä¾†åŒ¯å…¥å‰›å‰›å»ºç«‹çš„ &lt;code&gt;so&lt;/code&gt; æª”ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;ctypes&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cdll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LoadLibrary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'./speedup_performance.so'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æ­¤ä¸€ä¾† library ä¸­çš„ function å°±èƒ½ä»¥ &lt;code&gt;m.func()&lt;/code&gt; å–ç”¨ã€‚&lt;/p&gt;

&lt;h5&gt;Step 3: å‘¼å« Function&lt;/h5&gt;

&lt;p&gt;èª¿ç”¨çš„æ™‚å€™ï¼Œéœ€è¦å‚³å…¥å°æ‡‰åŸ C function ä¸­çš„ parameter typesã€‚&lt;a href=&quot;https://docs.python.org/3.6/library/ctypes.html#fundamental-data-types&quot;&gt;é€™é‚Š&lt;/a&gt;æœ‰åˆ—å‡ºæ¯å€‹ C type å°æ‡‰çš„ ctypes typeï¼Œä¾‹å¦‚æˆ‘å€‘éœ€è¦å‚³å…¥çš„ &lt;code&gt;int&lt;/code&gt; å°æ‡‰åˆ° &lt;code&gt;c_int&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slow_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c_int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c_int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c_int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;a href=&quot;http://www.swig.org/Doc3.0/Contents.html#Contents&quot;&gt;SWIG&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;æ¯”èµ·å‰å…©è€…ï¼ŒSWIG (Simplified Wrapper and Interface Generator) æ˜¯ä¸€å€‹æ›´å…¨é¢çš„å»ºç«‹ C/C++ interface çš„å·¥å…·ï¼Œæ”¯æ´å¦‚ Pythonï¼ŒPerlï¼ŒRuby ç­‰å¤šç¨®èªè¨€ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨&lt;a href=&quot;http://www.swig.org/Doc3.0/Preface.html#Preface_installation&quot;&gt;å®‰è£&lt;/a&gt;å¥½ SWIG å¾Œï¼Œå†ä¾†ä¸€æ¨£å˜—è©¦æ‰“åŒ…æˆ‘å€‘çš„ &lt;code&gt;slow_calc&lt;/code&gt; functionã€‚é€™æ¬¡æˆ‘å€‘æ–¹ä¾¿èµ·è¦‹ï¼ŒæŠŠ function ç›´æ¥å¯«åœ¨ &lt;code&gt;speedup_performance.h&lt;/code&gt; è£¡ï¼Œç­‰ä¸€ä¸‹éœ€è¦ includeã€‚&lt;/p&gt;

&lt;p&gt;å¤§è‡´ä¸Šæœ‰å››æ­¥é©Ÿï¼š&lt;/p&gt;

&lt;h5&gt;Step 1: å»ºç«‹ Interface File&lt;/h5&gt;

&lt;p&gt;é¦–å…ˆè¦æœ‰ä¸€å€‹æè¿° interface çš„æª”æ¡ˆï¼Œç¿’æ…£å‘½åç‚º &lt;code&gt;*.i&lt;/code&gt; æˆ– &lt;code&gt;*.swg&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘å»ºç«‹ä¸€å€‹ &lt;code&gt;speedup_performance.i&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;/* å®šç¾© module åç¨± */
%module speedup_performance

/* åœ¨é€™å€‹å€å¡Šçš„ç¨‹å¼ç¢¼æœƒåŸå°ä¸å‹•ç½®å…¥å¾…æœƒç”¢ç”Ÿçš„ C wrapper */
%{
#include &quot;speedup_performance.h&quot;
%}

/* å‘Šè¨´ SWIG ä½ å®£å‘Šçš„ function æˆ– variable */
int slow_calc(int x, int a = 0, int b = 0);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸Šé¢è¢«åŒ…åœ¨ &lt;code&gt;%{ ... %}&lt;/code&gt; è£¡çš„ç¨‹å¼ç¢¼ï¼Œä¸»è¦æ˜¯ä¸€äº› header file æˆ–å…¶ä»– declarationï¼›é€™äº›å®£å‘Šä¸æœƒè¢« compileï¼Œè€Œæ˜¯ç›´æ¥ç½®å…¥ä¸‹ä¸€æ­¥ç”¢ç”Ÿçš„ C wrapper æª”ã€‚ä½†ä¸‹é¢çš„å€å¡Šä¸æ˜¯ä¹Ÿæœ‰å·®ä¸å¤šçš„å®£å‘Šå—ï¼Ÿç‚ºä»€éº¼éœ€è¦é‡è¤‡ï¼Ÿé€™éº¼åšæ˜¯å› ç‚ºä¸‹é¢å€å¡Šçš„å®£å‘Šæ˜¯è®“ SWIG åœ¨ wrapper file è£¡å»ºç«‹ä¸€äº› wrapper function ç”¨çš„ï¼Œè€Œä¸æ˜¯ç”¨ä¾†èˆ‡åŸæœ¬å¯«çš„ function é€£æ¥ã€‚æ‰€ä»¥è¦åœ¨ wrapper file é‡æ–°ç½®å…¥ &lt;code&gt;%{ ... %}&lt;/code&gt; è£¡çš„å®£å‘Šï¼Œwrapper file è£¡æ‰èƒ½èª¿ç”¨åŸ functionï¼Œä¹Ÿæ‰å¯ä»¥ç¢ºä¿åœ¨ç¬¬ä¸‰æ­¥å»ºç«‹ shared library çš„æ™‚å€™çš„ linkage å¯ä»¥æˆåŠŸã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–æˆ‘å€‘åŸæœ¬çš„ &lt;code&gt;slow_calc&lt;/code&gt; è£¡ä¸¦æ²’æœ‰ default argument ï¼ˆå›  C æœ¬èº«ä¸¦ä¸æ€éº¼æ”¯æ´ï¼‰ï¼Œä½†æ˜¯ SWIG æ¥å— &lt;a href=&quot;http://www.swig.org/Doc1.3/SWIGPlus.html#SWIGPlus_default_args&quot;&gt;default argument&lt;/a&gt;ï¼Œæ‰€ä»¥æˆ‘å€‘åœ¨é€™è£¡æ·»åŠ äº†ä¸€äº› default valuesã€‚&lt;/p&gt;

&lt;h6&gt;Step 2: ç”¢ç”Ÿ Wrapper File&lt;/h6&gt;

&lt;p&gt;æœ‰äº† interface çš„è³‡è¨Šå¾Œï¼Œå°±å¯ä»¥è«‹ SWIG å»ºç«‹å¯ä»¥æ‹¿ä¾†åš extension module çš„ &lt;code&gt;speedup_performance.py&lt;/code&gt; å’Œ wrapper file &lt;code&gt;speedup_performance_wrap.c&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;swig -python speedup_performance.i
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æˆ–æ˜¯å»ºç«‹ keyword argument å½¢å¼ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;swig -python -keyword speedup_performance.i
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;Step 3: å»ºç«‹ Shared Library&lt;/h5&gt;

&lt;p&gt;é€™é‚ŠåŒä¸Šé¢ &lt;code&gt;Python/C API&lt;/code&gt; ç¯„ä¾‹ï¼Œç”¨ &lt;code&gt;setup.py&lt;/code&gt; å’Œ &lt;code&gt;Distutils&lt;/code&gt; å»ºç«‹ shared libraryï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;distutils.core&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Extension&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Extension module name è¦æœ‰åº•ç·šå‰ç¶´&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;speedup_performance_module&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Extension&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'_speedup_performance'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                       &lt;span class=&quot;n&quot;&gt;sources&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'speedup_performance_wrap.c'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'SpeedupPerformance'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;description&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'A package containing modules for speeding up performance.'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;ext_modules&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;speedup_performance_module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€™é‚Šæ³¨æ„ extension module åç¨±å¿…é ˆæœ‰åº•ç·šå‰ç¶´ï¼Œé€™æ˜¯&lt;a href=&quot;http://www.swig.org/Doc1.3/Python.html#Python_nn6&quot;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;ä¸Šæåˆ°çš„å‘½åè¦å‰‡ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å€‹æŒ‡ä»¤å»ºç«‹ &lt;code&gt;*.so&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;python3 setup.py build_ext --inplace
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;Step 4: åŒ¯å…¥ Library &amp;amp; èª¿ç”¨ Function&lt;/h5&gt;

&lt;p&gt;æœ‰äº† Step 2 çš„ &lt;code&gt;*.py&lt;/code&gt; å’Œ Step 3 çš„ &lt;code&gt;*.so&lt;/code&gt;ï¼Œå°±å¯ä»¥æˆåŠŸèª¿ç”¨ &lt;code&gt;slow_calc&lt;/code&gt; function äº†ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;speedup_performance&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;slow_calc&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;slow_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;C èª¿ç”¨ Python&lt;/h2&gt;

&lt;h3&gt;&lt;a href=&quot;https://docs.python.org/3/c-api/intro.html&quot;&gt;Python/C API&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;Python/C API&lt;/code&gt; ä¸€æ¨£æ˜¯æœ€åŸºç¤çš„è§£æ³•ã€‚&lt;/p&gt;

&lt;p&gt;ç¾åœ¨å‡è¨­æˆ‘å€‘æœ‰å€‹å¯«æ³•å¾ˆè¤‡é›œï¼Œå»ä¸éœ€åœ¨æ„æ•ˆèƒ½çš„ &lt;code&gt;complex_calc&lt;/code&gt; function æƒ³ç”¨ Python å¯¦ç¾ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;complex_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è®“æˆ‘å€‘å…ˆæŠŠä¸Šè¿° &lt;code&gt;complex_calc&lt;/code&gt; function å¯«é€² &lt;code&gt;speedup_dev.py&lt;/code&gt; è£¡ã€‚ç„¶å¾Œæˆ‘å€‘åœ¨ &lt;code&gt;main.c&lt;/code&gt; è£¡å…ˆç†æ‰€ç•¶ç„¶åœ°ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;Python.h&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¥è‘—ä¸‰æ­¥é©Ÿèª¿ç”¨é€™å€‹ functionï¼š&lt;/p&gt;

&lt;h5&gt;Step 1: æ‰“åŒ… Function&lt;/h5&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;complex_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PyObject&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pModule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pKargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pRes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// åŒ¯å…¥ `speedup_dev` module &amp;amp; `complex_calc` function 
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;pModule&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyImport_Import&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PyUnicode_FromString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;speedup_dev&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pFunc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyObject_GetAttrString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pModule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;complex_calc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// æŠŠ arguments æ‰“åŒ…æˆ PyObject
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;pArgs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Py_BuildValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;(i)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pKargs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Py_BuildValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;{s:i, s:i}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// å‘¼å« function 
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;pRes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyObject_Call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pKargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// æª¢æŸ¥æœ‰æ²’æœ‰å‘¼å«å¤±æ•—ï¼Œæ²’æœ‰çš„è©±æŠŠå›å‚³å€¼å¾ PyObject åŒ…å› C type 
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pRes&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyLong_AsLong&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pRes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// è™•ç†ä¸€ä¸‹ memory allocation 
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;Py_DECREF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pModule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Py_DECREF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Py_DECREF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pArgs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Py_DECREF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pKargs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Py_DECREF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pRes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å†æ¬¡é‡è¤‡ï¼Œè·Ÿ Python æºé€šçš„å€¼çš†ç‚º &lt;code&gt;PyObject&lt;/code&gt; typeï¼Œæ‰€ä»¥éœ€è¦è½‰æ› argument å’Œ return valueã€‚&lt;/p&gt;

&lt;p&gt;é€™é‚Šæ¯”è¼ƒéº»ç…©çš„æ˜¯è¦è‡ªå·±&lt;a href=&quot;https://docs.python.org/3.6/extending/extending.html#reference-counting-in-python&quot;&gt;è™•ç† memory allocation&lt;/a&gt; ã€‚æ¯ç•¶ä¸€å€‹ &lt;code&gt;PyObject&lt;/code&gt; è¢«å‰µå»ºï¼Œå®ƒå°±æœƒæœ‰ä¸€å€‹ reference countï¼Œä¹Ÿå°±æ˜¯æœ‰å¤šå°‘èª¿ç”¨è€…æœ‰è²¬ä»»å»ç®¡ç†é€™å€‹ &lt;code&gt;PyObject&lt;/code&gt;ï¼›ç•¶ reference count è®Šç‚º 0ï¼Œé€™å€‹ &lt;code&gt;PyObject&lt;/code&gt; å°±æœƒè¢« freeã€‚å¦‚æœæ ¹æœ¬æ²’äººåœ¨ç®¡ç†é€™å€‹ &lt;code&gt;PyObject&lt;/code&gt;ï¼Œ reference count å»ä¸ç‚º 0ï¼Œå°±æœƒæœ‰ memory leak çš„å•é¡Œã€‚æ‰€ä»¥æˆ‘å€‘è¦è¨˜å¾—åœ¨åˆ©ç”¨å®Œé€™äº› &lt;code&gt;PyObject&lt;/code&gt; å¾Œå‘¼å« &lt;code&gt;Py_DECREF&lt;/code&gt; æ¸›å°‘ reference countï¼ŒæŸäº›æƒ…æ³ä¸‹è©²å¢åŠ æ™‚ä¹Ÿè¦å‘¼å« &lt;code&gt;Py_INCREF&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä½† reference count çš„&lt;a href=&quot;https://docs.python.org/3.6/extending/extending.html#reference-counting-in-python&quot;&gt;è¦å‰‡&lt;/a&gt;æœ‰é»è¤‡é›œï¼Œè‡ªå·±è™•ç†å¾ˆå®¹æ˜“ bug æ»¿å¤©é£›ï¼ˆæˆ‘å¯èƒ½ä¹Ÿæœ‰ bug...ï¼‰ï¼Œé€™ä¹Ÿæ˜¯ä½¿ç”¨ &lt;code&gt;Python/C API&lt;/code&gt; çš„é›£é»ä¹‹ä¸€ã€‚&lt;/p&gt;

&lt;h5&gt;Step 2: å‘¼å« Function&lt;/h5&gt;

&lt;p&gt;æ‰“åŒ…å¥½ä¹‹å¾Œï¼Œæˆ‘å€‘å°±æœ‰ä¸€å€‹å¯ä»¥å‘¼å«çš„ C function äº†ã€‚ä¸éåœ¨èª¿ç”¨ä¹‹å‰ï¼Œå¾—å…ˆåšä¸€é»è¨­ç½®ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Initialize Python ç›´è­¯å™¨ 
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;Py_Initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// è¨­ç½® Python search path 
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;PySys_SetPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Py_DecodeLocale&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// å‘¼å« function
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;complex_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// é‡‹æ”¾ Python ç›´è­¯å™¨ä½”ç”¨è³‡æº
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;Py_Finalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é™¤äº†ä½¿ç”¨å‰å…ˆ initializeï¼Œä½¿ç”¨å¾Œ finalize å¤–ï¼Œé‚„è¦è¨˜å¾—è¨­ä¸€ä¸‹ Python search pathï¼Œå¦å‰‡æœƒæœä¸åˆ° moduleã€‚&lt;/p&gt;

&lt;h5&gt;Step 3: ç·¨è­¯ &amp;amp; åŸ·è¡Œç¨‹å¼&lt;/h5&gt;

&lt;p&gt;ç”¨ gcc ç·¨è­¯ç¨‹å¼ï¼Œç”¢ç”Ÿ &lt;code&gt;main&lt;/code&gt; åŸ·è¡Œæª”ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;gcc &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;python3-config --cflags --ldflags&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; main.c -o main
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€™é‚Šç‚ºäº†èƒ½å¤ å•Ÿç”¨ Python C extensionï¼Œéœ€è¦å‚³å…¥ä¸€äº›å¿…è¦åƒæ•¸ï¼Œè€Œ &lt;a href=&quot;https://helpmanual.io/man1/python3-config/&quot;&gt;&lt;code&gt;python3-config&lt;/code&gt;&lt;/a&gt; å³æ˜¯å¹«æˆ‘å€‘å°å‡ºé€™äº›åƒæ•¸å‚³çµ¦ gccã€‚&lt;/p&gt;

&lt;p&gt;æ¥è‘—åŸ·è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;./main
&lt;span class=&quot;gp&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœä¸å¹¸åœ¨ç·¨è­¯æ™‚å ±éŒ¯ï¼Œä¾‹å¦‚ï¼š &lt;/p&gt;

&lt;p&gt;&lt;code&gt;ld: library not found for -lpython3.6m&lt;/code&gt;  &lt;/p&gt;

&lt;p&gt;é‚£å¾ˆæœ‰å¯èƒ½æ˜¯ç³»çµ±å®‰è£çš„ Python å’Œä½ è‡ªå·±å®‰è£çš„ Python è®“è·¯å¾‘ç”¢ç”Ÿæ··æ·†ã€‚ &lt;/p&gt;

&lt;p&gt;è§£æ±ºè¾¦æ³•å¦‚&lt;a href=&quot;https://docs.python.org/3.6/extending/embedding.html#compiling-and-linking-under-unix-like-systems&quot;&gt;æ­¤æ–‡ä»¶&lt;/a&gt;æ‰€å»ºè­°ï¼Œåœ¨ &lt;code&gt;python3-config&lt;/code&gt; å‰åŠ ä¸Šçµ•å°è·¯å¾‘ã€‚æœ‰è£ Anaconda çš„å¯èƒ½æ˜¯ &lt;code&gt;/anaconda3/bin/python3-config&lt;/code&gt;ï¼Œè‡ªå·±è£ Python çš„å¯èƒ½æ˜¯ &lt;code&gt;/usr/local/bin/python3-config&lt;/code&gt;ï¼Œç³»çµ±é è¨­çš„å¯èƒ½æ˜¯ &lt;code&gt;/usr/bin/python3-config&lt;/code&gt; ç­‰ç­‰ï¼Œæœ‰éŒ¯å³å˜—è©¦å¦ä¸€ç¨®ã€‚ &lt;/p&gt;

&lt;p&gt;ç•¶ç„¶ï¼Œå¯¦éš›è·¯å¾‘å› ä½œæ¥­ç³»çµ±å’Œå®‰è£æƒ…æ³è€Œç•°ï¼Œè«‹å…ˆè¡Œç¢ºèªè·¯å¾‘ä¸­æ˜¯å¦æœ‰ &lt;code&gt;python3-config&lt;/code&gt; æˆ– &lt;code&gt;pythonX.Y-config&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3&gt;&lt;a href=&quot;http://docs.cython.org/en/latest/&quot;&gt;Cython&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;ç›¸ä¿¡å¤§å®¶æœ‰ç”Ÿä¹‹å¹´ä¸€å®šéƒ½ä¸æƒ³è‡ªå·±è™•ç†ä»€éº¼ reference count çš„å•é¡Œã€‚Cython æ˜¯ä¸€å€‹è·Ÿ Python å¯«èµ·ä¾†å¾ˆåƒçš„èªè¨€ï¼Œèƒ½å¤ æ–¹ä¾¿ä¸”å¿«é€Ÿçš„å»ºç«‹ C çš„ extensionï¼Œä¸åªé”åˆ° Python çš„é–‹ç™¼é€Ÿåº¦ï¼Œäº¦èƒ½é”åˆ° C çš„æ•ˆèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;å…ˆå®‰è£èµ·ä¾†ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;pip3 install Cython
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å‡è¨­æˆ‘å€‘æœ‰å€‹ &lt;code&gt;complex_and_slow_calc&lt;/code&gt; function ä¸åªå¯«èµ·ä¾†è¤‡é›œï¼Œæ•ˆèƒ½åˆä½ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;complex_and_slow_calc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Cython å¯ä»¥å®šç¾©é‡å° Pythonã€Cã€æˆ–å…©è€…çš„ functionã€‚æˆ‘å€‘æŠŠä¸Šè¿° &lt;code&gt;complex_and_slow_calc&lt;/code&gt; function ç”¨ä¸‰ç¨®å¯«æ³•ä¸€èµ·å¯¦ç¾ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹å››æ­¥é©Ÿèª¿ç”¨ï¼š&lt;/p&gt;

&lt;h5&gt;Step 1: ç”¨ Cython å–ä»£ Python&lt;/h5&gt;

&lt;p&gt;å…ˆæŠŠ Cython å¯«åœ¨ &lt;code&gt;speedup_dev_and_performance.pyx&lt;/code&gt; è£¡ï¼Œå¯«æ³•èˆ‡ Python æ¥µç‚ºç›¸ä¼¼ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;math&lt;/span&gt; 


&lt;span class=&quot;c&quot;&gt;# Python&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;complex_and_slow_calc_p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# C&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cdef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;complex_and_slow_calc_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Python &amp;amp; C&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cpdef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;complex_and_slow_calc_cp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;math&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¾ç…§ä½ çš„ function éœ€è¦è¢« Python  æˆ– C æˆ–å…©è€…èª¿ç”¨ï¼Œæœ‰ä»¥ä¸Šä¸‰ç¨®å¯«æ³•ï¼Œ&lt;code&gt;def&lt;/code&gt;ã€&lt;code&gt;cdef&lt;/code&gt;ã€å’Œ &lt;code&gt;cpdef&lt;/code&gt;ï¼Œä¾†å»ºç«‹ Python function æˆ– C functionï¼›C function çš„å„ªåŒ–æ¯”è¼ƒå¤šï¼Œé€Ÿåº¦ä¹Ÿæ¯”è¼ƒå¿«ã€‚&lt;a href=&quot;http://notes-on-cython.readthedocs.io/en/latest/function_declarations.html&quot;&gt;é€™é‚Š&lt;/a&gt;æœ‰æ¯”è¼ƒè©³ç´°çš„è§£é‡‹ã€‚ç•¶ç„¶ï¼Œä½ åªéœ€è¦é‡å°éœ€æ±‚é¸ä¸€å€‹å¯«å°±å¥½ï¼Œé€™é‚ŠåŒæ™‚ç¤ºç¯„ä¸‰ç¨®å¯«æ³•ï¼Œå‘½åç”¨ &lt;code&gt;_p / _c / _cp&lt;/code&gt; å¾Œç¶´ä¾†å€åˆ¥ã€‚C function çš„ argument åŠ return value éƒ½è¦æ˜ç¢ºå®šç¾© typeï¼Œè·Ÿ C åŒç†ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœåœ¨ &lt;code&gt;def&lt;/code&gt; å¾ŒåŠ ä¸Š &lt;code&gt;public&lt;/code&gt;ï¼Œé‚£éº¼é€™å€‹ function å°±æœƒå‡ºç¾åœ¨ç”¢ç”Ÿçš„ &lt;code&gt;*.h&lt;/code&gt; æ¨™é ­æª”è£¡ï¼Œæ‰€ä»¥å¦‚æœæœ‰æƒ³è¦çµ¦å¤–éƒ¨ C æª”èª¿ç”¨çš„ functionï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘ç­‰ä¸€ä¸‹è¦åšçš„äº‹ï¼Œä¾¿èƒ½åŠ ä¸Š &lt;code&gt;public&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h5&gt;Step 2: å»ºç«‹ Extension&lt;/h5&gt;

&lt;p&gt;åŒæ¨£ä½¿ç”¨ &lt;code&gt;setup.py&lt;/code&gt; å’Œ &lt;code&gt;Distutils&lt;/code&gt; ä¾†å»ºç«‹ extensionï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;distutils.core&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Cython.Build&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cythonize&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ext_modules&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cythonize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'speedup_dev_and_performance.pyx'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸‹æŒ‡ä»¤ï¼Œç”¢ç”Ÿ &lt;code&gt;*.so&lt;/code&gt;ï¼Œ&lt;code&gt;*.c&lt;/code&gt;ï¼Œå’Œ &lt;code&gt;*.h&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;$ python3 setup.py build_ext --inplace
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;Step 3: å‘¼å« Function&lt;/h5&gt;

&lt;p&gt;æœ‰äº†æ¨™é ­æª” &lt;code&gt;speedup_dev_and_performance.h&lt;/code&gt;ï¼Œæˆ‘å€‘å»ºç«‹ä¸€å€‹ &lt;code&gt;main.c&lt;/code&gt; ä¾†èª¿ç”¨ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;Python.h&amp;gt;
#include &quot;speedup_dev_and_performance.h&quot;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Init module &amp;amp; Python ç›´è­¯å™¨ 
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;PyImport_AppendInittab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;speedup_dev_and_performance&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PyInit_speedup_dev_and_performance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Py_Initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;PyImport_ImportModule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;speedup_dev_and_performance&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// å‘¼å« function
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;complex_and_slow_calc_c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// é‡‹æ”¾ Python ç›´è­¯å™¨ä½”ç”¨è³‡æº
&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;Py_Finalize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€™é‚Šæ³¨æ„åˆ° initialization å¤šäº†å¹¾å€‹æ­¥é©Ÿï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;PyImport_AppendInittab&lt;/code&gt; æŠŠæˆ‘å€‘è¦åŒ¯å…¥çš„ module &lt;code&gt;speedup_dev_and_performance&lt;/code&gt; åŠ åˆ° built-in module table&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Py_Initialize&lt;/code&gt; initialize Python ç›´è­¯å™¨ &lt;/li&gt;
&lt;li&gt;å†å‘¼å« &lt;code&gt;PyImport_ImportModule&lt;/code&gt; ï¼Œä¹Ÿå°±æ˜¯åŒ¯å…¥ moduleï¼Œ æ‰èƒ½çœŸæ­£ initialize moduleï¼Œå› å…¶å…§éƒ¨å‘¼å« &lt;code&gt;PyInit_speedup_dev_and_performance&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;code&gt;PyInit_&amp;lt;module&amp;gt;&lt;/code&gt; æ˜¯åœ¨ä¸Šä¸Šæ­¥ &lt;code&gt;*.h&lt;/code&gt; æª”è£¡è‡ªå‹•ç”Ÿæˆçš„ã€‚è¨˜å¾—æˆ‘å€‘çš„ &lt;code&gt;complex_and_slow_calc&lt;/code&gt; æœ‰ &lt;code&gt;import math&lt;/code&gt; å—ï¼Ÿå¦‚æœæ²’æœ‰é€™ç¬¬ä¸‰æ­¥ï¼Œ&lt;code&gt;import math&lt;/code&gt; å°±æœƒå¤±æ•—ã€‚&lt;/p&gt;

&lt;h5&gt;Step 4: ç·¨è­¯ &amp;amp; åŸ·è¡Œç¨‹å¼&lt;/h5&gt;

&lt;p&gt;åŒæ¨£ç”¨ gcc ç·¨è­¯ç¨‹å¼ï¼Œç”¢ç”Ÿ &lt;code&gt;main&lt;/code&gt; åŸ·è¡Œæª”å¾ŒåŸ·è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;gcc &lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;python3-config --cflags --ldflags&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt; main.c speedup_dev_and_performance.c -o main 
&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;./main
&lt;span class=&quot;gp&quot;&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;3 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;æ¯”è¼ƒ&lt;/h2&gt;

&lt;p&gt;èªªäº†é€™éº¼å¤šï¼Œé€™äº›æ–¹æ³•æœ‰å“ªäº›å„ªç¼ºé»ï¼Œé©åˆä»€éº¼æ™‚å€™ç”¨å‘¢ï¼Ÿ&lt;/p&gt;

&lt;table&gt;&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align: center&quot;&gt;&lt;/th&gt;
&lt;th&gt;å„ªé»&lt;/th&gt;
&lt;th&gt;ç¼ºé»&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;Python/C API&lt;/td&gt;
&lt;td&gt;æœ€åŸå§‹ï¼Œæœ€å¤§çš„æ§åˆ¶æ¬Šã€‚&lt;/td&gt;
&lt;td&gt;Reference count å¾ˆç…©ã€‚æ¯”è¼ƒéœ€è¦ C çš„åŸºç¤ã€‚åªé‡å° CPythonã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;ctypes&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨ç°¡å–®ã€‚ä¸éœ€ç·¨è­¯ã€‚å¯ç›´æ¥ä½¿ç”¨ç¾æˆ libraryã€‚åŸºæœ¬ä½¿ç”¨ä¸Šä¸éœ€æœƒ Cã€‚&lt;/td&gt;
&lt;td&gt;Type è½‰æ›æ¯”è¼ƒéº»ç…©ï¼Œå°¤å…¶æ˜¯ structã€unionã€array é€™ç¨®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;SWIG&lt;/td&gt;
&lt;td&gt;æ”¯æ´å¤šç¨®èªè¨€ã€‚&lt;/td&gt;
&lt;td&gt;è¦å¯«ä¸€ä»½ç…©äººçš„ interface fileã€‚Overhead é«˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align: center&quot;&gt;Cython&lt;/td&gt;
&lt;td&gt;å…¼é¡§é–‹ç™¼èˆ‡åŸ·è¡Œæ•ˆèƒ½ã€‚&lt;/td&gt;
&lt;td&gt;è·Ÿ Python é‚„æ˜¯ä¸å¤ªä¸€æ¨£ï¼Œéœ€è¦å­¸æ–°æ±è¥¿ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;ä¸éé€™äº›æ˜¯å¾ˆç²—æ·ºçš„æ¯”è¼ƒï¼Œä¸€äº›æ›´æ·±å…¥çš„å„ªåŠ£å‹¢é‚„æ˜¯éœ€è¦çœŸçš„æ·±å…¥ä½¿ç”¨ä¹‹å¾Œæ‰èƒ½é«”æœƒã€‚&lt;/p&gt;

&lt;h2&gt;çµèª&lt;/h2&gt;

&lt;p&gt;ç‚ºäº†é­šèˆ‡ç†ŠæŒå…¼å¾—ï¼Œå‰äººåœ¨ C èˆ‡ Python çš„æ•´åˆé–‹ç™¼ä¸Šä¸‹äº†ä¸å°‘åŠŸå¤«ï¼Œä¹Ÿæ‰æœ‰é€™äº›æ–¹ä¾¿çš„å·¥å…·ä½¿ç”¨ã€‚æ­¤ç¯‡ç°¡å–®ä»‹ç´¹å¹¾å€‹ Python èˆ‡ C çš„æ•´åˆå·¥å…·ï¼Œå°šæœªè§¸åŠåˆ° C++ æˆ–å…¶ä»–èªè¨€ï¼Œä½†æˆ–è¨±èªè­˜é€™äº›åŸºæœ¬æ¦‚å¿µèƒ½æ›´å®¹æ˜“å»¶ä¼¸åˆ°å…¶ä»–èªè¨€ã€‚&lt;/p&gt;

&lt;p&gt;é€™äº›åœ¨è“¬å‹ƒç™¼å±•çš„è³‡è¨Šé ˜åŸŸè£¡å¯èƒ½åªæ˜¯å†°å±±ä¸€è§’ï¼Œæœªä¾†ä¹Ÿå‹¢å¿…æœƒæœ‰æ›´å¼·å¤§çš„æ•´åˆå·¥å…·æˆ–æ–°èªè¨€å‡ºç¾ã€‚æˆ‘å€‘èƒ½åšçš„å°±æ˜¯åä»¥å¾…æ–ƒï¼Œå–”ä¸æ˜¯ï¼Œæ˜¯åˆ†ææ¸…æ¥šåˆ©å¼Šï¼Œç‚ºè‡ªå·±çš„å°ˆæ¡ˆæŒ‘é¸æœ€é©åˆçš„å·¥å…·ã€‚&lt;/p&gt;

&lt;h2&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.python.org/3/c-api/intro.html&quot;&gt;Python/C API Reference Manual&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.tutorialspoint.com/python/python_further_extensions.htm&quot;&gt;Python - Extension Programming with C&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://pythonextensionpatterns.readthedocs.io/en/latest/refcount.html&quot;&gt;Python Extension Patterns&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.python.org/3.6/extending/extending.html&quot;&gt;Extending and Embedding the Python Interpreter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.python.org/3.6/library/ctypes.html&quot;&gt;ctypes â€” A foreign function library for Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.swig.org/Doc3.0/Contents.html#Contents&quot;&gt;SWIG Users Manual&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://docs.cython.org/en/latest/&quot;&gt;Cythonâ€™s Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://notes-on-cython.readthedocs.io/en/latest/index.html#&quot;&gt;Cython def, cdef and cpdef functions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.paypal-engineering.com/2016/09/22/python-by-the-c-side/&quot;&gt;Python by the C side&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zhihu.com/question/23003213&quot;&gt;å¦‚ä½•å®ç° C/C++ ä¸ Python çš„é€šä¿¡ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.cis.upenn.edu/%7Ecis192/spring2015/files/lec/lec14.pdf&quot;&gt;UPenn CIS192 Python Programming: Mixing C with Python/Modules and Packages&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Fri, 26 Jan 2018 00:00:00 -0800</pubDate>
        <link>/blog/tech/python/2018/01/26/python-c-mixing.html</link>
        <guid isPermaLink="true">/blog/tech/python/2018/01/26/python-c-mixing.html</guid>
        
        <category>Python</category>
        
        <category>PyLadies</category>
        
        <category>C</category>
        
        
        <category>Blog</category>
        
        <category>Tech</category>
        
        <category>Python</category>
        
      </item>
    
      <item>
        <title>Resurrecting the Dead</title>
        <description>&lt;p align=&quot;center&quot;&gt;&lt;img width=&quot;749px&quot; height=&quot;281px&quot; src=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese/blob/master/img/icon.png?raw=true&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese&quot;&gt;Resurrecting the Dead&lt;/a&gt; is a Chinese language model written in PyTorch trained on a mixed corpus of quotations from ancestors to produce contradictory texts.&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;p&gt;Detailed post can be found on &lt;a href=&quot;https://pyliaorachel.github.io/blog/tech/nlp/2017/12/24/resurrecting-the-dead-chinese.html&quot;&gt;here&lt;/a&gt; or on &lt;a href=&quot;https://pyliaorachel.github.io/blog/tech/nlp/2017/12/24/resurrecting-the-dead-chinese.html&quot;&gt;Medium&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Sun, 24 Dec 2017 00:00:00 -0800</pubDate>
        <link>/project/nlp/2017/12/24/resurrecting-the-dead.html</link>
        <guid isPermaLink="true">/project/nlp/2017/12/24/resurrecting-the-dead.html</guid>
        
        <category>nlp</category>
        
        <category>language-modeling</category>
        
        <category>pytorch</category>
        
        
        <category>Project</category>
        
        <category>NLP</category>
        
      </item>
    
      <item>
        <title>ç©¿è¶Šæ™‚ç©ºçš„å‰äººï¼šç”¨PyTorché‡ç¾å‰äººå€‘çš„ç¥ç¶“ç¶²çµ¡</title>
        <description>&lt;p&gt;ç¹¼ä¸Šä¸€ç¯‡&lt;a href=&quot;https://medium.com/pyladies-taiwan/%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%E6%96%B0%E6%89%8B%E6%9D%91-pytorch%E5%85%A5%E9%96%80-511df3c1c025&quot;&gt;æ·±åº¦å­¸ç¿’æ–°æ‰‹æ‘ï¼šPyTorch å…¥é–€&lt;/a&gt;å¾Œï¼Œé€™ä¸€æ¬¡è¦ä¾†åšä¸€é»é€²éšæ‡‰ç”¨ã€‚ç­†è€…ä»Šå¹´åä¸€æœˆåƒèˆ‡åœ¨é¦™æ¸¯èˆ‰è¾¦çš„ PyConï¼Œå…¶ä¸­ Aditthya Ramakrishnan è¬›è€…æ¼”è¬›çš„ä¸»é¡Œ &lt;a href=&quot;https://www.youtube.com/watch?v=r8H1cZjCfIA&quot;&gt;Resurrecting the dead with deep learning&lt;/a&gt; ä»¥ RNN æ¨¡å‹è¨“ç·´æ—è‚¯ (Lincoln) åŠå¸Œç‰¹å‹’ (Hitler)çš„æ··åˆèªæ–™åº«ï¼Œå‰µé€ å‡ºè¬›è©±éå¸¸çŸ›ç›¾çš„æ—å…‹å‹’ (Lincler)ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥æ­¤æ¼”è¬›ç‚ºåŸºç¤ï¼Œé€™æ¬¡æ”¶é›†ä¸¦æ··åˆäº†ã€Šæ¯›æ¾¤æ±èªéŒ„ã€‹å’Œã€Šè«–èªã€‹ï¼Œå˜—è©¦æ¨¡æ“¬å‡ºä¸€å€‹ã€Œå­”æ¾¤æ±ã€ï¼Œè—‰æ­¤ä¸€çªº RNN åœ¨ä¸­æ–‡æ–‡æœ¬ç”Ÿæˆ (Chinese text generation) çš„æ‡‰ç”¨ã€‚&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;p&gt;&lt;em&gt;* è«‹æ³¨æ„ï¼Œæ­¤ç¯‡ PyTorch å»ºç«‹åœ¨ Python3 ä¹‹ä¸Šï¼Œä¸¦ä»¥ MacOSX ç‚ºç’°å¢ƒã€‚&lt;/em&gt;&lt;br&gt;
&lt;em&gt;* é å‚™çŸ¥è­˜ï¼šåŸºç¤ç¥ç¶“ç¶²çµ¡æ¦‚å¿µ&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;äººå·¥ç¥ç¶“ç¶²çµ¡ (artificial neural network) éš¨å…¶ä¸åŒçš„æ¶æ§‹æœ‰è‘—ä¸åŒçš„æ‡‰ç”¨ï¼Œå…¶ä¸­&lt;strong&gt;å¾ªç’°ç¥ç¶“ç¶²çµ¡ (recurrent neural network, RNN)&lt;/strong&gt; èƒ½æ•æ‰&lt;strong&gt;æ™‚é–“&lt;/strong&gt;é—œä¿‚ï¼Œåœ¨è‡ªç„¶èªè¨€è™•ç†é ˜åŸŸæœ‰è‘—å»£æ³›çš„æ‡‰ç”¨ã€‚æœ¬æ–‡å°‡ä»¥ç°¡ä»‹ RNN åŠå…¶å„ªå‹¢é–‹é ­ï¼Œå†é€²å…¥ä¸»å°ˆæ¡ˆä»‹ç´¹ï¼ŒæŒ‰ç…§æ­¥é©Ÿè¬›è§£å¦‚ä½•ä»¥ PyTorch é€²è¡Œä¸­æ–‡æ–‡æœ¬ç”Ÿæˆï¼Œå°‡æ­·å²äººç‰©ç©å¼„æ–¼è‚¡æŒé–“ï¼Œæ‰“é€ å‡ºä¸€å€‹è’è¬¬çš„å‰äººçµåˆé«”ï¼Œä¸€åŒç¶­è­·ä¸–ç•Œå’Œå¹³ã€‚&lt;/p&gt;

&lt;h2&gt;RNN ï¼ˆç›¸ç•¶ç°¡å–®çš„ï¼‰ä»‹ç´¹&lt;/h2&gt;

&lt;p&gt;é‚„è¨˜å¾— N å¹´å‰çš„ Google ç¿»è­¯å—ï¼Ÿç¿»è­¯çš„çµæœé™¤äº†ç›¸ç•¶ç”Ÿç¡¬ä¸ç²¾ç¢ºï¼Œé‚„ç¶“å¸¸è¢«çœ¾äººåœ¨èŒ¶é¤˜é£¯å¾Œæ‹¿ä¾†æ¶æ„ï¼Œä»¤äººé¼»é…¸ã€‚ä½† Google åœ¨ 2016 å¹´å°‡å…¶æ‰“æ‰é‡ç·´ï¼Œæ¨å‡ºäº†ä¸€å€‹&lt;a href=&quot;https://research.google.com/pubs/pub45610.html&quot;&gt;æ–°ç³»çµ±&lt;/a&gt;ï¼Œæœ‰å˜—è©¦éçš„æ‡‰è©²éƒ½æœƒé©šè‰·æ–¼å®ƒçš„æˆé•·ï¼Œæµæš¢åº¦èˆ‡ç²¾ç¢ºåº¦éƒ½æå‡è¨±å¤šï¼Œä¸€ç¨®å°å­©é•·å¤§çš„æ„Ÿå‹•ã€‚é€™å€‹æ–°ç³»çµ±å³æ˜¯å»ºç«‹åœ¨ä¸€ç¨®ç¨±ä¹‹ç‚º&lt;strong&gt;åºåˆ—åˆ°åºåˆ— (sequence to sequence, seq2seq)&lt;/strong&gt; çš„æ¨¡å‹ä¹‹ä¸Šï¼Œè€Œæ­¤ç¨®æ¨¡å‹ä¾¿æ˜¯ä»¥ RNN ç‚ºåŸºç¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å¾ªç’°ç¥ç¶“ç¶²çµ¡ (RNN)&lt;/strong&gt; æ—¨åœ¨å»ºç«‹ä¸€ç¨®&lt;strong&gt;è¨˜æ†¶&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯ç‚ºäº†ä¸å°‡å…ˆå‰è¼¸å‡ºçš„çµæœéºå¿˜ï¼Œå°‡ä¹‹ç´¯ç©æˆæŸç¨®éš±è—ç‹€æ…‹ (hidden state)ï¼Œä¸¦èˆ‡ç•¶å‰è¼¸å…¥çµåˆï¼Œä¸€èµ·ç”¢å‡ºçµæœï¼Œå†é€²ä¸€æ­¥å‚³éä¸‹å»ã€‚ä¹Ÿå› æ­¤ï¼ŒRNN é©åˆæ¥æ”¶åºåˆ— (sequence) ä½œç‚ºè¼¸å…¥ä¸¦è¼¸å‡ºåºåˆ—ï¼Œæä¾›äº†åºåˆ—ç”Ÿæˆä¸€å€‹ç°¡æ½”çš„æ¨¡å‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://karpathy.github.io/assets/rnn/diags.jpeg&quot; alt=&quot;RNN&quot;&gt;&lt;/p&gt;

&lt;p&gt;æœ€åŸå§‹çš„ RNN æœ‰å…¶é™åˆ¶ï¼Œå­¸è€…ç‚ºäº†çªç ´é€™äº›é™åˆ¶è€Œç™¼å±•å‡ºäº†ä¸€äº›è®Šå½¢ï¼Œå…¶ä¸­å»£æ³›æ‡‰ç”¨çš„&lt;strong&gt;é•·çŸ­æœŸè¨˜æ†¶ (Long Short-Term Memory, LSTM)&lt;/strong&gt; å³æ˜¯ç‚ºäº†è§£æ±º &lt;a href=&quot;http://harinisuresh.com/2016/10/09/lstms/&quot;&gt;vanishing gradient&lt;/a&gt; å•é¡Œè€Œæå‡ºï¼Œä¹Ÿæ˜¯æˆ‘å€‘æ¥ä¸‹ä¾†å¯¦ä½œä¸­æ‡‰ç”¨çš„æ¨¡å‹ã€‚&lt;/p&gt;

&lt;p&gt;ç¤™æ–¼ç¯‡ï¼ˆæœ¬ï¼‰å¹…ï¼ˆäººï¼‰æœ‰ï¼ˆå¤ªï¼‰é™ï¼ˆæ‡¶ï¼‰ï¼Œæ²’è¾¦æ³•å®Œæ•´è§£é‡‹é€™äº›æ¨¡å‹èƒŒå¾Œçš„åŸç†ï¼Œä½†æƒ³è¦æ‡‰ç”¨æˆ–è¦ºå¾—ç”Ÿå‘½æœ‰é™çš„è©±ï¼Œä¸å¦¨å°±å°‡ä¹‹è¦–ç‚ºé»‘ç›’å­ã€‚è‹¥æœ‰èˆˆè¶£é€²ä¸€æ­¥äº†è§£ï¼Œå¯ä»¥è†œæ‹œä¸€ä¸‹&lt;a href=&quot;https://karpathy.github.io/2015/05/21/rnn-effectiveness/&quot;&gt;é€™ç¯‡è©³ç›¡ä»‹ç´¹&lt;/a&gt;å’Œ&lt;a href=&quot;http://colah.github.io/posts/2015-08-Understanding-LSTMs/&quot;&gt;é€™ç¯‡&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2&gt;ä»¥ PyTorch é‡ç¾å‰äººå€‘çš„ç¥ç¶“ç¶²çµ¡&lt;/h2&gt;

&lt;p&gt;ä»Šå¹´åä¸€æœˆçš„ PyCon HK çš„å…¶ä¸­ä¸€å ´æ¼”è¬› &lt;a href=&quot;https://www.youtube.com/watch?v=r8H1cZjCfIA&quot;&gt;Resurrecting the dead with deep learning&lt;/a&gt; å°‡æ—è‚¯ (Lincoln) åŠå¸Œç‰¹å‹’ (Hitler) çš„èªæ–™çµåˆï¼Œé€²è¡Œè¨“ç·´å¾Œèƒ½æ‰“é€ ä¸€å€‹è‡ªæ‰“å˜´å·´çš„æ–‡æœ¬ç”Ÿæˆç³»çµ±ï¼Œç¨±ä¹‹ç‚ºæ—å…‹å‹’ (Lincler)ã€‚æ­¤æ¬¡å°ˆæ¡ˆå‰‡æ˜¯ä»¿é€ å…¶ç²¾é«“ï¼Œä½†å°‡æ–‡æœ¬æ”¹æˆä¸­æ–‡ï¼Œä¸¦ä»¥ PyTorch å¯¦ç¾ï¼ˆåŸå°ˆæ¡ˆä»¥ Keras å¯¦ç¾ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœè·Ÿç­†è€…ä¸€æ¨£ä¹Ÿæ˜¯ PyTorch æ–°æ‰‹ï¼Œå°±ä¸€èµ·ä¾†é‚Šç©é‚Šç·´ç¿’å§ï¼&lt;/p&gt;

&lt;p&gt;GitHub å°ˆæ¡ˆåŸå§‹ç¢¼ï¼š&lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese&quot;&gt;pyliaorachel/resurrecting-the-dead-chinese&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;* ä»¥ä¸‹æœƒç°¡å–®æåˆ°å¾ˆå¤šæ·±åº¦å­¸ç¿’çš„æ¦‚å¿µï¼Œçš†ç•¶ä½œè£œå……å³å¯ã€‚æ¬²æ·±å…¥äº†è§£å¯åƒè€ƒæä¾›çš„é€£çµã€‚&lt;/em&gt;  &lt;/p&gt;

&lt;h4&gt;èªæ–™æº–å‚™&lt;/h4&gt;

&lt;p&gt;é€™æ¬¡æº–å‚™çš„å…©å€‹æ­·å²äººç‰©çš„èªæ–™ï¼Œä¸€æ˜¯æ¯›æ¾¤æ±çš„ã€Šæ¯›æ¾¤æ±èªéŒ„ã€‹ï¼Œä¸€æ˜¯å­”å­èˆ‡å…¶å¼Ÿå­çš„ã€Šè«–èªã€‹ã€‚åŸæœ¬æ˜¯æƒ³æ‰¾è”£ä¸­æ­£çš„ã€Šç¸½çµ±è”£å…¬æ€æƒ³è¨€è«–ç¸½é›†ã€‹ï¼Œä½†æ‰¾ä¸åˆ°å…¬é–‹çš„èªæ–™ï¼ŒçœŸæ˜¯å¯æƒœã€‚&lt;/p&gt;

&lt;p&gt;è³‡æ–™æ¸…ç†æ–¹é¢ï¼Œåªå°‡åŸå§‹èªæ–™ä¸­çš„ä¸€äº›éäººç‰©è¨€è«–çš„è¨»è§£åˆªé™¤å¾Œï¼Œä¸€å¥å¥æ’å¥½ã€‚å¦å¤–ç”±æ–¼ã€Šè«–èªã€‹åŸæ–‡æ˜¯æ–‡è¨€æ–‡ï¼Œæ‰€ä»¥æŒ‘äº†ç™½è©±æ–‡ç¿»è­¯ï¼Œé¿å…çµæœæ–‡ç™½æ··é›œã€‚ç¹ç°¡è½‰æ›æ–¹é¢ï¼ŒåŸå§‹èªæ–™çš†ç‚ºç°¡é«”ä¸­æ–‡ï¼Œæ‰€ä»¥ä¸éœ€é€²è¡Œç¹ç°¡è½‰æ›ï¼›å¦‚æœæƒ³è‡ªå·±æº–å‚™èªæ–™é€²è¡Œè¨“ç·´ï¼Œå¯ä»¥ä½¿ç”¨ &lt;a href=&quot;https://github.com/BYVoid/OpenCC&quot;&gt;OpenCC&lt;/a&gt; å°‡ç¹ç°¡çµ±ä¸€ã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šæ¸…ç†éƒ½ç›¸ç•¶ç°¡å–®ï¼Œåªé€éæ–‡å­—ç·¨è¼¯å™¨çš„ find &amp;amp; replace å°±å¯ä»¥å®Œæˆï¼ˆå¾ˆæ‡¶æƒ°æˆ‘çŸ¥é“ï¼‰ã€‚æ··åˆèªæ–™å‰‡ç°¡å–®å¯«äº† &lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese/blob/master/src/corpus/mix.py&quot;&gt;python script&lt;/a&gt; æŠŠå…©å€‹æª”æ¡ˆä¸­çš„å¥å­éš¨æ©Ÿæ··æ’ã€‚&lt;/p&gt;

&lt;p&gt;åŸå§‹å’Œæ¸…ç†å¾Œçš„èªæ–™éƒ½åœ¨ &lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese/tree/master/corpus&quot;&gt;corpus æª”æ¡ˆå¤¾&lt;/a&gt;åº•ä¸‹ã€‚&lt;/p&gt;

&lt;h4&gt;å»ºç«‹æ¨¡å‹&lt;/h4&gt;

&lt;h6&gt;è¼¸å…¥/è¼¸å‡ºè³‡æ–™&lt;/h6&gt;

&lt;p&gt;ç°¡å–®è¤‡ç¿’ä¸€ä¸‹ç›£ç£å¼å­¸ç¿’ã€‚ä¸€èˆ¬ç›£ç£å¼å­¸ç¿’çš„è¨“ç·´éç¨‹ä¸­ï¼Œæ¯ä¸€ç­†è³‡æ–™éƒ½éœ€è¦åŒ…æˆ&lt;code&gt;(input, target)&lt;/code&gt;çš„å½¢å¼ï¼›&lt;code&gt;input&lt;/code&gt; é€²å…¥æ¨¡å‹å¾Œæœƒå¾—åˆ°ä¸€å€‹é æ¸¬ &lt;code&gt;output&lt;/code&gt;ï¼Œè€Œé€™å€‹ &lt;code&gt;output&lt;/code&gt; å’Œæˆ‘å€‘çš„æ­£è§£ &lt;code&gt;target&lt;/code&gt; ä¹‹é–“æœƒæœ‰ä¸€å€‹è½å·® (error)ã€‚ç‚ºäº†è®“è½å·®æ¸›å°ï¼Œæˆ‘å€‘éœ€è¦æ…¢æ…¢èª¿æ•´æ¨¡å‹ä¸­åƒæ•¸ï¼Œæœ€å¾Œé”åˆ°æº–ç¢ºçš„é æ¸¬ï¼Œé€™å€‹å°±æ˜¯æ¨¡å‹çš„å­¸ç¿’éç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;é€™æ¬¡çš„ä»»å‹™ä¸­ï¼Œæˆ‘å€‘è®“ &lt;code&gt;input&lt;/code&gt; ç‚ºä¸€åºåˆ—çš„ä¸­æ–‡å­—ï¼Œ&lt;code&gt;target&lt;/code&gt; å‰‡æ˜¯æ­¤åºåˆ—å¾Œçš„ä¸‹ä¸€å€‹ä¸­æ–‡å­—ï¼Œå…©è€…çš†å¾èªæ–™ä¸­æº–å‚™å³å¯ã€‚é€™é‚Šç°¡å–®èµ·è¦‹ï¼Œç›´æ¥ä»¥ä¸­æ–‡å­—ç‚ºå–®ä½è€Œä¸å†åšä¸­æ–‡åˆ†è©ï¼Œå¦‚æœæƒ³ä»¥è©ç‚ºå–®ä½å¯ä»¥ä½¿ç”¨&lt;a href=&quot;https://github.com/fxsjy/jieba&quot;&gt;çµå·´åˆ†è©&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å‡è¨­è¼¸å…¥åºåˆ—é•·åº¦ç‚º 5ï¼Œå‰‡&lt;code&gt;è¿™æ­£æ˜¯æˆ‘ä»¬å¼Ÿå­ä»¬å­¦ä¸åˆ°çš„ã€‚&lt;/code&gt;æœƒè¢«åŒ…æˆï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# (input, target)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'è¿™æ­£æ˜¯æˆ‘ä»¬'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'å¼Ÿ'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'æ­£æ˜¯æˆ‘ä»¬å¼Ÿ'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'å­'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'æ˜¯æˆ‘ä»¬å¼Ÿå­'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'ä»¬'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'æˆ‘ä»¬å¼Ÿå­ä»¬'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'å­¦'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'ä»¬å¼Ÿå­ä»¬å­¦'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'ä¸'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'å¼Ÿå­ä»¬å­¦ä¸'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'åˆ°'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'å­ä»¬å­¦ä¸åˆ°'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'çš„'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'ä»¬å­¦ä¸åˆ°çš„'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'ã€‚'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦å¤–å°±æ˜¯ï¼Œä¸€ç­†ä¸€ç­†è³‡æ–™è¼¸å…¥å¾Œå³æ›´æ–°æ¬Šé‡ï¼Œæœƒè®“è¨“ç·´è®Šå¾—å¾ˆæ…¢ã€‚å¤šç­†è³‡æ–™åŒ…åœ¨ä¸€èµ·ä¸€èµ·è¨“ç·´ï¼Œå¯ä»¥åŠ é€Ÿè¨“ç·´ï¼Œæ­¤æ–¹æ³•ç¨±ä¹‹ç‚º &lt;a href=&quot;https://machinelearningmastery.com/gentle-introduction-mini-batch-gradient-descent-configure-batch-size/&quot;&gt;mini-batch&lt;/a&gt;ã€‚é‚£ç‚ºä»€éº¼ä¸æ‰€æœ‰è³‡æ–™åŒ…æˆä¸€ç­†å‘¢ï¼Ÿå› ç‚ºé€™æ¨£ä¸€ä¾†æ”¶æ–‚çµæœæœƒæ¯”è¼ƒå·®ï¼Œè€Œä¸”æ¯æ¬¡æœ‰æ–°è³‡æ–™é€²ä¾†å°±è¦æ•´åŒ…é‡æ–°è¨“ç·´ä¸€æ¬¡ï¼›mini-batch ç®—æ˜¯ä¸€å€‹å¹³è¡¡é»ï¼Œä¸é batch size è¦å¤šå¤§å°±éœ€è¦èª¿æ ¡ä¸€ç•ªã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese/blob/master/src/train/data.py&quot;&gt;&lt;code&gt;src/train/data.py&lt;/code&gt;&lt;/a&gt;è£¡æœ‰å…©å€‹ function è² è²¬æº–å‚™å¥½æ¨¡å‹å¯ä»¥æ¥å—çš„ inputï¼š&lt;/p&gt;

&lt;p&gt;&lt;code&gt;parse_corpus&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# èªæ–™è£¡æ‰€æœ‰å‡ºç¾éçš„ä¸­æ–‡å­—ï¼Œæ­¤ç‚º vocabulary&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sorted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;raw_text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# çµ¦æ¯å€‹ä¸­æ–‡å­—ä¸€å€‹å°æ‡‰çš„ indexï¼Œæ¯”è¼ƒå¥½åšæ¥ä¸‹ä¾†çš„ä»»å‹™&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;char_to_int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;dict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;enumerate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;int_to_char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;dict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;enumerate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# å…±ç”Ÿæˆ N å€‹ input-target pairï¼Œæ¯å€‹ input é•·åº¦ç‚º seq_lengthï¼Œtarget é•·åº¦ç‚º 1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_chars&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;raw_text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;dataX&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# N x seq_length&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;dataY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# N x 1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_chars&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;raw_text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;seq_out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;raw_text&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dataX&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;char_to_int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dataY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;char_to_int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;format_data&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# æ¡ç”¨ mini-batchï¼Œå°¾å·´ä¸è¶³ batch_size çš„ç›´æ¥æ¨æ£„&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_patterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dataY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n_patterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_patterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_patterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_patterns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_patterns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# æŠŠ array æ¯ batch_size ç­†è³‡æ–™åŒ…æˆä¸€çµ„ï¼Œä¸¦åŒ…æˆ tensor&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shape&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reshape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LongTensor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reshape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LongTensor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h6&gt;LSTM æ¨¡å‹&lt;/h6&gt;

&lt;p&gt;PyTorch å»ºç«‹ NN çš„è©±éœ€è¦ç¹¼æ‰¿ &lt;code&gt;nn.Module&lt;/code&gt;ï¼Œä¸¦ override &lt;code&gt;__init__&lt;/code&gt; å’Œ &lt;code&gt;forward&lt;/code&gt; å…©å€‹ methodã€‚&lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese/blob/master/src/train/model.py&quot;&gt;&lt;code&gt;src/train/model.py&lt;/code&gt;&lt;/a&gt;å®šç¾©äº†æˆ‘å€‘çš„ NN æ¶æ§‹ã€‚&lt;/p&gt;

&lt;p&gt;å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¼¸å…¥çš„æ¯å€‹ä¸­æ–‡å­—éƒ½æœƒå…ˆè½‰æˆ embedding vectorï¼Œä¹Ÿå°±æ˜¯ç”¨ä¸€å€‹ vector ä¾†è¡¨ç¤ºå„å€‹ä¸­æ–‡å­—ï¼Œé€™åœ¨è‡ªç„¶èªè¨€è™•ç†ä»»å‹™ä¸­å¹¾ä¹æ˜¯å¿…è¦çš„è™•ç†ã€‚&lt;a href=&quot;https://towardsdatascience.com/deep-learning-4-embedding-layers-f9a02d55ac12&quot;&gt;é€™ç¯‡æ–‡ç« &lt;/a&gt;å° embedding vector æœ‰ä¸€å€‹å¾ˆå¥½çš„ä»‹ç´¹ï¼Œä¸éç°¡å–®ä¾†èªªï¼Œå› ç‚ºå­—è©æ˜¯é¡åˆ¥è³‡æ–™ (categorical data)ï¼Œç”¨ integer é€™ç¨®æœ‰é †åºçš„æ ¼å¼ä¾†è¡¨ç¤ºä¸¦ä¸æ°ç•¶ï¼Œå› æ­¤è½‰æˆ vector å½¢å¼ï¼Œè—‰ç”± vector ä¹‹é–“çš„ç©ºé–“é—œä¿‚ä¾†æ•æ‰å­—è©ä¹‹é–“çš„é—œè¯æ€§ã€‚&lt;/p&gt;

&lt;p&gt;Dropout å‰‡æ˜¯å¸¸è¦‹çš„é˜²æ­¢&lt;strong&gt;éæ“¬åˆ (overfitting)&lt;/strong&gt; çš„æ‰‹æ®µï¼Œä¹Ÿå°±æ˜¯åœ¨è¨“ç·´éç¨‹ä¸­ä¸‰ä¸äº”æ™‚æ¨æ£„/å¿½ç•¥ä¸€äº›ç¥ç¶“å…ƒï¼Œä¾†æ¸›å¼±ä»–å€‘å½¼æ­¤é–“çš„è¯åˆé©æ‡‰æ€§ (co-adaptation)ã€‚ä¸èƒ½èªªå¤ªå¤šï¼Œä¸ç„¶è¦è®Š DLadies (DeepLearningLadies) äº†ï¼Œè©³å¯åƒè€ƒ&lt;a href=&quot;https://medium.com/@amarbudhiraja/https-medium-com-amarbudhiraja-learning-less-to-learn-better-dropout-in-deep-machine-learning-74334da4bfc5&quot;&gt;æ­¤ç¯‡&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;é€™é‚Šè¨­è¨ˆçš„æ¶æ§‹ç¸½å…±æœ‰ä»¥ä¸‹å¹¾å±¤ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Embedding layer: å°‡ä»¥ integer è¡¨ç¤ºçš„ character index è½‰æˆ embedding vector&lt;/li&gt;
&lt;li&gt;LSTM layer + dropout: å°‡è¼¸å…¥åºåˆ—é€šé LSTM ç·¨ç¢¼æˆ hidden stateï¼Œä¸¦åŠ ä¸€å±¤ dropout é˜²æ­¢ overfitting&lt;/li&gt;
&lt;li&gt;Fully-connected layer: æŠŠ hidden state ç·šæ€§è½‰æ›æˆä¸€é•·åº¦ç‚º length of vocabulary çš„ output layerï¼Œå…¶ä¸­æ•¸å€¼ç•¶ä½œæ¯å€‹å­—çš„å¾—åˆ†ï¼Œå¾—åˆ†è¶Šé«˜è¶Šæœ‰æ©Ÿæœƒæ˜¯ä¸‹ä¸€å€‹é æ¸¬çµæœ&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_vocab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;embedding_dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hidden_dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dropout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;embedding_dim&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;embedding_dim&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden_dim&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hidden_dim&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# nn.Embedding å¯ä»¥å¹«æˆ‘å€‘å»ºç«‹å¥½å­—å…¸ä¸­æ¯å€‹å­—å°æ‡‰çš„ vector&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;embeddings&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Embedding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n_vocab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;embedding_dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# LSTM layerï¼Œå½¢ç‹€ç‚º (input_size, hidden_size, ...)&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lstm&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LSTM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;embedding_dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hidden_dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dropout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dropout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# Fully-connected layerï¼ŒæŠŠ hidden state ç·šæ€§è½‰æ›æˆ output&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden2out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Linear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden_dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_vocab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;# LSTM æ¥å—çš„ input å½¢ç‹€ç‚º (timesteps, batch, features)ï¼Œå³ (seq_length, batch_size, embedding_dim)&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;# æ‰€ä»¥å…ˆæŠŠå½¢ç‹€ç‚º (batch_size, seq_length) çš„ input è½‰ç½®å¾Œï¼Œå†æŠŠæ¯å€‹ value (char index) è½‰æˆ embedding vector&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;embeddings&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;embeddings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# LSTM å±¤çš„ output (lstm_out) æœ‰æ¯å€‹ timestep å‡ºä¾†çš„çµæœï¼ˆä¹Ÿå°±æ˜¯æ¯å€‹å­—é€²å»éƒ½æœƒè¼¸å‡ºä¸€å€‹ hidden stateï¼‰&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;# é€™é‚Šæˆ‘å€‘å–æœ€å¾Œä¸€å±¤çš„çµæœï¼Œå³æœ€è¿‘ä¸€æ¬¡çš„çµæœï¼Œä¾†é æ¸¬ä¸‹ä¸€å€‹å­—&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;lstm_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lstm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;embeddings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ht&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lstm_out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# ç·šæ€§è½‰æ›è‡³ output&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden2out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ht&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;è¨“ç·´æ¨¡å‹&lt;/h4&gt;

&lt;p&gt;è³‡æ–™å’Œæ¨¡å‹éƒ½æœ‰äº†ä¹‹å¾Œï¼Œå°±å¯ä»¥ä¾†è¨“ç·´äº†ã€‚&lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese/blob/master/src/train/train.py&quot;&gt;&lt;code&gt;src/train/train.py&lt;/code&gt;&lt;/a&gt;è² è²¬è¼‰å…¥è³‡æ–™ã€è¨“ç·´ã€åŠå„²å­˜çµæœã€‚&lt;/p&gt;

&lt;p&gt;Optimizer é¸ç”¨ &lt;a href=&quot;https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/&quot;&gt;Adam&lt;/a&gt;ï¼Œäº¦å¯èª¿ç”¨å…¶ä»–å¦‚ SGDã€RMSprop ç­‰ &lt;a href=&quot;http://pytorch.org/docs/master/optim.html&quot;&gt;optimizer&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;Loss function æ¡ç”¨çš„æ˜¯ classification ä»»å‹™å¸¸è¦‹çš„ cross-entropyã€‚é æ¸¬çš„ &lt;code&gt;output&lt;/code&gt; æœƒæ˜¯é•·åº¦ç‚º number of classes çš„ tensorï¼Œ&lt;code&gt;target&lt;/code&gt; å‰‡æ˜¯æ­£ç¢º class labelï¼Œè€Œ PyTorch è£¡çš„ &lt;code&gt;cross_entropy&lt;/code&gt; æœƒè² è²¬æŠŠé æ¸¬çµæœåšä¸€æ¬¡ log softmax å¾Œï¼Œè¨ˆç®—è·Ÿç›®æ¨™ä¹‹é–“çš„ negative log likelihoodï¼Œå› æ­¤é æ¸¬çµæœä¸éœ€è¦å…ˆåš softmax æˆ– log softmaxã€‚éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„æ·±åº¦å­¸ç¿’æ¡†æ¶æœƒæœ‰ä¸åŒçš„åƒæ•¸å½¢ç‹€è¦æ±‚ï¼Œä¾‹å¦‚ Keras æœƒéœ€è¦ä½ æŠŠ target è½‰æˆ one-hot encoding ç­‰ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;optimizer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log_interval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# è¨­ä¸€ä¸‹ flag&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Mini-batch è¨“ç·´ &lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;enumerate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Variable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Variable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;optimizer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zero_grad&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;output&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;                      &lt;span class=&quot;c&quot;&gt;# å–å¾—é æ¸¬&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cross_entropy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;      &lt;span class=&quot;c&quot;&gt;# è¨ˆç®— loss&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backward&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;                             &lt;span class=&quot;c&quot;&gt;# Backpropagation&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;optimizer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;step&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;                            &lt;span class=&quot;c&quot;&gt;# æ›´æ–°åƒæ•¸&lt;/span&gt;

        &lt;span class=&quot;c&quot;&gt;# Log è¨“ç·´é€²åº¦&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log_interval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Train epoch: {} ({:2.0f}&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Loss: {:.6f}'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;epoch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;100.&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loss&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# è¼‰å…¥è³‡æ–™ï¼Œå»ºç«‹æ¨¡å‹&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;train_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char_to_int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int_to_char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;load_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;corpus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_length&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq_length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;batch_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;embedding_dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hidden_dim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dropout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dropout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;optimizer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;optim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Adam&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# è¨“ç·´&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoch&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;epochs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;train&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;optimizer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;epoch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;train_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log_interval&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;log_interval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# ç‚ºé¿å…ä¸å¯æŠ—åŠ›å› ç´ é€ æˆè¨“ç·´ä¸­æ–·ï¼Œæˆ–è¨“ç·´å¤ªä¹…å¤±å»è€å¿ƒï¼Œæ¯å¹¾å€‹ epoch å°±å„²å­˜ä¸€æ¬¡æ¨¡å‹&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;epoch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;save_interval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;eval&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;ç”¢å‡ºçµæœ&lt;/h4&gt;

&lt;p&gt;è¨“ç·´å¥½æ¨¡å‹å¾Œï¼Œæ¥ä¸‹ä¾†å°±ä¾†è©¦è©¦çœ‹ç”Ÿæˆæ–‡æœ¬ã€‚æ–¹æ³•æ˜¯ï¼Œå¾èªæ–™ä¸­éš¨æ©Ÿé¸ä¸€å€‹åºåˆ—ä½œç‚ºé–‹ç«¯ï¼Œè¼¸å…¥æ¨¡å‹å¾—åˆ°ä¸‹ä¸€å€‹å­—å¾Œï¼Œå°‡ä¹‹é™„åœ¨åºåˆ—æœ«ï¼Œä¸¦å°‡åŸåºåˆ—é ­ä¸€å€‹å­—ç§»é™¤ï¼Œä»¥æ­¤æ–°åºåˆ—ç¹¼çºŒé€²è¡Œé æ¸¬ï¼Œç›´åˆ°å¥å­çµæŸã€‚&lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese/blob/master/src/generate_text/gen.py&quot;&gt;&lt;code&gt;src/generate_text/gen.py&lt;/code&gt;&lt;/a&gt;è² è²¬æ–‡æœ¬ç”Ÿæˆã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ¨¡å‹çµ¦å‡ºçš„ output æ˜¯ä¸€å€‹é•·åº¦ç‚º length of vocabulary çš„åˆ†æ•¸ vectorï¼Œè¦æ€éº¼æŒ‘é¸ä¸‹ä¸€å€‹å­—å‘¢ï¼Ÿç¬¬ä¸€ç›´è¦ºæ˜¯ï¼Œé¸åˆ†æ•¸æœ€é«˜çš„ï¼Œå³æ˜¯æˆ‘å¯«çš„&lt;a href=&quot;https://github.com/pyliaorachel/resurrecting-the-dead-chinese/blob/f0cff5a5a100957a42f0a24c3e7b1b25a0a75d86/src/generate_text/gen.py&quot;&gt;ç¬¬ä¸€å€‹ç‰ˆæœ¬&lt;/a&gt;ã€‚ä½†ç”Ÿæˆçš„çµæœå¾ˆæ‚²åŠ‡ï¼ˆåå¥ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;æ•°äººæ°‘çš„æ”¿ç­–ï¼Œè€Œä¸æ˜¯ä¸ºäº†è¿™ä¸ªäººæ°‘çš„ï¼Œæ˜¯ä¸€ä¸ªäººæ°‘çš„å·¥ä½œï¼Œæˆ‘ä»¬çš„å·¥ä½œæ˜¯ä¸€ä¸ªäººçš„ä¸€ä¸ªå…·ä½“çš„å·¥ä½œï¼Œæˆ‘ä»¬çš„å·¥ä½œæ˜¯ä¸€ä¸ªäººï¼Œè¿™æ˜¯ä¸€ä¸ªäººçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦ä½¿ä»–ä»¬åœ¨é©å‘½ä¸­å›½çš„äººæ°‘ä¸»è¦å…³ç³»ï¼Œä¸æ˜¯è¦ç»è¿‡è¿™ç§æƒ…å†µï¼Œåœ¨ç¤¾ä¼šä¸»ä¹‰åˆ¶åº¦å’Œå›½å®¶æ”¿æ²»å·¥ä½œä½œé£ï¼Œä¸èƒ½ç”¨æ­£ç¡®çš„æ–¹æ³•å»è§£å†³ã€‚è¿™æ˜¯ä¸€ä¸ªäººæ°‘çš„æ”¿ç­–ï¼Œè€Œæ˜¯åœ¨å…¨å›½çš„é¢†å¯¼æœºå…³ï¼Œä¸æ˜¯ä¸ºç€æˆ‘ä»¬çš„æ°‘ä¸»ä¸»ä¹‰ï¼Œæ˜¯ä¸€ä¸ªé©å‘½çš„æ”¿ç­–ï¼Œè€Œæ˜¯åœ¨å…¨å›½çš„äººæ°‘ä¸»è¦çš„ï¼Œæ˜¯åœ¨é©å‘½çš„æ”¿æ²»ä¸Šï¼Œåœ¨ä¸€ä¸ªäººæ°‘å†…éƒ¨çš„çŸ›ç›¾ï¼Œæ˜¯ä¸€ä¸ªäººæ°‘çš„å·¥ä½œï¼Œæˆ‘ä»¬çš„å·¥ä½œæ˜¯ä¸€ä¸ªäººçš„ä¸€ä¸ªå…·ä½“çš„å·¥ä½œï¼Œæˆ‘ä»¬çš„å·¥ä½œæ˜¯ä¸€ä¸ªäººï¼Œè¿™æ˜¯ä¸€ä¸ªäººå£ä½œä¸ºä¸€ä¸ªé©å‘½çš„æ”¿ç­–ï¼Œè€Œæ˜¯åœ¨å…¨å›½çš„é¢†å¯¼æœºå…³ï¼Œä¸æ˜¯ä¸ºç€æˆ‘ä»¬çš„æ°‘ä¸»ä¸»ä¹‰ï¼Œæ˜¯ä¸€ä¸ªé©å‘½çš„æ”¿ç­–ï¼Œè€Œæ˜¯åœ¨å…¨å›½çš„äººæ°‘ä¸»è¦çš„ï¼Œæ˜¯åœ¨é©å‘½çš„æ”¿æ²»ä¸Šï¼Œåœ¨ä¸€ä¸ªäººæ°‘å†…éƒ¨çš„çŸ›ç›¾ï¼Œæ˜¯ä¸€ä¸ªäººæ°‘çš„å·¥ä½œï¼Œæˆ‘ä»¬çš„å·¥ä½œæ˜¯ä¸€ä¸ªäººçš„ä¸€ä¸ªå…·ä½“çš„å·¥ä½œï¼Œæˆ‘ä»¬çš„å·¥ä½œæ˜¯ä¸€ä¸ªäººï¼Œè¿™æ˜¯ä¸€ä¸ªäººå£ä½œä¸ºä¸€ä¸ªé©å‘½çš„æ”¿ç­–...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœƒç™¼ç”Ÿä¸€ç›´é‡è¤‡çš„æƒ…æ³ï¼Œè€Œä¸”ç”¢ç”Ÿä¸äº†å¥è™Ÿï¼Œæ‰€ä»¥å¥å­åœä¸ä¸‹ä¾†ã€‚å¤§æ¦‚æ˜¯åªè¦æ¥è¿‘åºåˆ—æœ«çš„é‚£å¹¾å€‹å­—ç›¸ä¼¼ï¼Œç”¢å‡ºä¾†çš„åˆ†æ•¸åˆ†ä½ˆä¹Ÿç›¸ä¼¼ï¼Œå› æ­¤åˆ†æ•¸æœ€é«˜çš„å¾ˆå¯èƒ½éƒ½æ˜¯åŒä¸€å€‹å­—ã€‚&lt;/p&gt;

&lt;p&gt;ç‚ºäº†é¿å…é€™ç¨®äº‹ç™¼ç”Ÿï¼Œç¬¬äºŒå€‹ç‰ˆæœ¬ï¼ˆä¹Ÿå°±æ˜¯ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼‰å°‡åˆ†æ•¸ vector è½‰æˆæ©Ÿç‡åˆ†ä½ˆï¼Œä¸¦ä¾ç…§æ­¤åˆ†ä½ˆæŒ‘é¸ä¸‹ä¸€å€‹å­—ã€‚ä¾‹å¦‚ vocabulary è£¡æœ‰ä¸‰å€‹å­— &lt;code&gt;[&amp;#39;ä½ &amp;#39;, &amp;#39;æˆ‘&amp;#39;, &amp;#39;ä»–&amp;#39;]&lt;/code&gt;ï¼Œè€Œæ©Ÿç‡åˆ†ä½ˆæ˜¯ &lt;code&gt;[0.8, 0.1, 0.1]&lt;/code&gt;ï¼Œå‰‡æŒ‘é¸åæ¬¡ä¹‹ä¸­ï¼Œç†æƒ³ä¸­æœƒæœ‰ 8 æ¬¡æŒ‘ &amp;#39;ä½ &amp;#39;ï¼Œå„ 1 æ¬¡æŒ‘ &amp;#39;æˆ‘&amp;#39; å’Œ &amp;#39;ä»–&amp;#39;ï¼Œè€Œéç¸½æ˜¯æŒ‘ &amp;#39;ä½ &amp;#39; äº†ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# éš¨æ©Ÿé¸æ“‡ä¸€åºåˆ—ä½œç‚ºé–‹ç«¯&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_patterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;patterns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# å…± n_sent å¥å­è¦ç”Ÿæˆ&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_sent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; 
    &lt;span class=&quot;c&quot;&gt;# åŒ…ä¸€ä¸‹ input&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reshape&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# batch_size = 1&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Variable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;torch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LongTensor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# ç”Ÿæˆæ­¤åºåˆ—ä¸‹ä¸€å€‹å­—&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pred&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seq_in&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pred&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to_prob&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;F&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;softmax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pred&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# softmax å¾Œè½‰æˆæ©Ÿç‡åˆ†ä½ˆ&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;choice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pred&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;          &lt;span class=&quot;c&quot;&gt;# ä¾æ©Ÿç‡åˆ†ä½ˆé¸å­—&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;char_idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char_to_int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# å°å‡º&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# å°‡å­—é™„åœ¨åŸåºåˆ—å¾Œä¸¦ç§»é™¤ç¬¬ä¸€å€‹å­—ï¼Œä½œç‚ºä¸‹ä¸€å€‹ input åºåˆ—&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;char_idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# è‹¥å°å‡ºä»£è¡¨å¥å­çµå°¾çš„æ¨™é»ç¬¦è™Ÿï¼Œå‰‡å®Œæˆä¸€å€‹å¥å­ç”Ÿæˆ&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is_end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;# restart_seq æ±ºå®šè¦ä¸è¦é‡æ–°æŒ‘é¸ä¸€å€‹åºåˆ—ï¼Œæˆ–æ˜¯å®Œæˆä¸€å€‹å®Œæ•´æ®µè½&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;restart_seq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n_patterns&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;patterns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç”Ÿæˆçš„çµæœæœ‰å¤§å¹…åº¦çš„æ”¹å–„ï¼Œä¸‹é¢æ˜¯ä¸€äº›çµæœï¼ˆåƒæ•¸ï¼šsequence length = 50, batch size = 32, embedding dimension = 256, hidden dimension = 256, learning rate = 0.0001, dropout = 0.2, epoch = 30; è¨“ç·´æ™‚é–“ï¼š5~6å°æ™‚ on 2 GHz Intel Core i5 CPUï¼‰ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;åœ¨æˆ˜äº‰ä¸­å¦åšå†³åœ°å®è¡Œå’Œå…¨ä½“ç”Ÿæ´»çš„å½¢åŠ¿æ˜¯é”™è¯¯çš„ï¼Œé‚£ä¸€ä¸–ç•Œæœ‰ç‰¹ç‚¹çš„äººä»¬æƒ³ä¸å¦ä¸€æ—¶ï¼Œæ„¿æ„çš„æŒ‡å¯¼ã€éè‹±æ—¶ã€åŠæˆå¤§å…šçš„ä¼°è®¡ã€‚æŒ‰ç…§è¿™ä¸ªäººï¼Œè‹¥ä¸é‡è§†æ˜¾æï¼Œè€Œæ˜¯ä½¿ä»–ä»¬å–å¾—èƒœåˆ©ã€‚æˆ‘ä¹Ÿä¸€å®šè¦å›å­ä½¿å›½å®¶å—ï¼Ÿå¯ä»¥ç™½æœ‰çš„å¤§å­åŠ åˆ¶ï¼Œä½¿ä½¿ä»–æœé•¿ã€‚éš¾é“è¿™æ€ä¹ˆèƒ½çŸ­è‰¯å‘¢ï¼Ÿåˆ™æˆ‘æ—©ä¸Šæ€è¿™ä¹ˆæ ·ï¼Ÿè¯´å¾—åˆ°å¤ªçš„è§‰å¤šäº†æ²¡æ‰ä¼šåå­£åŒã€‚æ¶â€”é‚£æ ·é‡Œæ¥ä¸ä¼šè‡ªå…­æ–¹ï¼‰ï¼Œä¸å¥æ€¨æ¨ï¼Œæˆ‘æ•¢ä¸æ•¬ï¼Œè¨€è¯­ä»–çš„æ¨å­ã€‚å›å­æ­æ•¬ä»ä¹‰ã€‚å¸å›½ä¸»ä¹‰å·²ç»ï¼šè¯´å¤šäº†ï¼Œä¸å¯è§å˜æ„¿æ„åäº”ï¼Œå³åï¼Œä¸€æˆ˜ä¸èƒ½æ‰“å¹²ï¼Œå°±è‡ªä»¥åªæ˜¯åœ¨é‚£ç±»é‡Œçš„è‡ªçº¿ä¹‹å…»ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;æ™ºçš„è¯¸ä¾¯äº†ï¼Œå¤©ä¸‹çš„äº¤æœå—ï¼Ÿæœ‰ç¤¼æœ‰åˆ¶åº¦ï¼Œç„¶åå´æ˜¯æ®·å®¹æ˜“å¬äº†ã€‚é©¬å…‹æ€åˆ—å®ä¸»ä¹‰è€…ï¼Œè¦å­¦ä¹ ç«¯æœ¨ä¸æ˜¯æ•™åˆ«çš„æ–¹æ³•ï¼Œä¸å¯ä»¥è¯´å‡ºå‘æ­»çš„ã€‚äº†ç¬¦åˆçš„ä¸»ä¹‰å½¢è§„å®šçš„å°±æ˜¯æ— ä¸ç†çš„ï¼Œè¿˜æœ‰ä¸€é—®å½“ï¼Œæœ€ç®€å¦‚è§åŒåŒå¿—åŒæ°‘æ—é¢†å¯¼ã€å¹²éƒ¨ã€æ´»åŒ–ï¼Œç›¸é—´å·¥äº’æ¥å…³å¤´å…šçš„æ•´é£ã€‚ä½†æ˜¯è¿˜æ¯ä¸€ä¸ªæ•´ä¸€ä¸ªæ–°å¹²éƒ¨ï¼Œè¦çœ‹æ•™è‚²å†…éƒ¨åŒç»ŸæƒåŠ›æ›´ç­‰ã€å¹²éƒ¨å…¶ã€æ´»åº­å’Œå·©å›ºç¾¤ä¼—ã€‚è¿™ä¸æ˜¯å°Šé‡é‚£ä¸ªé—®é¢˜ï¼Œå°±è¦è¯´å¼„ä¸ªæ ¹æ®ï¼Œä¸ä½œä»»ä½•ç”±ç»Ÿä¸€çš„æ–—äº‰ã€‚ä½†æ˜¯åœ¨æˆ‘å›½ç°åœ¨èµ„æœ¬ä¸»ä¹‰çš„å‰¥å‰Šå’Œå…±äº§å…šï¼Œä¸æ˜¯å¾ˆå¥½åœ°æ¥å—ç¤¾ä¼šä¸»ä¹‰çš„å·¥ä½œæ–¹å‘ã€‚æ¯ä¸€ä¸ªåŸºæœ¬ä½œç”¨å¤–ï¼Œç»“æœæœ‰ä¸€ä¸ªä¸“äºæˆ˜å½¹å®ƒã€‚å…šçš„æ”¿æ²»ä»»åŠ¡å¯¹äºè¡ŒåŠ¨ï¼›ï¼ˆè¦æœ‰å‡ å…ˆä¹‹ç¤¼ï¼Œå‡ ç„¶å¹´ï¼Œä¸å…åŠ¨åœ°ä¹Ÿä¼šå¿…è¦è¦ä½¿æ‹’ä¸»è§‚æ„¿æ„ã€‚åå²ä¼Ÿå¤§è¿˜æœ‰ä¸­å›½å†å²è¿™ç§å…·ä½“è¿™è¦çš„ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;äº‰ï¼Œæˆ‘ä»¬ä¼šä¸»ä¹‰å’Œå¹³å›½ï¼Œè€Œæ²¡æœ‰æŠŠå›½çš„äººå’ŒåŒæ¶ã€‚è¿™æ ·çš„äººä¸å®½æ˜“ã€‚å›å­ï¼Œå´æ²¡æœ‰æ­£ç¡®çš„æ€å¾·ï¼Œå°±æ˜¯å­¦ä¼šäº†ä¸€æ¬¡æ¥ä¸­è¿™æ ·çš„å—ï¼Ÿä¸€ä¸ªæœ‰äººä¸€å¤©è¦çœ‹åˆ°ï¼Œä¸€ä¸ªåŒå¿—ä¹Ÿä¸å¯ä»¥è®¤çœŸï¼Œå¦‚æœä¸ä»»ç”¨æ‰€ä¿ç•™çš„äººï¼Œå»ç”¨ä»å¾·å®ˆä½ï¼Œå°±æ˜¯å­ä»é¬¼ç¥ç¥ï¼Œåˆ°è¿™æ ·å¾®äº†ã€‚åœ¨ç»ƒå…µï¼Œéƒ½æ€è€ƒæƒ…é½æ™ºç™¾äº†ï¼Œå°±ä¸è¯´ï¼Œè¯¥å®¹æ˜“ä½œç­‰ï¼›å­¦æ–—äº‰å–é’ï¼Œä¸ç»™ä»¥é‚£å°±ä¸å»ï¼Œå…¨å¹´çš„æ‰èƒ½ã€‚ä»¥å‘æŒ¥ä¸ºæ€ç‹çš„ä¸èƒ½ä¸ä¼šå¾—å½»åº•ï¼Œä»–æ¥ä¸å¯ä»¥åšï¼›ä¸è€Œä¸ä¸Šä¸ï¼Œæ‹¿ç€æˆ‘ä»¬ï¼Œä¹Ÿå°†ä»–æ‰“æ°‘ä¸»è§‚ã€‚ä¸€å®šè¦è¯´æ˜¯ä¸å®‰çš„ï¼›è¨€è®ºå‘¨åˆ«çš„äººå¯¹äº²ä¸‹ï¼Œä¸åƒè‚‰ï¼Œä¸åƒã€‚å½“ç„¶è€Œæ¨ä¸¾ï¼Œæ‹¿å—è’‹ä»‹çŸ³çš„åœ£äººã€‚å®°æŸ¥å›æœæ˜¯ä»€ä¹ˆäº‹äº†ï¼Œå¯ä»¥è®©ä»–è‡ªå·±é«˜å…´çš„äº‹ï¼Œå°äººæ‰¹è¯„ã€‚ä¸è¯´è¯ï¼Œè¿™æ˜¯åè€Œä¸æ˜¯å­æ‚Œã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é›–èªªç”Ÿæˆçš„å¥å­çœ‹èµ·ä¾†æ¯”è¼ƒä¸é¬¼æ‰“ç‰†äº†ï¼Œä¹Ÿçœ‹å¾—å‡ºå­¸ç¿’åˆ°äº†ä¸€äº›å®Œæ•´çš„è©ï¼Œä¾‹å¦‚ã€Œé©¬å…‹æ€åˆ—å®ä¸»ä¹‰ã€ã€ã€Œè’‹ä»‹çŸ³ã€ã€ã€Œå›å­æ­æ•¬ä»ä¹‰ã€ç­‰ï¼Œä¸éé›¢æ­£ç¢ºæ–‡æ³•é‚„æœ‰ä¸å°å·®è·ã€‚ä½†å› ç‚ºè³‡æºæœ‰é™ï¼Œæˆ‘æ²’æœ‰é€²è¡Œèª¿åƒï¼Œæœ‰èˆˆè¶£çš„äººå¯ä»¥è©¦è©¦çœ‹èƒ½ä¸èƒ½æŠŠæ¨¡å‹è¨“ç·´çš„æ›´å¥½ã€‚&lt;/p&gt;

&lt;p&gt;åˆ†äº«ä¸€ä¸‹æ¼”è¬›è£¡ Lincler çš„ä¸€äº›çµæœï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;In 1918, I am the warfare. The struggle of civilization. The only answer to absolute liberty is the destruction of the nations.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;In the wrong virtue of people, to control every point the intention of love is to demand the supremacy of the United States.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;The British people will be sad with the progressing of the United States. Distrust the economy.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ“šèªªå·²ç¶“æ˜¯ç¯©é¸å…¶ä¸­æ¯”è¼ƒå¥½çš„å¥å­ç”Ÿæˆäº†ã€‚æœ‰èˆˆè¶£çš„å¯ä»¥è½è½çœ‹é€™å ´&lt;a href=&quot;https://www.youtube.com/watch?v=r8H1cZjCfIA&quot;&gt;æ¼”è¬›&lt;/a&gt;ï¼ˆæº«é¦¨æé†’ï¼šæ˜¯å°åº¦è…”å–”ï¼‰ã€‚&lt;/p&gt;

&lt;h2&gt;çµèª&lt;/h2&gt;

&lt;p&gt;Seq2seq æ¨¡å‹ç‚ºæ–‡æœ¬ç”Ÿæˆæä¾›äº†ç°¡å–®æœ‰æ•ˆçš„æ–¹æ³•ï¼Œä¹Ÿç‚ºè‡ªç„¶èªè¨€è™•ç†ç•Œæ³¨å…¥äº†æ›´å¤šå¯èƒ½æ€§ã€‚æ­¤ç¯‡ä»¥ã€Šæ¯›æ¾¤æ±èªéŒ„ã€‹å’Œã€Šè«–èªã€‹ç‚ºèªæ–™ï¼Œå˜—è©¦æ‰“é€ å‡ºçŸ›ç›¾çš„æ–‡æœ¬ç”Ÿæˆç³»çµ±ï¼Œé›–èªªé›¢å¯è¢«ç†è§£çš„èªè¨€é‚„æœ‰ä¸€å¤§æ®µå·®è·ï¼Œå»ä¹Ÿä¸é›£çœ‹å‡º RNN å’Œ seq2seq çš„æ½›åŠ›ã€‚æ­¤å¤–ï¼ŒPyTorch çš„å¯¦ä½œç›¸ç•¶å¥½ä¸Šæ‰‹ä¸”ç°¡å–®æ˜“æ‡‚ï¼Œå”¯å…¶å‰›å‰›å´›èµ·ï¼Œç¶²è·¯ä¸Šèƒ½æ‰¾åˆ°çš„å¯¦ä¾‹ä¸å¦‚ TensorFlow å¤šï¼Œå°æ–°æ‰‹ä¾†èªªæŒ‘æˆ°é —å¤šï¼ŒæœŸæœ›æœªä¾†ç¤¾ç¾¤ç™¼å±•èƒ½å¤ æ›´å¥å…¨å›‰ã€‚&lt;/p&gt;

&lt;h2&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=r8H1cZjCfIA&quot;&gt;PyCon HK 2017 - Resurrecting the dead with deep learning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://research.google.com/pubs/pub45610.html&quot;&gt;Google&amp;#39;s Neural Machine Translation System: Bridging the Gap between Human and Machine Translation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.zhinengl.com/2017/01/sequence-to-sequence-learning/&quot;&gt;è°·æ­Œç¿»è¯‘èƒŒåçš„æŠ€æœ¯çªç ´ï¼šåºåˆ—åˆ°åºåˆ—å­¦ä¹ &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://harinisuresh.com/2016/10/09/lstms/&quot;&gt;Vanishing Gradients &amp;amp; LSTMs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://karpathy.github.io/2015/05/21/rnn-effectiveness/&quot;&gt;The Unreasonable Effectiveness of Recurrent Neural Networks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://colah.github.io/posts/2015-08-Understanding-LSTMs/&quot;&gt;Understanding LSTM Networks&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://machinelearningmastery.com/gentle-introduction-mini-batch-gradient-descent-configure-batch-size/&quot;&gt;A Gentle Introduction to Mini-Batch Gradient Descent and How to Configure Batch Size&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://towardsdatascience.com/deep-learning-4-embedding-layers-f9a02d55ac12&quot;&gt;Deep Learning #4: Why You Need to Start Using Embedding Layers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/@amarbudhiraja/https-medium-com-amarbudhiraja-learning-less-to-learn-better-dropout-in-deep-machine-learning-74334da4bfc5&quot;&gt;Dropout in (Deep) Machine learning&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/&quot;&gt;Gentle Introduction to the Adam Optimization Algorithm for Deep Learning&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Sun, 24 Dec 2017 00:00:00 -0800</pubDate>
        <link>/blog/tech/nlp/2017/12/24/resurrecting-the-dead-chinese.html</link>
        <guid isPermaLink="true">/blog/tech/nlp/2017/12/24/resurrecting-the-dead-chinese.html</guid>
        
        <category>Python</category>
        
        <category>PyTorch</category>
        
        <category>Machine Learning</category>
        
        <category>Deep Learning</category>
        
        <category>Neural Network</category>
        
        <category>Natural Language Processing</category>
        
        <category>PyLadies</category>
        
        
        <category>Blog</category>
        
        <category>Tech</category>
        
        <category>NLP</category>
        
      </item>
    
      <item>
        <title>æ·±åº¦å­¸ç¿’æ–°æ‰‹æ‘ï¼šPyTorchå…¥é–€</title>
        <description>&lt;p&gt;æ·±åº¦å­¸ç¿’æ–°æ‰‹åœ¨å¾å­¸æ ¡ã€ç¶²è·¯ã€æˆ–æ›¸ä¸­ç¿’å¾—åŸºç¤ç¥ç¶“ç¶²çµ¡çŸ¥è­˜å¾Œï¼Œæ‰‹ç™¢æƒ³å»ºç«‹å°ˆæ¡ˆé«”ç¾æ·±åº¦å­¸ç¿’çš„å¨åŠ›ä¹‹å‰ï¼Œå¾—å…ˆæ±ºå®šè¦ç©å“ªä¸€å¥—æ·±åº¦å­¸ç¿’æ¡†æ¶ã€‚&lt;a href=&quot;https://www.tensorflow.org/&quot;&gt;TensorFlow&lt;/a&gt; ç„¡ç–‘æ˜¯è¿‘ä¾†ç›¸ç•¶ç«ç´…çš„ä¸€å€‹ï¼Œå…¶ç”± Google é–‹æºï¼Œè¿‘å¹´ä¾†å·²å»ºç«‹é¾å¤§ç¤¾ç¾¤åŸºç¤ã€‚&lt;/p&gt;

&lt;p&gt;ä½† 2017 å¹´åˆç”± Facebook é–‹æºçš„å¦ä¸€å¥—å»ºç«‹åœ¨ &lt;a href=&quot;http://torch.ch/&quot;&gt;Torch&lt;/a&gt; ä¹‹ä¸Šçš„æ·±åº¦å­¸ç¿’æ¡†æ¶ &lt;a href=&quot;http://pytorch.org/&quot;&gt;PyTorch&lt;/a&gt; å› å…¶èªæ³•ç°¡æ½”å„ªé›…ã€æ¦‚å¿µç›´è§€å’Œæ˜“ä¸Šæ‰‹çš„ç‰¹æ€§ï¼Œç”«æ¨å‡ºä¾¿è¿…é€Ÿèµ°ç´…ï¼Œå„¼ç„¶å·²æˆç‚ºç“œåˆ†æ·±åº¦å­¸ç¿’å¸‚å ´çš„æœ‰åŠ›ç«¶çˆ­è€…ã€‚è—‰ç”±é€™æ¨£çš„å„ªå‹¢ï¼Œæ­¤ç¯‡å°‡å¼•é ˜æ·±åº¦å­¸ç¿’æ–°æ‰‹å…¥é–€ PyTorch ï¼Œç°¡è¿°å…¶æ ¸å¿ƒæ¦‚å¿µï¼Œä¸¦ä»¥æ·±åº¦å­¸ç¿’é ˜åŸŸçš„ Hello World! å°ˆæ¡ˆ -- MNIST æ‰‹å¯«æ•¸å­—è¾¨è­˜ç‚ºä¾‹ï¼Œç›´æ¥å¸¶å¤§å®¶ç†è§£ PyTorch å¦‚ä½•æ‰“é€ æ¨¡å‹åŠé€²è¡Œæ·±åº¦å­¸ç¿’ã€‚&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;p&gt;&lt;em&gt;* è«‹æ³¨æ„ï¼Œæ­¤ç¯‡ PyTorch å»ºç«‹åœ¨ Python3 ä¹‹ä¸Šï¼Œä¸¦ä»¥ MacOSX ç‚ºç’°å¢ƒã€‚&lt;/em&gt;&lt;br&gt;
&lt;em&gt;* é å‚™çŸ¥è­˜ï¼šåŸºç¤ç¥ç¶“ç¶²çµ¡ &amp;amp; åå‘å‚³æ’­ç®—æ³•ï¼ˆBackpropagationï¼‰æ¦‚å¿µ&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://pytorch.org/&quot;&gt;PyTorch&lt;/a&gt; ç‚º Facebook åœ¨ 2017 å¹´åˆé–‹æºçš„æ·±åº¦å­¸ç¿’æ¡†æ¶ï¼Œå…¶å»ºç«‹åœ¨ &lt;a href=&quot;http://torch.ch/&quot;&gt;Torch&lt;/a&gt; ä¹‹ä¸Šï¼Œä¸”æ¨™æ¦œ Python First ï¼Œç‚ºé‡èº«æ›¿ Python èªè¨€æ‰€æ‰“é€ ï¼Œä½¿ç”¨èµ·ä¾†å°±è·Ÿå¯«ä¸€èˆ¬ Python å°ˆæ¡ˆæ²’å…©æ¨£ï¼Œä¹Ÿèƒ½å’Œå…¶ä»– Python å¥—ä»¶ç„¡ç—›æ•´åˆã€‚PyTorch çš„å„ªå‹¢åœ¨æ–¼å…¶æ¦‚å¿µç›¸ç•¶ç›´è§€ä¸”èªæ³•ç°¡æ½”å„ªé›…ï¼Œå› æ­¤è¦–ç‚ºæ–°æ‰‹å…¥é–€çš„ä¸€å€‹å¥½é¸é …ï¼›å†ä¾†å…¶è¼•é‡æ¶æ§‹è®“æ¨¡å‹å¾—ä»¥å¿«é€Ÿè¨“ç·´ä¸”æœ‰æ•ˆé‹ç”¨è³‡æº [1]ã€‚&lt;/p&gt;

&lt;p&gt;ç¶²è·¯ä¸Šå·²æœ‰å¾ˆå¤šè©³ç›¡æ•™å­¸æ‰‹æŠŠæ‰‹å¸¶ä½ èªè­˜ PyTorch çš„åŸºæœ¬èªæ³•ï¼Œä¾‹å¦‚&lt;a href=&quot;http://pytorch.org/tutorials/&quot;&gt;å®˜æ–¹æ–‡ä»¶&lt;/a&gt;æˆ–&lt;a href=&quot;https://github.com/rguthrie3/DeepLearningForNLPInPytorch/blob/master/Deep%20Learning%20for%20Natural%20Language%20Processing%20with%20Pytorch.ipynb&quot;&gt;ç¤¾ç¾¤åŠ›é‡&lt;/a&gt;ï¼Œé€™é‚Šå°±åªç°¡è¿°æ¦‚å¿µï¼Œèªæ³•éƒ¨åˆ†å‰‡è—‰ç”±å¾Œé¢ MNIST å¯¦ä½œç›´æ¥æ”»ç ´ã€‚&lt;/p&gt;

&lt;h2&gt;PyTorch æ ¸å¿ƒæ¦‚å¿µ&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆï¼Œè®“æˆ‘å€‘ä¾†æŠ“ä½ PyTorch ç²¾é«“å§ï¼&lt;/p&gt;

&lt;h4&gt;åŸºæœ¬å…ƒç´ ï¼š&lt;code&gt;Tensor&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;ä¸€å€‹ Tensorï¼ˆå¼µé‡ï¼‰é¡ä¼¼ä¸€å€‹é«˜ç¶­åº¦å‘é‡ï¼Œä¹Ÿæ˜¯æ·±åº¦å­¸ç¿’è£¡é€²è¡Œé‹ç®—çš„åŸºæœ¬å…ƒç´ ã€‚é€™è£¡æ¯”æ•¸å­¸ä¸Šçš„æ„ç¾©é‚„è¦å»£ç¾©ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå®ƒç•¶æˆä»»æ„ç¶­åº¦çš„è³‡æ–™å‘é‡ã€‚æ—¢ç„¶æ­¤æ–‡å‡è¨­è®€è€…å·²æœ‰åŸºæœ¬ç¥ç¶“ç¶²çµ¡çŸ¥è­˜ï¼Œé‚£ç‚ºä»€éº¼ Tensor æœƒæ˜¯åŸºæœ¬å…ƒç´ æ‡‰è©²ä¸é›£ç†è§£å§ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/docs/master/tensors.html#torch.Tensor&quot;&gt;&lt;code&gt;torch.Tensor&lt;/code&gt;&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;å‰µå»º Tensorï¼Œå¯åŒ…ä»»æ„ç¶­åº¦å‘é‡&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/docs/master/torch.html#torch.randn&quot;&gt;&lt;code&gt;torch.randn&lt;/code&gt;&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;å‰µå»º Tensorï¼Œdata éš¨æ©Ÿ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x1 + x2&lt;/code&gt;

&lt;ul&gt;
&lt;li&gt;å…©å€‹ Tensor ç›¸åŠ &lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/docs/master/torch.html#torch.cat&quot;&gt;&lt;code&gt;torch.cat&lt;/code&gt;&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;ä¸²è¯ï¼ˆconcatenateï¼‰Tensor&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/docs/master/tensors.html#torch.Tensor.view&quot;&gt;&lt;code&gt;x.view&lt;/code&gt;&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;é‡å¡‘ï¼ˆreshapeï¼‰Tensor ç¶­åº¦&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Computational Graph&lt;/h4&gt;

&lt;p&gt;Computational graph è®“ä½ å®šç¾© data è¦æ€éº¼éŠœæ¥çµ„åˆæ‰èƒ½å–å¾— outputã€å…¶ä¸­æœ‰å“ªäº› parameterã€æœ‰å“ªäº› activation function ç­‰ç­‰ï¼Œç¸½ä¹‹ä½ çš„ model è¦é‹ç®—å°æ•¸ï¼ˆderivativeï¼‰åŠæ¢¯åº¦ï¼ˆgradientï¼‰éœ€è¦çš„è³‡è¨Šéƒ½åœ¨è£¡é ­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://pytorch.org/docs/master/autograd.html&quot;&gt;&lt;code&gt;torch.autograd&lt;/code&gt;&lt;/a&gt; æ˜¯ä¸€å€‹å¹«ä½ æŠŠè·Ÿå¾®åˆ†æœ‰é—œçš„äº‹éƒ½è™•ç†å¥½çš„é‡è¦å¥—ä»¶ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/docs/master/autograd.html#torch.autograd.Variable&quot;&gt;&lt;code&gt;autograd.Variable&lt;/code&gt;&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;ä¸Šè¿°åŸºæœ¬å…ƒç´  Tensor å…¶å¯¦åªæœ‰å‘Šè¨´ä½ è£¡é ­çš„ data å’Œä»–çš„ shapeï¼Œé€™äº›æ˜¯ä¸è¶³å¤ æ•´å€‹ graph é‹ç®— derivative çš„ã€‚&lt;code&gt;autograd.Variable&lt;/code&gt; æ˜¯æ‰“åŒ… Tensor å’Œä¸€äº›é¡å¤–è³‡è¨Šçš„å…ƒä»¶ï¼Œä¾‹å¦‚ &lt;code&gt;z&lt;/code&gt; æ˜¯ &lt;code&gt;x&lt;/code&gt; å’Œ &lt;code&gt;y&lt;/code&gt; ç›¸åŠ è€Œæˆï¼Œé‚£éº¼ç”¨ &lt;code&gt;autograd.Variable&lt;/code&gt; è™•ç† &lt;code&gt;z&lt;/code&gt; èƒ½å¤ è¨˜éŒ„é€™å€‹&lt;strong&gt;ç›¸åŠ &lt;/strong&gt;çš„è³‡è¨Šï¼Œè€Œéå–®ç´”æŠŠ &lt;code&gt;x+y&lt;/code&gt; çš„&lt;strong&gt;çµæœ&lt;/strong&gt;è¨˜ä¸‹ï¼›å¦‚æ­¤ä¸€ä¾†æ‰èƒ½é‹ç®— derivativeã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/docs/master/autograd.html#torch.autograd.Variable.backward&quot;&gt;&lt;code&gt;x.backward&lt;/code&gt;&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;å¾ &lt;code&gt;x&lt;/code&gt; é–‹å§‹å¯¦æ–½ backpropagation é­”æ³•&lt;/li&gt;
&lt;li&gt;è¢«æƒåˆ°çš„ variable &lt;code&gt;y&lt;/code&gt; å…¶ gradient æœƒåœ¨ &lt;code&gt;y.grad&lt;/code&gt; è£¡ç´¯ç©&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Functions&lt;/h4&gt;

&lt;p&gt;ç¥ç¶“ç¶²çµ¡éœ€è¦ç”¨åˆ°å¾ˆå¤š functionï¼Œä¾‹å¦‚ activation functionã€loss function ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://pytorch.org/docs/master/nn.html&quot;&gt;&lt;code&gt;torch.nn&lt;/code&gt;&lt;/a&gt; æä¾›äº†å¾ˆå¤š neural network éœ€è¦çš„åŠŸèƒ½å’Œå…ƒä»¶ï¼Œè€Œ&lt;a href=&quot;http://pytorch.org/docs/master/nn.html#torch-nn-functional&quot;&gt;&lt;code&gt;torch.nn.functional&lt;/code&gt;&lt;/a&gt; ä¹Ÿæä¾›äº†å¾ˆå¤šå¸¸ç”¨ functionã€‚å…©è€…å·®åˆ¥åœ¨æ–¼ï¼Œ &lt;code&gt;torch.nn.functional&lt;/code&gt; æä¾›çš„æ˜¯ç´”å‡½æ•¸ï¼Œè€Œ &lt;code&gt;torch.nn&lt;/code&gt; æä¾›çš„æ˜¯ä¸€å€‹åŒ…è£å®Œæ•´çš„ &lt;code&gt;nn.Module&lt;/code&gt;ï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥ç›´æ¥è·Ÿå…¶å®ƒ function éˆçµèµ·ä¾†æ‹¿å»è¨“ç·´äº†ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;API åŸºæœ¬ä¸Šå°±æ˜¯ function åå­—ï¼Œ&lt;code&gt;Linear&lt;/code&gt;ã€&lt;code&gt;ReLU&lt;/code&gt;ã€&lt;code&gt;Sigmoid&lt;/code&gt; ä¹‹é¡ï¼Œå¾ˆç°¡å–®ã€‚&lt;/p&gt;

&lt;h4&gt;Training &amp;amp; Optimizer&lt;/h4&gt;

&lt;p&gt;å¾ä¸Šé¢ &lt;code&gt;autograd.Variable&lt;/code&gt; çš„ä»‹ç´¹è£¡å¾—çŸ¥ gradient å·²ç¶“æœ‰è¾¦æ³•ç®—å‡ºä¾†äº†ï¼Œé‚£ç®—å‡ºä¾†å¾Œå°±èƒ½ä»¥æ­¤æ›´æ–°åƒæ•¸ï¼Œä¹Ÿå°±æ˜¯æˆ‘å€‘èƒ½é€²è¡Œæ¨¡å‹è¨“ç·´äº†ã€‚ä¸éæ·±åº¦å­¸ç¿’è£¡é‚„æœ‰ä¸€äº›ç«…é–€ï¼Œèƒ½å¤§å¤§çš„å„ªï¼ˆè¤‡é›œï¼‰åŒ–é€™äº›å­¸ç¿’éç¨‹ï¼Œä¾‹å¦‚ learning rate çš„å‹•æ…‹é©æ‡‰ã€æ¯å¤šå°‘è¨“ç·´è³‡æ–™è¦æ›´æ–°åƒæ•¸ä¸€æ¬¡ç­‰ç­‰ï¼Œé€™äº›æ¼”ç®—æ³•çš„é¸æ“‡å°±æ˜¯&lt;strong&gt;å„ªåŒ–å™¨ï¼ˆOptimizerï¼‰&lt;/strong&gt;çš„é¸æ“‡ã€‚&lt;/p&gt;

&lt;p&gt;ä¸éæ—¢ç„¶æˆ‘å€‘åœ¨æ–°æ‰‹æ‘ï¼Œåªè¦çŸ¥é“é€šå¸¸çŸ‡è‘—çœ¼é¸ä¸€å€‹èƒ½å¾—åˆ°æ›´å¥½çš„æ•ˆæœå°±è¡Œäº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://pytorch.org/docs/master/optim.html&quot;&gt;&lt;code&gt;torch.optim&lt;/code&gt;&lt;/a&gt; è£¡é™³åˆ—äº†å¾ˆå¤š optimizerï¼Œå¸¸ç”¨çš„ä¾‹å¦‚ &lt;code&gt;SGD&lt;/code&gt;ã€&lt;code&gt;Adam&lt;/code&gt;ã€&lt;code&gt;RMSprop&lt;/code&gt; ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/docs/master/optim.html#optimizer-step&quot;&gt;&lt;code&gt;o.step&lt;/code&gt;&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;æ›´æ–°åƒæ•¸&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;å»ºç«‹ Neural Network&lt;/h4&gt;

&lt;p&gt;çµ‚æ–¼èƒ½ä¾†æ‰“é€  neural network model äº†ã€‚åŸºæœ¬ä¸Šé€™å€‹ model å°±æ˜¯ä¸€å€‹ class ç¹¼æ‰¿ &lt;a href=&quot;http://pytorch.org/docs/master/nn.html#torch.nn.Module&quot;&gt;&lt;code&gt;torch.nn.Module&lt;/code&gt;&lt;/a&gt;ï¼Œåªè¦ override &lt;code&gt;__init__&lt;/code&gt; å’Œ &lt;code&gt;forward&lt;/code&gt; å°±èƒ½å®šç¾©é€™å€‹ modelã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;__init__&lt;/code&gt;

&lt;ul&gt;
&lt;li&gt;å®šç¾© model ä¸­éœ€è¦çš„åƒæ•¸ï¼Œweightã€bias ç­‰ç­‰&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/docs/master/nn.html#torch.nn.Module.forward&quot;&gt;&lt;code&gt;forward&lt;/code&gt;&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;å®šç¾© model æ¥æ”¶ input æ™‚ï¼Œdata è¦æ€éº¼å‚³éã€ç¶“éå“ªäº› activation function ç­‰ç­‰&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;ä»¥ PyTorch æ‰“é€  MNIST æ‰‹å¯«æ•¸å­—è¾¨è­˜æ¨¡å‹&lt;/h2&gt;

&lt;p&gt;å‰åŠéƒ¨åˆ†åªæ˜¯ä»‹ç´¹ä¸€ä¸‹é€™å€‹é‚£å€‹åœ¨å¹¹å˜›ã€æœ‰å“ªäº› APIï¼Œç¾åœ¨å°±ä¾†å¯¦éš›è¨“ç·´ä¸€å€‹æ¨¡å‹å§ã€‚&lt;a href=&quot;http://yann.lecun.com/exdb/mnist/&quot;&gt;MNIST&lt;/a&gt; æ˜¯ä¸€å¥—æ‰‹å¯«æ•¸å­—çš„è¨“ç·´é›†ï¼Œåœ¨æ©Ÿå™¨å­¸ç¿’ç•Œçš„é‡è¦æ€§å ªæ¯”ç¨‹å¼èªè¨€çš„ Hello World! [9] å®˜æ–¹ä¹Ÿæœ‰æä¾›ç¯„ä¾‹ç¨‹å¼ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://corochann.com/wp-content/uploads/2017/02/mnist_plot.png&quot; alt=&quot;MNIST&quot;&gt;&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹ä¾†å°±æ˜¯æŠŠå®˜æ–¹ç¯„ä¾‹å»è•ªå­˜èï¼ˆç°¡åŒ–æ¨¡å‹ã€çœç•¥ CUDA ç­‰ï¼‰ã€æ¨¡çµ„åŒ–ã€åŠ ä¸Šè©³ç´°è¨»è§£ã€ä¸¦æä¾›ä¸€å€‹äº’å‹•ä»‹é¢ä¾›è‡ªè¡Œæ¸¬è©¦ï¼Œä¸€èµ·ç”¨ PyTorch å’Œ MNIST å…¥é–€æ·±åº¦å­¸ç¿’ã€‚&lt;/p&gt;

&lt;h6&gt;ç’°å¢ƒè¨­ç½® &amp;amp; å®‰è£å¥—ä»¶&lt;/h6&gt;

&lt;p&gt;&lt;a href=&quot;http://pytorch.org/&quot;&gt;PyTorch&lt;/a&gt; å®˜ç¶²å°±è·Ÿ PyTorch æœ¬èº«ä¸€æ¨£å„ªé›…ç›´è§€å¾—æ²’è©±èªªã€‚ä¸Šå»é¸å¥½ä½ çš„ç’°å¢ƒè¨­ç½®ï¼Œä¸‹è¼‰å¥—ä»¶å§ï¼&lt;/p&gt;

&lt;h6&gt;ç†è§£æ¨¡å‹&lt;/h6&gt;

&lt;p&gt;Backpropagation æ˜¯å¸¸è¦‹è¨“ç·´ç¥ç¶“ç¶²çµ¡çš„æ¼”ç®—æ³•ï¼ŒåŒ…å«é€™äº›åŸºæœ¬æ­¥é©Ÿï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;å–å¾—è³‡æ–™é›†ï¼Œæ¯ç­†è³‡æ–™åŒ…æˆ &lt;code&gt;(input, target output)&lt;/code&gt; å½¢å¼&lt;/li&gt;
&lt;li&gt;å»ºç«‹æ¨¡å‹

&lt;ol&gt;
&lt;li&gt;å®šç¾©ç¥ç¶“ç¶²çµ¡ä¸­æœ‰å“ªå¹¾å±¤ï¼Œå½¢ç‹€æ˜¯å¦‚ä½•&lt;/li&gt;
&lt;li&gt;å®šç¾©è³‡æ–™å¾€å‰å‚³éæ‰€éœ€ç¶“éçš„ functionï¼Œä¾‹å¦‚ activation functionã€loss function ç­‰&lt;/li&gt;
&lt;li&gt;æŒ‘é¸ optimizer å’Œå…¶æ‰€éœ€åƒæ•¸ï¼Œä¾‹å¦‚ learning rate&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;è¨“ç·´æ¨¡å‹

&lt;ol&gt;
&lt;li&gt;åˆå§‹åŒ–åƒæ•¸&lt;/li&gt;
&lt;li&gt;æŠŠ input é€šéç¶²çµ¡å¾€å‰å‚³ï¼ˆForward propagationï¼‰ï¼Œå–å¾—é æ¸¬ output&lt;/li&gt;
&lt;li&gt;è¨ˆç®— errorï¼ˆç›®æ¨™å’Œé æ¸¬çµæœçš„å·®è·ï¼‰&lt;/li&gt;
&lt;li&gt;æŠŠ error å¾€å›å‚³ï¼ˆBackward propagationï¼‰ï¼Œä¸€ä¸€è¨ˆç®—æ¯å€‹åƒæ•¸å°æ­¤ error çš„è²¢ç»ï¼ˆå–å°æ•¸ï¼‰&lt;/li&gt;
&lt;li&gt;æ›´æ–°åƒæ•¸ï¼Œå° error è²¢ç»è¶Šå¤šè™•ç½°è¶Šå¤š&lt;/li&gt;
&lt;li&gt;å¦‚æœ error éå¤§ï¼Œé‡è¤‡æ­¥é©Ÿ 2. è‡³ 5.ï¼Œç›´åˆ° error å°åˆ°å¯æ¥å—ï¼Œæˆ–è‡ªå·±è¨­å®šè¦å¾ªç’°å¹¾æ¬¡ï¼ˆå¹¾å€‹ epochï¼‰&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;å„²å­˜æ¨¡å‹&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¿—è©±èªªï¼Œæœ€å¥½çš„è¨»è§£å°±æ˜¯ç¨‹å¼æœ¬èº«ã€‚å› ç‚º PyTorch é€™é»åšå¾—å¾ˆå¥½äº†ï¼Œæˆ‘ç”šè‡³è¦ºå¾—è‡ªå·±çš„è¨»è§£ç›¸ç•¶å¤šé¤˜ï¼ˆé‚„æ˜¯åŠ æ¸›çœ‹å•¦ï¼‰ã€‚è«‹å¤§å®¶è‡ªè¡Œé–±è®€&lt;a href=&quot;https://github.com/pyliaorachel/pytorch-mnist-interactive&quot;&gt;å®Œæ•´ç¨‹å¼ + è¨»è§£&lt;/a&gt;ï¼Œç´°ç¯€å°±ä¸å†è´…è¿°äº†ã€‚&lt;/p&gt;

&lt;h6&gt;å¯¦éš›è¨“ç·´&lt;/h6&gt;

&lt;ol&gt;
&lt;li&gt;å®˜æ–¹ç¯„ä¾‹

&lt;ul&gt;
&lt;li&gt;ä¸æƒ³çœ‹æˆ‘è¨»è§£å»¢è©±çš„å¯ä»¥ç›´æ¥è‡³&lt;a href=&quot;https://github.com/pytorch/examples/tree/master/mnist&quot;&gt;å®˜æ–¹ç¯„ä¾‹&lt;/a&gt;ä¸‹è¼‰ä¹¾æ·¨çš„ç¨‹å¼ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ­¥é©Ÿè·‘ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;æ¨¡çµ„åŒ–ç¨‹å¼

&lt;ul&gt;
&lt;li&gt;æƒ³è¦åœ¨è¨“ç·´å¥½æ¨¡å‹å¾Œå¯¦éš›èª¿ç”¨ä¾†é æ¸¬è‡ªå·±çš„æ‰‹å¯«åœ–ç‰‡é«”æœƒé‚£æ„Ÿå‹•ç¬é–“çš„ï¼Œå¯ä»¥ä¸‹è¼‰&lt;a href=&quot;https://github.com/pyliaorachel/pytorch-mnist-interactive&quot;&gt;æ•ç¯„ä¾‹&lt;/a&gt;ï¼ŒæŒ‰ç…§æŒ‡ç¤ºè·‘ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;é€”ä¸­æœƒ log ä¸€äº›è¨Šæ¯ï¼Œå‘Šè¨´ä½ ç¾åœ¨çš„ error é™åˆ°å¤šå°‘ã€æº–ç¢ºç‡æå‡åˆ°å¤šé«˜ç­‰ç­‰ã€‚å¦‚æœæƒ³è¦è‡ªå·±èª¿åƒæ•¸ï¼Œåœ¨åŸ·è¡ŒæŒ‡ä»¤åŠ ä¸Šä¸€äº› option å³å¯ã€‚&lt;/p&gt;

&lt;h6&gt;è¨“ç·´çµæœ&lt;/h6&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pyliaorachel/pytorch-mnist-interactive/blob/master/img/training_log.png?raw=true&quot; alt=&quot;log&quot;&gt;&lt;/p&gt;

&lt;p&gt;è·‘äº†10å€‹ epoch çš„çµæœæº–ç¢ºç‡åˆ°é”99%ï¼Œé‚„è¡Œã€‚æœ‰èˆˆè¶£çš„å¯ä»¥è‡ªå·±èª¿èª¿åƒæ•¸ã€è‡ªå·±çµ¦æ¸¬è³‡ç­‰ç­‰ã€‚&lt;/p&gt;

&lt;h2&gt;çµèª&lt;/h2&gt;

&lt;p&gt;PyTorch å…¥é–€æ¦‚å¿µæœ‰äº†ä¹‹å¾Œï¼Œæ˜¯ä¸æ˜¯è¦ºå¾—èªæ³•ç›¸ç•¶ç›´è§€ã€å°æ–°æ‰‹ç›¸ç•¶å‹å–„ï¼Ÿé™¤äº†é›»è…¦è¦–è¦ºå’Œ CNNï¼Œä¹Ÿå¯ä»¥ç”¨ RNN ç©ç©çœ‹&lt;a href=&quot;https://github.com/rguthrie3/DeepLearningForNLPInPytorch/blob/master/Deep%20Learning%20for%20Natural%20Language%20Processing%20with%20Pytorch.ipynb&quot;&gt;è‡ªç„¶èªè¨€è™•ç†&lt;/a&gt;ã€‚æœ‰äº†é€™äº›åŸºç¤ä¹‹å¾Œï¼Œè‡ªå·±è¸¹è¸¹å…¶å®ƒæˆ–æ›´å¤§å‹çš„æ·±åº¦è¨“ç·´æ¨¡å‹ï¼Œå°±èƒ½é ˜å–å‹³ç« æ®åˆ¥æ–°æ‰‹æ‘å•¦ã€‚&lt;/p&gt;

&lt;h2&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/pytorch/pytorch&quot;&gt;GitHub pytorch/pytorch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://pytorch.org/tutorials/&quot;&gt;PyTorch Tutorials&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/rguthrie3/DeepLearningForNLPInPytorch/blob/master/Deep%20Learning%20for%20Natural%20Language%20Processing%20with%20Pytorch.ipynb&quot;&gt;Deep Learning for Natural Language Processing with Pytorch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/ritchieng/the-incredible-pytorch&quot;&gt;GitHub ritchieng/the-incredible-pytorch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/jcjohnson/pytorch-examples&quot;&gt;GitHub jsjohnson/pytorch-examples&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/yunjey/pytorch-tutorial&quot;&gt;GitHub yunjey/pytorch-tutorial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://yann.lecun.com/exdb/mnist/&quot;&gt;MNIST Dataset&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xmfbit.github.io/2017/03/04/pytorch-mnist-example/&quot;&gt;toy demo - PyTorch + MNIST&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.tensorflow.org/get_started/mnist/beginners&quot;&gt;MNIST For ML Beginners (TensorFlow)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://yashk2810.github.io/Applying-Convolutional-Neural-Network-on-the-MNIST-dataset/&quot;&gt;Applying Convolutional Neural Network on the MNIST dataset&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.jiqizhixin.com/articles/2017-10-09-4&quot;&gt;å››å¤©é€Ÿæˆï¼é¦™æ¸¯ç§‘æŠ€å¤§å­¦ PyTorch è¯¾ä»¶åˆ†äº«&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/27382990&quot;&gt;ã€pytorchã€‘å›¾åƒåŸºæœ¬æ“ä½œ&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2&gt;è£œå……è³‡æ–™&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http://cs231n.stanford.edu/vecDerivs.pdf&quot;&gt;Vector, Matrix, and Tensor Derivatives&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://medium.com/towards-data-science/types-of-optimization-algorithms-used-in-neural-networks-and-ways-to-optimize-gradient-95ae5d39529f&quot;&gt;Types of Optimization Algorithms used in Neural Networks and Ways to Optimize Gradient Descent&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
        <pubDate>Mon, 16 Oct 2017 00:00:00 -0700</pubDate>
        <link>/blog/tech/deeplearning/2017/10/16/getting-started-with-deep-learning-with-pytorch.html</link>
        <guid isPermaLink="true">/blog/tech/deeplearning/2017/10/16/getting-started-with-deep-learning-with-pytorch.html</guid>
        
        <category>Python</category>
        
        <category>PyTorch</category>
        
        <category>Machine Learning</category>
        
        <category>Deep Learning</category>
        
        <category>Neural Network</category>
        
        <category>Computer Vision</category>
        
        <category>PyLadies</category>
        
        
        <category>Blog</category>
        
        <category>Tech</category>
        
        <category>DeepLearning</category>
        
      </item>
    
      <item>
        <title>Pythonçš„importé™·é˜±</title>
        <description>&lt;p&gt;åœ¨è„«é›¢Pythonå¹¼å¹¼ç­æº–å‚™å»ºç«‹ç¨å¤§å‹çš„å°ˆæ¡ˆçš„æ™‚å€™ï¼Œå­¸ç¿’å¦‚ä½•çµ„ç¹”åŒ–ä½ çš„Pythonå°ˆæ¡ˆæ˜¯ä¸€å¤§è¦é»ã€‚Pythonæä¾›çš„&lt;strong&gt;moduleï¼ˆæ¨¡çµ„ï¼‰&lt;/strong&gt;èˆ‡&lt;strong&gt;packageï¼ˆå¥—ä»¶ï¼‰&lt;/strong&gt;æ˜¯å»ºç«‹æ¶æ§‹çš„åŸºæœ¬å…ƒä»¶ï¼Œä½†åœ¨moduleä¹‹é–“ç‚ºäº†é‡è¤‡ä½¿ç”¨ä¸€äº›functionï¼ˆå‡½æ•¸ï¼‰æˆ–classï¼ˆé¡åˆ¥ï¼‰è€Œå¿…é ˆäº’ç›¸&lt;strong&gt;importï¼ˆåŒ¯å…¥ï¼‰&lt;/strong&gt;ï¼Œä½¿ç”¨ä¸Šä¸€å€‹ä¸æ³¨æ„å°±æœƒæ‰å…¥æ··äº‚çš„importé™·é˜±ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤ç¯‡å°‡æœƒå¾åŸºæœ¬moduleå’Œpackageä»‹ç´¹èµ·ï¼Œæé»åŸºæœ¬importèªæ³•åŠabsolute importå’Œrelative importçš„ç”¨æ³•èˆ‡å·®ç•°ï¼Œæœ€å¾Œèˆ‰å‡ºå¹¾å€‹å¸¸è¦‹å› ç‚ºéŒ¯èª¤importè§€å¿µé€ æˆçš„éŒ¯èª¤ã€‚&lt;/p&gt;

&lt;!--more--&gt;

&lt;hr&gt;

&lt;p&gt;&lt;em&gt;* è«‹æ³¨æ„ï¼Œä»¥ä¸‹åªé‡å°Python3é€²è¡Œè¬›è§£èˆ‡æ¸¬è©¦ã€‚&lt;/em&gt;&lt;/p&gt;

&lt;h2&gt;Moduleèˆ‡Package&lt;/h2&gt;

&lt;p&gt;åŸºæœ¬ä¸Šä¸€å€‹fileå°±æ˜¯ä¸€å€‹moduleï¼Œè£¡é ­å¯ä»¥å®šç¾©functionï¼Œclassï¼Œå’Œvariableã€‚&lt;br&gt;
æŠŠä¸€å€‹moduleæƒ³æˆä¸€å€‹fileï¼Œé‚£ä¸€å€‹packageå°±æ˜¯ä¸€å€‹folderäº†ã€‚Packageå¯è£æœ‰subpackageå’Œmoduleï¼Œè®“ä½ çš„å°ˆæ¡ˆæ›´æ¢ç†æ›´çµ„ç¹”åŒ–ï¼Œæœ€å¾Œä¸€å¨æ‰“åŒ…å¥½é‚„èƒ½åˆ†çµ¦åˆ¥äººä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;å…ˆçœ‹çœ‹moduleã€‚å‡è¨­æœ‰ä¸€å€‹module &lt;code&gt;sample_module.py&lt;/code&gt; è£¡é ­å®šç¾©äº†ä¸€å€‹function &lt;code&gt;sample_func&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;sample_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Hello!'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç¾åœ¨ä½ åœ¨åŒä¸€å€‹ç›®éŒ„è£¡ä¸‹æœ‰å¦ä¸€å€‹module &lt;code&gt;sample_module_import.py&lt;/code&gt; æƒ³è¦é‡è¤‡ä½¿ç”¨é€™å€‹functionï¼Œé€™æ™‚å¯ä»¥ç›´æ¥å¾ &lt;code&gt;sample_module&lt;/code&gt; importæ‹¿å–ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sample_module&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sample_func&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sample_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è·‘ &lt;code&gt;python3 sample_module_import.py&lt;/code&gt; æœƒå¾—åˆ°ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;Hello!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å†ä¾†æ˜¯packageã€‚æˆ‘å€‘æŠŠä¸Šé¢å…©å€‹æª”æ¡ˆåŒ…åœ¨ä¸€å€‹æ–°çš„folder &lt;code&gt;sample_package&lt;/code&gt; åº•ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;sample_package/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ sample_module.py
â””â”€â”€ sample_module_import.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¾ˆé‡è¦çš„æ˜¯æ–°å¢é‚£å€‹ &lt;code&gt;__init__.py&lt;/code&gt; æª”ã€‚å®ƒæ˜¯ç©ºçš„æ²’é—œä¿‚ï¼Œä½†ä¸€å®šè¦æœ‰ï¼Œæœ‰é»å®£ç¨±è‡ªå·±æ˜¯ä¸€å€‹packageçš„å‘³é“ã€‚&lt;/p&gt;

&lt;p&gt;é€™æ™‚å€™å¦‚æœæ˜¯é€²åˆ° &lt;code&gt;sample_package&lt;/code&gt; è£¡é¢è·‘ä¸€æ¨£çš„æŒ‡ä»¤ï¼Œé‚£æ²’å·®ã€‚ä½†æ—¢ç„¶éƒ½æ‰“åŒ…æˆpackageäº†ï¼Œé€šå¸¸æ˜¯éœ€è¦åœ¨packageä»¥å¤–çš„åœ°æ–¹ä¸‹æŒ‡ä»¤çš„ï¼Œé€™æ™‚å€™è£¡é¢çš„importå°±è¦ç¨å¾®åšå› æ‡‰ã€‚&lt;/p&gt;

&lt;p&gt;å‡è¨­é€™æ™‚æˆ‘å€‘åœ¨è·Ÿ &lt;code&gt;sample_package&lt;/code&gt; åŒä¸€å€‹folderåº•ä¸‹ï¼Œè®“æˆ‘å€‘ä¿®æ­£ä¸€ä¸‹ &lt;code&gt;sample_package/sample_module_import.py&lt;/code&gt; ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;s&quot;&gt;'''è·‘åœ¨`sample_package`åº•ä¸‹ï¼ˆéå¸¸è¦‹æƒ…æ³ï¼‰'''&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# from sample_module import sample_func&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;'''è·‘åœ¨è·Ÿ`sample_package`åŒfolderåº•ä¸‹'''&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;.sample_module&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sample_func&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;'''æˆ–'''&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# from sample_package.sample_module import sample_func&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sample_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€™é‚Šå…©ç¨®è§£ä¾†è‡ªæ–¼absolute importå’Œrelative importçš„é¸æ“‡ï¼Œç­‰ç­‰å†æã€‚ç¸½ä¹‹æˆ‘å€‘å¯ä»¥è·‘äº†ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;python3 -m sample_package.sample_module_import
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¿®å¥½äº†ã€‚é€™é‚Š&lt;a href=&quot;https://docs.python.org/2/using/cmdline.html#cmdoption-m&quot;&gt;&lt;code&gt;-m&lt;/code&gt;&lt;/a&gt;æ˜¯ç‚ºäº†è®“Pythonå…ˆimportä½ è¦çš„packageæˆ–moduleçµ¦ä½ ï¼Œç„¶å¾Œå†åŸ·è¡Œscriptã€‚æ‰€ä»¥é€™é‚Š &lt;code&gt;sample_module_import&lt;/code&gt; åœ¨è·‘çš„æ™‚å€™ï¼Œæ˜¯ä»¥ &lt;code&gt;sample_package&lt;/code&gt; ç‚ºç’°å¢ƒçš„ï¼Œé€™æ¨£é‚£äº›importæ‰ä¸æœƒå‡ºéŒ¯ã€‚&lt;/p&gt;

&lt;h2&gt;åŸºæœ¬importèªæ³•&lt;/h2&gt;

&lt;p&gt;å‰é¢æœ‰çœ‹éäº†ï¼Œé€™é‚Šçµ±æ•´ä»‹ç´¹ä¸€ä¸‹ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨åœ¨å…¶ä»–moduleè£¡å®šç¾©çš„functionã€classã€variableç­‰ç­‰ï¼Œå°±éœ€è¦åœ¨ä½¿ç”¨å®ƒå€‘ä¹‹å‰å…ˆé€²è¡Œimportã€‚é€šå¸¸éƒ½æœƒæŠŠéœ€è¦importçš„moduleå€‘åˆ—åœ¨æ•´å€‹fileçš„æœ€ä¸€é–‹å§‹ï¼Œä½†ä¸æ˜¯å¿…é ˆã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;s&quot;&gt;'''èªæ³•1ï¼šimport [module]'''&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Importæ•´å€‹`random`module&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;random&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ä½¿ç”¨`random`moduleåº•ä¸‹çš„`randint`function&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;'''èªæ³•2ï¼šfrom [module] import [name1, name2, ...]'''&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# å¾`random`moduleè£¡importå…¶ä¸­ä¸€å€‹function`randint`&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt; 

&lt;span class=&quot;c&quot;&gt;# ä¸ä¸€æ¨£çš„æ˜¯ï¼Œä½¿ç”¨`randint`çš„æ™‚å€™å°±ä¸éœ€è¦å…ˆå¯«`random`äº†&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;'''èªæ³•3ï¼šimport [module] as [new_name]'''&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Importæ•´å€‹`random`moduleï¼Œä½†é€™å€‹åå­—å¯èƒ½è·Ÿå…¶ä»–åœ°æ–¹æœ‰è¡çªï¼Œæ”¹åæˆ`rd`&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;rd&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ä½¿ç”¨`rd`é€™å€‹åç¨±å–ä»£åŸæœ¬çš„`random`&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;s&quot;&gt;'''èªæ³•4ï¼ˆä¸æ¨è–¦ï¼‰ï¼šfrom [module] import *'''&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Importæ‰€æœ‰`random`moduleåº•ä¸‹çš„æ±è¥¿&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# ä½¿ç”¨`randint`çš„æ™‚å€™ä¹Ÿä¸éœ€è¦å…ˆå¯«`random`&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;randint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;èªæ³•4ä¸æ¨è–¦åŸå› æ˜¯å®¹æ˜“é€ æˆåç¨±è¡çªï¼Œé™ä½å¯è®€æ€§å’Œå¯ç¶­è­·æ€§ã€‚&lt;/p&gt;

&lt;h2&gt;Absolute Import v.s. Relative Import&lt;/h2&gt;

&lt;p&gt;Pythonæœ‰å…©ç¨®importæ–¹æ³•ï¼Œ&lt;strong&gt;absolute import&lt;/strong&gt;åŠ&lt;strong&gt;relative import&lt;/strong&gt;ã€‚Absolute importå°±æ˜¯å®Œæ•´ä½¿ç”¨moduleè·¯å¾‘ï¼Œrelative importå‰‡æ˜¯ä½¿ç”¨ä»¥ç•¶å‰packageç‚ºåƒè€ƒçš„ç›¸å°è·¯å¾‘ã€‚Relative importçš„éœ€æ±‚åœ¨æ–¼ï¼Œæœ‰æ™‚å€™åœ¨æ”¹è®Šå°ˆæ¡ˆæ¶æ§‹çš„æ™‚å€™ï¼Œè£¡é¢çš„packageå’Œmoduleæœƒæ‹‰ä¾†æ‹‰å»ï¼Œé€™æ™‚å€™å¦‚æœé€™äº›packageè£¡é¢ä½¿ç”¨çš„æ˜¯relative importçš„è©±ï¼Œä»–å€‘çš„ç›¸å°é—œä¿‚å°±ä¸æœƒæ”¹è®Šï¼Œä¹Ÿå°±æ˜¯ä¸éœ€è¦å†ä¸€ä¸€é€²å…¥moduleè£¡æ›´æ”¹è·¯å¾‘ã€‚ä½†å› ç‚ºrelative importçš„è·¯å¾‘å–æ±ºæ–¼ç•¶å‰packageï¼Œæ‰€ä»¥åœ¨å“ªè£¡åŸ·è¡Œå°±æœƒé€ æˆä¸ä¸€æ¨£çš„çµæœï¼Œä¸€ä¸å°å¿ƒåˆè¦å™´ä¸€å †errorï¼›é€™æ™‚absolute importå°±æœƒæ¸›å°‘è¨±å¤šå›°æ“¾ã€‚&lt;/p&gt;

&lt;p&gt;é€™é‚Šåƒè€ƒ&lt;a href=&quot;https://www.python.org/dev/peps/pep-0328/#guido-s-decision&quot;&gt;PEP328&lt;/a&gt;æä¾›çš„ç¯„ä¾‹ã€‚Packageæ¶æ§‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;package/
    __init__.py
    subpackage1/
        __init__.py
        moduleX.py
        moduleY.py
    subpackage2/
        __init__.py
        moduleZ.py
    moduleA.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç¾åœ¨å‡è¨­&lt;code&gt;package/subpackage1/moduleX.py&lt;/code&gt;æƒ³è¦å¾å…¶ä»–moduleè£¡importä¸€äº›æ±è¥¿ï¼Œå‰‡ä½¿ç”¨ä¸‹åˆ—èªæ³•ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;s&quot;&gt;'''[A]è¡¨Absolute importç¯„ä¾‹ï¼›[R]è¡¨Relative importç¯„ä¾‹'''&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ImportåŒä¸€å€‹packageåº•ä¸‹çš„sibling module `moduleY`&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;package.subpackage1&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;moduleY&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;moduleY&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;.moduleY&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# å¾åŒä¸€å€‹packageåº•ä¸‹çš„sibling module `moduleY` import `spam`é€™å€‹function&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;package.subpackage1.moduleY&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spam&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;.moduleY&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;spam&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# å¾éš”å£packageåº•ä¸‹çš„module `moduleZ` import `eggs`é€™å€‹function&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;package.subpackage2.moduleZ&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eggs&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;..subpackage2.moduleZ&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eggs&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Import parent packageåº•ä¸‹çš„module `moduleA`&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;moduleA&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;..&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;moduleA&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æˆ–&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;...package&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;moduleA&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¦é»ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Relative importè£¡ï¼Œ&lt;code&gt;.&lt;/code&gt;ä»£è¡¨ä¸Šä¸€å±¤ï¼Œå¹¾å€‹&lt;code&gt;.&lt;/code&gt;å°±ä»£è¡¨ä¸Šå¹¾å±¤ã€‚&lt;/li&gt;
&lt;li&gt;Relative importä¸€å¾‹æ¡ç”¨ &lt;code&gt;from ... import ...&lt;/code&gt; èªæ³•ï¼Œå³ä½¿æ˜¯å¾ &lt;code&gt;.&lt;/code&gt; importä¹Ÿè¦å¯« &lt;code&gt;from . import some_module&lt;/code&gt; è€Œé &lt;code&gt;import .some_module&lt;/code&gt;ã€‚åŸå› æ˜¯&lt;code&gt;.some_module&lt;/code&gt;é€™å€‹åç¨±åœ¨expressionè£¡ç„¡æ³•å‡ºç¾ã€‚Absolute importå‰‡ç„¡é™åˆ¶ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h2&gt;å¸¸è¦‹importé™·é˜±&lt;/h2&gt;

&lt;h4&gt;Circular Import&lt;/h4&gt;

&lt;p&gt;æƒ³åƒä¸€å€‹module &lt;code&gt;A&lt;/code&gt; åœ¨ä¸€é–‹å§‹è¦importå¦ä¸€å€‹module &lt;code&gt;B&lt;/code&gt; è£¡çš„æ±è¥¿ï¼Œä½†åœ¨åŒ¯å…¥module &lt;code&gt;B&lt;/code&gt; çš„é€”ä¸­å¿…é ˆå…ˆåŸ·è¡Œå®ƒï¼Œè€Œå¾ˆä¸å·§çš„å®ƒä¹Ÿéœ€è¦å¾module &lt;code&gt;A&lt;/code&gt; importä¸€äº›æ±è¥¿ã€‚ä½†module &lt;code&gt;A&lt;/code&gt;é‚„æ­£åœ¨åŸ·è¡Œé€”ä¸­ï¼Œè‡ªå·±éƒ½é‚„æ²’å®šç¾©å¥½è‡ªå·±çš„functionå•Šï¼æ–¼æ˜¯ä½ ä¸è®“æˆ‘æˆ‘ä¸è®“ä½ ï¼Œé€™ç¨®é¡ä¼¼deadlockçš„æƒ…å½¢æ­£æ˜¯å¸¸è¦‹çš„&lt;strong&gt;circular importï¼ˆå¾ªç’°åŒ¯å…¥ï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;è®“æˆ‘å€‘çœ‹çœ‹ç¯„ä¾‹ã€‚ç¾åœ¨åœ¨ &lt;code&gt;sample_package&lt;/code&gt; è£¡æœ‰ &lt;code&gt;A&lt;/code&gt; å’Œ &lt;code&gt;B&lt;/code&gt; å…©å€‹moduleæƒ³äº’æ‰“æ‹›å‘¼ï¼Œç¨‹å¼ç¢¼åˆ†åˆ¥å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# A.py&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;.B&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;B_greet_back&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;A_say_hello&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'A says hello!'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;B_greet_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;A_greet_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'A says hello back!'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;A_say_hello&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# B.py&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;.A&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A_greet_back&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;B_say_hello&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'B says hello!'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;A_greet_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;B_greet_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'B says hello back!'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;B_say_hello&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å…§å®¹éƒ½ä¸€æ¨£ï¼Œåªæ˜¯&lt;code&gt;A/B&lt;/code&gt;äº’æ›ã€‚&lt;code&gt;B&lt;/code&gt; å¾ˆæœ‰ç¦®è²Œæƒ³å…ˆæ‰“æ‹›å‘¼ã€‚åœ¨èˆ‡ &lt;code&gt;sample_package&lt;/code&gt; åŒç›®éŒ„åº•ä¸‹åŸ·è¡Œï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;python3 -m sample_package.B

&amp;gt;&amp;gt;&amp;gt;
Traceback &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;most recent call last&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
  File &lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/Cellar/python3/3.6.2/Frameworks/Python.framework/Versions/3.6/lib/python3.6/runpy.py&quot;&lt;/span&gt;, line 193, &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;_run_module_as_main
    &lt;span class=&quot;s2&quot;&gt;&quot;__main__&quot;&lt;/span&gt;, mod_spec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  File &lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/Cellar/python3/3.6.2/Frameworks/Python.framework/Versions/3.6/lib/python3.6/runpy.py&quot;&lt;/span&gt;, line 85, &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;_run_code
    &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;code, run_globals&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  File &lt;span class=&quot;s2&quot;&gt;&quot;/path/to/sample_package/B.py&quot;&lt;/span&gt;, line 2, &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &amp;lt;module&amp;gt;
    from .A import A_greet_back
  File &lt;span class=&quot;s2&quot;&gt;&quot;/path/to/sample_package/A.py&quot;&lt;/span&gt;, line 1, &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &amp;lt;module&amp;gt;
    from .B import B_greet_back
  File &lt;span class=&quot;s2&quot;&gt;&quot;/path/to/sample_package/B.py&quot;&lt;/span&gt;, line 2, &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &amp;lt;module&amp;gt;
    from .A import A_greet_back
ImportError: cannot import name &lt;span class=&quot;s1&quot;&gt;'A_greet_back'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è§€å¯Ÿåˆ°äº†å—ï¼Ÿ&lt;code&gt;B&lt;/code&gt; è©¦åœ–import &lt;code&gt;A_greet_back&lt;/code&gt;ï¼Œä½†é€”ä¸­å…ˆé€²åˆ° &lt;code&gt;A&lt;/code&gt; åŸ·è¡Œï¼Œè€Œå› ç‚ºPythonæ˜¯å¾é ­é–‹å§‹ä¸€è¡Œä¸€è¡ŒåŸ·è¡Œä¸‹ä¾†çš„ï¼Œæ–¼æ˜¯åœ¨å®šç¾© &lt;code&gt;A_greet_back&lt;/code&gt; ä¹‹å‰æœƒå…ˆç¢°åˆ°è‡ªå·±çš„import statementï¼Œæ–¼æ˜¯åˆé€²å…¥ &lt;code&gt;B&lt;/code&gt;ï¼Œç„¶å¾Œé™·å…¥æ­»èƒ¡åŒã€‚&lt;/p&gt;

&lt;p&gt;å¸¸è¦‹è§£æ±ºé€™ç¨®circular importçš„æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Importæ•´å€‹moduleè€Œéå–®ä¸€attribute  &lt;/p&gt;

&lt;p&gt;æŠŠ &lt;code&gt;B.py&lt;/code&gt; æ›´æ”¹æˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# from .A import A_greet_back&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;B_say_hello&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'B says hello!'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# A_greet_back()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;A_greet_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å°±ä¸æœƒç™¼ç”ŸéŒ¯èª¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;python3 -m sample_package.B

&amp;gt;&amp;gt;&amp;gt;
B says hello!
A says hello back!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç†ç”±æ˜¯ï¼ŒåŸ·è¡Œ &lt;code&gt;from .A import A_greet_back&lt;/code&gt; è¢«è¿«è¦å¾loadé€²ä¾†çš„ &lt;code&gt;A&lt;/code&gt; module objectä¸­æ‰¾å‡º &lt;code&gt;A_greet_back&lt;/code&gt; çš„å®šç¾©ï¼Œä½†æ­¤æ™‚é€™å€‹module objecté‚„æ˜¯ç©ºçš„ï¼›è€Œ &lt;code&gt;from . import A&lt;/code&gt; å°±åªæœƒæª¢æŸ¥ &lt;code&gt;A&lt;/code&gt; module object å­˜ä¸å­˜åœ¨ï¼Œè‡³æ–¼ &lt;code&gt;A_greet_back&lt;/code&gt; å­˜ä¸å­˜åœ¨ç­‰åˆ°éœ€è¦åŸ·è¡Œçš„æ™‚å€™å†å»æ‰¾å°±è¡Œäº†ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å»¶é²import  &lt;/p&gt;

&lt;p&gt;æŠŠ &lt;code&gt;B.py&lt;/code&gt; æ›´æ”¹æˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# å‰é¢å…¨åˆª&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;B_say_hello&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;.A&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A_greet_back&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'B says hello!'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;A_greet_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¹ŸæœƒæˆåŠŸè·‘å‡ºçµæœã€‚è·Ÿå‰é¢é¡ä¼¼ï¼ŒPythonåœ¨è·‘åˆ°é€™è¡Œæ™‚æ‰æœƒimport &lt;code&gt;A&lt;/code&gt; moduleï¼Œé€™æ™‚å› ç‚º &lt;code&gt;B&lt;/code&gt; moduleéƒ½å·²ç¶“loadå®Œäº†ï¼Œæ‰€ä»¥ä¸æœƒæœ‰circular importçš„å•é¡Œã€‚ä½†é€™å€‹æ–¹æ³•æ¯”è¼ƒhackyä¸€é»ï¼Œå¤§æ¦‚åªèƒ½åœ¨hackathonä¸­ä½¿ç”¨ï¼Œå¦å‰‡æ­£å¼å°ˆæ¡ˆè£¡çœ‹åˆ°é€™ç¨®é›£ç¶­è­·çš„codeå¯èƒ½æœƒæœ‰ç”Ÿå‘½å±éšªã€‚ &lt;/p&gt;

&lt;p&gt;å¦ä¸€æ–¹é¢ï¼ŒæŠŠæ‰€æœ‰import statementæ“ºåˆ°æ•´å€‹moduleæœ€å¾Œé¢ä¹Ÿæ˜¯é¡ä¼¼æ•ˆæœï¼Œä½†ä¹Ÿæœƒè¢«æ‰“ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;å¥½å¥½é‡æ¸…æ¶æ§‹ï¼Œé¿å…circular import&lt;/p&gt;

&lt;p&gt;æ˜¯çš„ï¼Œæ²»æœ¬æ–¹æ³•é‚„æ˜¯å¥½å¥½æ€è€ƒè‡ªå·±å¯«çš„codeç‚ºä»€éº¼æœƒé™·å…¥é€™ç¨®å±æ©Ÿï¼Œç„¶å¾Œé‡æ–°refactorå§ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h4&gt;Relative Import above Top-level Package&lt;/h4&gt;

&lt;p&gt;é‚„ä¸ç†Ÿæ‚‰relative importçš„äººå¸¸å¸¸æœƒè¦‹åˆ°é€™å€‹errorï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;ValueError: attempted relative import beyond top-level package
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è®“æˆ‘å€‘é‡ç¾ä¸€ä¸‹é€™å€‹errorã€‚æŠŠ &lt;code&gt;B.py&lt;/code&gt; å‰é ­æ›´æ”¹æˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;c&quot;&gt;# from . import A&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;..sample_package&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;A&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç¾åœ¨æˆ‘å€‘çš„è·¯å¾‘ä½ç½®åœ¨èˆ‡ &lt;code&gt;sample_package&lt;/code&gt; åŒç›®éŒ„åº•ä¸‹ã€‚è·‘ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span class=&quot;gp&quot;&gt;$ &lt;/span&gt;python3 -m sample_package.B

&amp;gt;&amp;gt;&amp;gt;
Traceback &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;most recent call last&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
  File &lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/Cellar/python3/3.6.2/Frameworks/Python.framework/Versions/3.6/lib/python3.6/runpy.py&quot;&lt;/span&gt;, line 193, &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;_run_module_as_main
    &lt;span class=&quot;s2&quot;&gt;&quot;__main__&quot;&lt;/span&gt;, mod_spec&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  File &lt;span class=&quot;s2&quot;&gt;&quot;/usr/local/Cellar/python3/3.6.2/Frameworks/Python.framework/Versions/3.6/lib/python3.6/runpy.py&quot;&lt;/span&gt;, line 85, &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;_run_code
    &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;code, run_globals&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  File &lt;span class=&quot;s2&quot;&gt;&quot;/path/to/sample_package/B.py&quot;&lt;/span&gt;, line 5, &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &amp;lt;module&amp;gt;
    from ..sample_package import A
ValueError: attempted relative import beyond top-level package
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ‰€è¬‚çš„ &lt;code&gt;top-level package&lt;/code&gt; å°±æ˜¯ä½ æ‰€åŸ·è¡Œçš„packageä¸­æœ€é«˜çš„é‚£ä¸€å±¤ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;sample_package&lt;/code&gt;ã€‚è¶…éé€™ä¸€å±¤çš„relative importæ˜¯ä¸è¢«å…è¨±çš„ï¼ŒæŒ‡çš„å°±æ˜¯ &lt;code&gt;..sample_package&lt;/code&gt; é€™è¡Œå˜—è©¦è·³å…©å±¤ä¸Šå»è€Œè¶…é &lt;code&gt;sample_package&lt;/code&gt;äº†ã€‚  &lt;/p&gt;

&lt;p&gt;å¯ä»¥è©¦è©¦æ›´æ”¹ç•¶å‰ç›®éŒ„åˆ°ä¸Šä¸€å±¤ï¼ˆ&lt;code&gt;cd ..&lt;/code&gt;ï¼‰ï¼Œå‡è¨­å« &lt;code&gt;parent_folder&lt;/code&gt; ï¼Œç„¶å¾ŒåŸ·è¡Œ &lt;code&gt;python3 -m parent_folder.sample_package.B&lt;/code&gt;ï¼Œå°±æœƒç™¼ç¾erroræ¶ˆå¤±äº†ï¼Œå› ç‚ºç¾åœ¨çš„ &lt;code&gt;top-level package&lt;/code&gt; å·²ç¶“è®Šæˆ &lt;code&gt;parent_folder&lt;/code&gt;äº†ã€‚&lt;/p&gt;

&lt;h2&gt;çµèª&lt;/h2&gt;

&lt;p&gt;Importæ˜¯å„å¤§èªè¨€å¿…å‚™åŠŸèƒ½ï¼Œçœ‹ä¼¼ç°¡å–®ï¼Œä½¿ç”¨ä¸Šä¾†èªªé™·é˜±å»é —å¤šã€‚å¦‚æœæä¸æ¸…æ¥šPythonä¸­çš„importæ˜¯æ€éº¼é‹ä½œçš„ï¼Œé™¤äº†åœ¨æ•´é«”å°ˆæ¡ˆæ¶æ§‹ä¸Šé›£ä»¥éˆæ´»è¨­è¨ˆï¼Œæ›´å¯èƒ½è¦é™·å…¥å¯æ€•çš„erroræµ·äº†ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘å¯«äº†ä¸€äº›é¡å¤–çš„sample codeæ”¾ä¸Š&lt;a href=&quot;https://github.com/pyliaorachel/python-import-traps&quot;&gt;github&lt;/a&gt;äº†ï¼Œæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹å¯ä»¥ç›´æ¥åƒè€ƒã€‚&lt;/p&gt;

&lt;h2&gt;åƒè€ƒè³‡æ–™&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.python.org/2/tutorial/modules.html&quot;&gt;Python Documentation - Modules&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.python.org/3/reference/import.html&quot;&gt;Python Documnetation - the Import System&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.tutorialspoint.com/python/python_modules.htm&quot;&gt;tutorialspoint - Python Modules&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.python.org/dev/peps/pep-0328/#guido-s-decision&quot;&gt;PEP328 -- Imports: Multi-Line and Absolute/Relative&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://effbot.org/zone/import-confusion.htm&quot;&gt;Importing Python Modules&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.blog.pythonlibrary.org/2016/03/01/python-101-all-about-imports/&quot;&gt;Python 101: All about imports&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Fri, 15 Sep 2017 00:00:00 -0700</pubDate>
        <link>/blog/tech/python/2017/09/15/pythons-import-trap.html</link>
        <guid isPermaLink="true">/blog/tech/python/2017/09/15/pythons-import-trap.html</guid>
        
        <category>Python</category>
        
        <category>PyLadies</category>
        
        
        <category>Blog</category>
        
        <category>Tech</category>
        
        <category>Python</category>
        
      </item>
    
  </channel>
</rss>
