<!DOCTYPE html>
<html>
	<head>
		<title>Operating System - Paging</title>
		<link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
		<link rel="stylesheet" href="/css/main.css" type="text/css">
		<link href="https://fonts.googleapis.com/css?family=Antic+Slab|Catamaran|Hind:300|Inconsolata|Josefin+Sans|Muli:300,400i|Poiret+One|Rajdhani:300|Rock+Salt|Ruda|Scope+One|Shadows+Into+Light|Source+Code+Pro|Space+Mono" rel="stylesheet">
		<link rel="stylesheet" href="/css/github-markdown.css">

		<!-- Place jquery before bootstrap -->
		<script type="text/javascript" src="/js/jquery.min.js"></script>
		<script type="text/javascript" src="/js/bootstrap.min.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-default navbar-fixed-top">
	<div class="container-fluid">

		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">MyCoon</a>
		</div>

		<div class="collapse navbar-collapse" id="navbar-collapse">

			<form class="navbar-form navbar-left">
				<div class="form-group">
					<input type="text" class="form-control" placeholder="Search">
				</div>
				<button type="submit" class="btn btn-default">Submit</button>
			</form>

			<ul class="nav navbar-nav navbar-right" id="nav-links">
				<li class="nav-home"><a href="/">Home</a></li>
				<li class="dropdown nav-blog">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
						Blog<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><a href="/blog">MyCoon Blog</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="/blog/categories">Categories</a></li>
						
							
						

						
							
							
							<li class="category">
								<a href="/blog/notes">
									<span>Notes</span>
									<span>29</span>
								</a>
							</li>
						
							
							
							<li class="category">
								<a href="/blog/tech">
									<span>Tech</span>
									<span>3</span>
								</a>
							</li>
						
						<li><a href="/blog/tags">Tags</a></li>
					</ul>
				</li>
				<li class="dropdown nav-tutorial">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
						Tutorials<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><a href="/tutorial">MyCoon Tutorial</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="/tutorial/categories">Categories</a></li>
						
							
						

						
						<li><a href="/tutorial/tags">Tags</a></li>
					</ul>
				</li>
				<li  class="nav-project"><a href="/project">Projects</a></li>
				<li class="nav-special" id="special"><a href="#">?</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</div><!-- /.container-fluid -->
</nav>
		<main class="page-content post" aria-label="Content">
	<div class="post-wrapper">
		<div class="wrapper">
	<article class="post-article" itemscope itemtype="http://schema.org/BlogPosting">

		<header class="post-header">
			<h1 class="post-title" itemprop="name headline">Operating System - Paging</h1>
			<p class="post-meta">Nov 22, 2016
				 • Notes
				 • pyliaorachel
			</p>
		</header>

		

		<span class="separator"> • • • </span>

		<div class="post-content" itemprop="articleBody">
			<h2>Content</h2>

<ol>
<li>Introduction to Virtual Memory</li>
<li>Paging MMU</li>
<li>Page Tables</li>
<li>Translation Lookaside Buffer (TLB)</li>
<li>Memory Protection</li>
</ol>

<!--more-->

<hr>

<h2>Introduction to Virtual Memory</h2>

<h4>Problems with Contiguous Memory</h4>

<ul>
<li>Growing program requires copying entire program</li>
<li>Wasted memory due to <strong>internal &amp; external fragmentation</strong></li>
<li>Running program requires loading entire program</li>
<li>Max program size limited by memory size</li>
</ul>

<h2>Paging MMU</h2>

<h4>Pages &amp; Frames</h4>

<ul>
<li><strong>Page</strong>: contiguous, fixed size chunks in virtual address space</li>
<li><strong>Frame</strong>: physical memory mapped from a page</li>
</ul>

<h4>Virtual &amp; Physical Addresses</h4>
<div class="highlight"><pre><code class="language-" data-lang=""># 32-bit machine, virtual address space 2^32 B
# page size 2^12, # of pages 2^20
|...20 bits...|.12 bits.|
    page num     offset

# e.g. physical address space 2^30 B
# frame size 2^12, # of frames 2^18
|...18 bits...|.12 bits.|
    page num     offset

               VA               PA
          -----------&gt;     -----------&gt;
Processor              MMU              Bus
          &lt;----------------------------
                       data
</code></pre></div>
<h4>Benefits of Paging</h4>

<ul>
<li>Growing program requires allocating a page at a time</li>
<li>No external fragmentation (page granularity); internal fragmentation 1/2 page per region</li>
<li>Pages can be loaded in memory as program runs</li>
<li>Max program size limited by disk size</li>
</ul>

<h2>Page Tables</h2>

<p>Mapping information maintained by MMU.</p>

<h4>Page Table Entries (PTE)</h4>
<div class="highlight"><pre><code class="language-" data-lang="">|...18 bits...|.7 bits.|C|D|R|W|V|
   frame num    unused
</code></pre></div>
<h4>Storing Page Table</h4>

<ul>
<li>Stored in memory

<ul>
<li>Each memory access requires 2 memory accesses: PTE &amp; PA</li>
<li>Solution: Cache PTE in TLB</li>
</ul></li>
<li><strong>Page table register (PTR)</strong>

<ul>
<li>For MMU to store the location of start of page table</li>
<li>OS associates a seperate page table for each process</li>
<li><strong>Address space switch</strong> switches PTR</li>
</ul></li>
</ul>

<h4>Page Table Size</h4>
<div class="highlight"><pre><code class="language-" data-lang="">#pages * PTE size (typically word size)
= (va_size / page_size) * PTE size
</code></pre></div>
<ul>
<li>Smaller page size: lower internal fragmentation</li>
<li>Larger page size: fewer PTE &amp; memory overhead</li>
</ul>

<h4>Multi-Level Page Table</h4>
<div class="highlight"><pre><code class="language-" data-lang="">|.10 bits.|.10 bits.|.12 bits.|
    PT1       PT2      offset
</code></pre></div>
<ul>
<li>Slower than <em>single-level page table</em> because more memory accesses</li>
<li>Saves space</li>
</ul>

<h4>Inverted Page Table</h4>

<p>Maps <strong>frame num -&gt; (thread id, page num)</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">|....|...52 bits...|.12 bits.|
 TID    page num     offset
  |         |
  -----------
       |
   hash func ----&gt; index into page table
</code></pre></div>
<ul>
<li>Exhaustive search is slow

<ul>
<li>Use hash table indexed by page number</li>
</ul></li>
<li>Hashing function needs to be good</li>
<li>Poor cache locality

<ul>
<li>Adjacent pages hashed to scattered locations</li>
</ul></li>
<li>Sharing memory is complecated</li>
</ul>

<h2>Translation Lookaside Buffer (TLB)</h2>

<ul>
<li>H/W cache of PTE

<ul>
<li>Small # of entries</li>
<li>Exploits locality (program uses small # of pages at a time)</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang="">|virtual page number (VPN)|...18 bits...|.7 bits.|C|D|R|W|V|
                             frame num    unused
|   key: page number      |             data: PTE          |

V: valid, W: writable, R: referenced (H/W), D: dirty (H/W), C: cacheable
</code></pre></div>
<p>V: is the entry valid or not?<br>
W: is the page writable?<br>
C: is the page cacheable? when not cacheable, processor should bypass the cache when accessing the page, e.g., to access memory-mapped device registers<br>
D: has a writable page been written to (is it dirty with respect to the data on disk)?<br>
R: has a page been referenced?<br>
unused: unused by hardware, can be used by OS  </p>

<p>H/W may or may not need execution bit, but instead use <em>read</em> as <em>execute</em>  </p>

<h4>TLB Operations</h4>

<h5>TLB Lookup</h5>

<p>Fully associative TLB example  </p>

<p><img src="http://www.cems.uwe.ac.uk/%7Ebr-gaster/courses/2015-2016/CNOS/lectures/reveal.js-jade/decks/cnos_lecture9/resources/tlb-lookup.png" alt="TLB lookup"></p>

<h5>TLB cache miss handling</h5>

<ul>
<li>TLB lookup fails -&gt; page table lookup -&gt; TLB cache replaced (<strong>TLB replacement policy</strong>)</li>
<li>Handled by H/W or OS

<ul>
<li>H/W managed TLB

<ul>
<li>H/W defines page table format &amp; replacement policy</li>
<li>PTR to locate page table in physical memory</li>
<li>Fast miss handling</li>
</ul></li>
<li>S/W managed TLB

<ul>
<li>H/W generates trap called <strong>TLB miss fault</strong>

<ul>
<li><strong>Read fault</strong></li>
<li><strong>Write fault</strong></li>
</ul></li>
<li>OS handles TLB miss similar to exception handling</li>
<li>OS figures out correct PTE, add in TLB (CPU has instructions to modify TLB)</li>
<li>Page tables become entirely a OS data structure (no PTR in H/W, H/W doesn&#39;t know about page table)</li>
<li>TLB replacement policy managed in S/W</li>
<li>Slower by more flexible miss handling</li>
</ul></li>
</ul></li>
</ul>

<h5>TLB cache invalidate</h5>

<ul>
<li>Adds cost to context switching

<ul>
<li>Changing PTR + invalidating TLB + TLB misses afterwards</li>
</ul></li>
<li>Invalidate options

<ul>
<li><strong>Clear TLB</strong>: clearing valid bit of all entries</li>
<li><strong>Tagged TLB</strong>: H/W maintains <strong>id tag</strong> on each entry

<ul>
<li>Compare current thread id (stored in register) to the tag</li>
<li>No invalidation; enables space multiplexing of entries</li>
</ul></li>
</ul></li>
</ul>

<h2>Memory Protection</h2>

<ul>
<li>Generate <strong>protection fault</strong> if memory access inconsistent with protection bits

<ul>
<li><strong>Read-only fault</strong></li>
<li><strong>No-execute fault</strong></li>
</ul></li>
</ul>

<h4>Related Resources</h4>

<ul>
<li><a href="https://www.quora.com/What-is-the-differences-between-a-page-table-and-an-inverted-page-table">What are the differences between a page table and an inverted page table?</a></li>
</ul>

		</div>

		<ul class="tag-list">
			

			<li class="tag">
				OS
			</li>

			

			<li class="tag">
				ECE344
			</li>

			

			<li class="tag">
				paging
			</li>

			
		</ul>

	</article>

	
		<div id="disqus_thread"></div>
<script>
	var disqus_config = function () {
	    this.page.url = "https://pyliaorachel.github.io";
	    this.page.identifier = "/blog/notes/os/2016/11/22/operating-system-paging.html";
	};
	(function() {
	    var d = document, s = d.createElement('script');
	    s.src = '//pyliaorachel.disqus.com/embed.js';
	    s.setAttribute('data-timestamp', +new Date());
	    (d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	
</div>
	</div>
</main>
		<footer>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-4 footer-link">
				<a href="mailto:rachel5566kk@gmail.com">
					<span class="icon icon-email">
						<img src="/assets/svg/email-logo.svg" alt="Email Logo">
					</span>
					<span class="username">rachel5566kk@gmail.com</span>
				</a>
			</div>
			<div class="col-md-4 footer-link">
				<a href="https://github.com/pyliaorachel"  target="_blank">
					<span class="icon icon-github">
						<img src="/assets/svg/github-logo.svg" alt="GitHub Logo">
					</span>
					<span class="username">pyliaorachel</span>
				</a>
			</div>
			<div class="col-md-4 footer-link">
				<a href="https://tw.linkedin.com/in/peiyu-liao" target="_blank">
					<span class="icon icon-linkedin">
						<img src="/assets/svg/linkedin-logo.svg" alt="LinkedIn Logo">
					</span>
					<span class="username">Peiyu Liao</span>
				</a>
			</div>
		</div><!-- /.row -->
		<div class="row">
			<div class="footer-copy-right">
				<p>2016	&copy; Liao Peiyu</p>
			</div >
		</div><!-- /.row -->
	</div><!-- /.container-fluid -->
</footer>
		<script type="text/javascript" src="/js/main.js"></script>
		<script type="text/javascript" src="/js/home.js"></script>
		<script id="dsq-count-scr" src="//pyliaorachel.disqus.com/count.js" async></script>
	</body>
</html>