<!DOCTYPE html>
<html>
	<head>
		<title>Operating System - Unix & Pthread</title>
		<link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
		<link rel="stylesheet" href="/css/main.css" type="text/css">
		<link href="https://fonts.googleapis.com/css?family=Antic+Slab|Catamaran|Hind:300|Inconsolata|Josefin+Sans|Muli:300,400i|Poiret+One|Rajdhani:300|Rock+Salt|Ruda|Scope+One|Shadows+Into+Light|Source+Code+Pro|Space+Mono" rel="stylesheet">
		<link rel="stylesheet" href="/css/github-markdown.css">

		<!-- Place jquery before bootstrap -->
		<script type="text/javascript" src="/js/jquery.min.js"></script>
		<script type="text/javascript" src="/js/bootstrap.min.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-default navbar-fixed-top">
	<div class="container-fluid">

		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">MyCoon</a>
		</div>

		<div class="collapse navbar-collapse" id="navbar-collapse">

			<form class="navbar-form navbar-left">
				<div class="form-group">
					<input type="text" class="form-control" placeholder="Search">
				</div>
				<button type="submit" class="btn btn-default">Submit</button>
			</form>

			<ul class="nav navbar-nav navbar-right" id="nav-links">
				<li class="nav-home"><a href="/">Home</a></li>
				<li class="dropdown nav-blog">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
						Blog<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><a href="/blog">MyCoon Blog</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="/blog/categories">Categories</a></li>
						
							
						

						
							
							
							<li class="category">
								<a href="/blog/notes">
									<span>Notes</span>
									<span>22</span>
								</a>
							</li>
						
							
							
							<li class="category">
								<a href="/blog/tech">
									<span>Tech</span>
									<span>1</span>
								</a>
							</li>
						
						<li><a href="/blog/tags">Tags</a></li>
					</ul>
				</li>
				<li class="dropdown nav-tutorial">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
						Tutorials<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><a href="/tutorial">MyCoon Tutorial</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="/tutorial/categories">Categories</a></li>
						
							
						

						
						<li><a href="/tutorial/tags">Tags</a></li>
					</ul>
				</li>
				<li  class="nav-project"><a href="/project">Projects</a></li>
				<li class="nav-special" id="special"><a href="#">?</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</div><!-- /.container-fluid -->
</nav>
		<main class="page-content post" aria-label="Content">
	<div class="post-wrapper">
		<div class="wrapper">
	<article class="post-article" itemscope itemtype="http://schema.org/BlogPosting">

		<header class="post-header">
			<h1 class="post-title" itemprop="name headline">Operating System - Unix & Pthread</h1>
			<p class="post-meta">Oct 23, 2016
				 • Notes
				 • pyliaorachel
			</p>
		</header>

		

		<span class="separator"> • • • </span>

		<div class="post-content" itemprop="articleBody">
			<h2>Content</h2>

<ol>
<li>Process-Related Unix System Calls</li>
<li>Posix Thread</li>
</ol>

<!--more-->

<hr>

<h2>Process-Related Unix System Calls</h2>

<ul>
<li>A <code>process</code> in Unix consistes of an <code>address space</code> &amp; a <code>thread</code></li>
<li>API

<ul>
<li><code>getpid()</code>, <code>getppid()</code>

<ul>
<li>Pid identifies <code>address space</code> &amp; <code>thread</code></li>
</ul></li>
<li><code>fork()</code>, <code>execv()</code>

<ul>
<li>Create <code>processes</code></li>
</ul></li>
<li><code>exit()</code>, <code>wait()</code>

<ul>
<li>Terminate <code>processes</code> &amp; synchronize with terminating <code>process</code></li>
</ul></li>
<li><code>kill()</code>, <code>sigaction()</code>

<ul>
<li>Communicate with another <code>process</code> via <code>signals</code></li>
</ul></li>
</ul></li>
<li><p><code>fork()</code></p>

<ul>
<li>Create <code>childe process</code> from <code>parent process</code> with an identical copy of:

<ul>
<li><code>Thread state</code></li>
<li><code>Address space</code></li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang="">int n = 5;
int pid = fork(); 
if (pid == 0) {
    // run child code
    n = n + 1;
} else { // pid value &gt; 0
    // run parent code
    n = n - 1;
}
</code></pre></div></li>
<li><p><code>execv()</code></p>

<ul>
<li>Replaces current <code>process</code> with a new <code>program</code>:

<ul>
<li>Loaded from disk</li>
<li><code>Code</code> &amp; <code>data</code> copied from disk</li>
<li><code>Stack</code> initialized with activation frame of <code>main()</code></li>
<li><code>Processor registers</code> reinitialized</li>
<li><code>Pid</code> stays the same</li>
<li>Doesn&#39;t return</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang="">char *cmd = "/bin/ls"; 
char *arg1 = "-l"; 
char *args[3];
args[1] = arg1; 
args[2] = NULL;
execv(cmd, args);
// code doesn’t execute
</code></pre></div>
<ul>
<li><code>fork()</code> + <code>execv()</code> can run a new program as a new process with the old one kept</li>
</ul></li>
<li><p><code>exit(retval)</code></p>

<ul>
<li>Terminate itself:

<ul>
<li><code>Address space</code> destroyed</li>
<li>Process-specific OS state destroyed (e.g. open files)</li>
<li><code>retval</code> saved &amp; return to <code>parent process</code>

<ul>
<li>For <code>parent process</code> to learn about <code>child process</code></li>
</ul></li>
<li><code>Thread state</code> destroyed</li>
</ul></li>
</ul></li>
<li><p><code>wait()</code></p>

<ul>
<li>Wait for <code>child process</code> to terminate; synchronize with <code>child processes</code></li>
<li>Returns <code>retval</code> returned from <code>exit()</code></li>
<li><p>4 cases:</p>

<ul>
<li><code>W</code> wait starts, <code>C</code> continue, <code>E</code> exit starts, <code>D</code> exit done</li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang=""># Semaphore required for 1, 2, 3

1.
         down(c)  up(p)
Parent ---&gt; W      C-----&gt;
                  / \
Child  --------&gt; E   D
              up(c) down(p)

2.

Parent --------&gt; WC-----&gt;
                 / \
Child  ------&gt; E  | D           # OS keeps child exit retval until wait() is issued by parent,
            (zombie process)    # or destroyed when parent exits

3.

Parent --------&gt; E
                / \
Child  -----&gt; E    D

4.

Parent ---&gt; E

Child  --------&gt; ED
</code></pre></div>
<ul>
<li>Each <code>child process</code> needs a pair of <code>semaphore</code></li>
</ul></li>
</ul></li>
<li><p><code>kill()</code></p>

<ul>
<li>Process send signals to itself or other <code>processes</code> by calling <code>kill</code> system call</li>
<li>Receiver executes <code>signal handler</code>; if not setup, forced to exit</li>
<li>Receiver process exits when scheduled to run next

<ul>
<li>Because if receiver is holding the lock, it must be released by itself instead of other threads</li>
</ul></li>
</ul></li>
<li><p><code>sigaction()</code></p>

<ul>
<li>Setup <code>signal handler</code> function</li>
</ul></li>
</ul>

<h2>Posix Thread</h2>

<ul>
<li>Allows creating additional threads in a <code>Unix process</code></li>
<li>API

<ul>
<li><code>pthread_create(thread, attr, start_routine, arg)</code></li>
<li><code>pthread_exit(status)</code>

<ul>
<li>Returns <code>status</code> to a joining thread</li>
</ul></li>
<li><code>pthread_join(thread_id, status)</code>

<ul>
<li>Block thread until thread with <code>thread_id</code> terminates</li>
</ul></li>
<li><code>pthread_yield()</code></li>
</ul></li>
<li><p>Synchronization API</p>

<ul>
<li><p><strong>Mutex</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">pthread_mutex_t mut = PTHREAD_MUTEX_INITIALIZER;
pthread_mutex_lock(&amp;mut);
pthread_mutex_unlock(&amp;mut)
</code></pre></div></li>
<li><p><strong>Monitor</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">int x,y;
pthread_mutex_t mut = PTHREAD_MUTEX_INITIALIZER; 
pthread_cond_t cond = PTHREAD_COND_INITIALIZER;

pthread_mutex_lock(&amp;mut); 
while (x &lt;= y) {
    pthread_cond_wait(&amp;cond, &amp;mut); 
}
/* operate on x and y */ 
pthread_mutex_unlock(&amp;mut);
</code></pre></div><div class="highlight"><pre><code class="language-" data-lang="">pthread_mutex_lock(&amp;mut);
/* modify x and y */
if (x &gt; y) 
    pthread_cond_signal(&amp;cond); 
pthread_mutex_unlock(&amp;mut);
</code></pre></div></li>
<li><p><strong>Semaphores</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">sem_t sem name;
sem_init(&amp;sem_name, 0, 0); // (_, flag, init value)
sem_wait(&amp;sem_name);
sem_post(&amp;sem);
</code></pre></div></li>
</ul></li>
</ul>

<h2>Related Articles</h2>

<ul>
<li><a href="http://www.cs.rutgers.edu/%7Epxk/416/notes/04-processes.html">Processes - Process Creation and States.</a></li>
</ul>

		</div>

		<ul class="tag-list">
			

			<li class="tag">
				OS
			</li>

			

			<li class="tag">
				ECE344
			</li>

			

			<li class="tag">
				unix
			</li>

			

			<li class="tag">
				pthread
			</li>

			
		</ul>

	</article>

	
		<div id="disqus_thread"></div>
<script>
	var disqus_config = function () {
	    this.page.url = "https://pyliaorachel.github.io";
	    this.page.identifier = "/blog/notes/os/2016/10/23/operating-system-unix-and-pthread.html";
	};
	(function() {
	    var d = document, s = d.createElement('script');
	    s.src = '//pyliaorachel.disqus.com/embed.js';
	    s.setAttribute('data-timestamp', +new Date());
	    (d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	
</div>
	</div>
</main>
		<footer>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-4 footer-link">
				<a href="mailto:rachel5566kk@gmail.com">
					<span class="icon icon-email">
						<img src="/assets/svg/email-logo.svg" alt="Email Logo">
					</span>
					<span class="username">rachel5566kk@gmail.com</span>
				</a>
			</div>
			<div class="col-md-4 footer-link">
				<a href="https://github.com/pyliaorachel"  target="_blank">
					<span class="icon icon-github">
						<img src="/assets/svg/github-logo.svg" alt="GitHub Logo">
					</span>
					<span class="username">pyliaorachel</span>
				</a>
			</div>
			<div class="col-md-4 footer-link">
				<a href="https://tw.linkedin.com/in/peiyu-liao" target="_blank">
					<span class="icon icon-linkedin">
						<img src="/assets/svg/linkedin-logo.svg" alt="LinkedIn Logo">
					</span>
					<span class="username">Peiyu Liao</span>
				</a>
			</div>
		</div><!-- /.row -->
		<div class="row">
			<div class="footer-copy-right">
				<p>2016	&copy; Liao Peiyu</p>
			</div >
		</div><!-- /.row -->
	</div><!-- /.container-fluid -->
</footer>
		<script type="text/javascript" src="/js/main.js"></script>
		<script type="text/javascript" src="/js/home.js"></script>
		<script id="dsq-count-scr" src="//pyliaorachel.disqus.com/count.js" async></script>
	</body>
</html>