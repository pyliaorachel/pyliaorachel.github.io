<!DOCTYPE html>
<html>
	<head>
		<title>Memory Optimization</title>
		<link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css">
		<link rel="stylesheet" href="/css/main.css" type="text/css">
		<link href="https://fonts.googleapis.com/css?family=Antic+Slab|Catamaran|Hind:300|Inconsolata|Josefin+Sans|Muli:300,400i|Poiret+One|Rajdhani:300|Rock+Salt|Ruda|Scope+One|Shadows+Into+Light|Source+Code+Pro|Space+Mono" rel="stylesheet">
		<link rel="stylesheet" href="/css/github-markdown.css">

		<!-- Place jquery before bootstrap -->
		<script type="text/javascript" src="/js/jquery.min.js"></script>
		<script type="text/javascript" src="/js/bootstrap.min.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-default navbar-fixed-top">
	<div class="container-fluid">

		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="/">MyCoon</a>
		</div>

		<div class="collapse navbar-collapse" id="navbar-collapse">

			<form class="navbar-form navbar-left">
				<div class="form-group">
					<input type="text" class="form-control" placeholder="Search">
				</div>
				<button type="submit" class="btn btn-default">Submit</button>
			</form>

			<ul class="nav navbar-nav navbar-right" id="nav-links">
				<li class="nav-home"><a href="/">Home</a></li>
				<li class="dropdown nav-blog">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
						Blog<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><a href="/blog">MyCoon Blog</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="/blog/categories">Categories</a></li>
						
							
						

						
							
							
							<li class="category">
								<a href="/blog/notes">
									<span>Notes</span>
									<span>16</span>
								</a>
							</li>
						
							
							
							<li class="category">
								<a href="/blog/tech">
									<span>Tech</span>
									<span>1</span>
								</a>
							</li>
						
						<li><a href="/blog/tags">Tags</a></li>
					</ul>
				</li>
				<li class="dropdown nav-tutorial">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
						Tutorials<span class="caret"></span>
					</a>
					<ul class="dropdown-menu">
						<li><a href="/tutorial">MyCoon Tutorial</a></li>
						<li role="separator" class="divider"></li>
						<li><a href="/tutorial/categories">Categories</a></li>
						
							
						

						
						<li><a href="/tutorial/tags">Tags</a></li>
					</ul>
				</li>
				<li  class="nav-project"><a href="/project">Projects</a></li>
				<li class="nav-special" id="special"><a href="#">?</a></li>
			</ul>
		</div><!-- /.navbar-collapse -->
	</div><!-- /.container-fluid -->
</nav>
		<main class="page-content post" aria-label="Content">
	<div class="post-wrapper">
		<div class="wrapper">
	<article class="post-article" itemscope itemtype="http://schema.org/BlogPosting">

		<header class="post-header">
			<h1 class="post-title" itemprop="name headline">Memory Optimization</h1>
			<p class="post-meta">Oct 30, 2016
				 • Notes
				 • pyliaorachel
			</p>
		</header>

		

		<span class="separator"> • • • </span>

		<div class="post-content" itemprop="articleBody">
			<h2>Content</h2>

<ol>
<li>Data Representation &amp; Alignment</li>
<li>Cache Performance

<ol>
<li>Cache Organization</li>
<li>Cache Performance Metrics</li>
<li>Code Scheduling</li>
<li>Blocking/Tiling</li>
<li>The Memory Moutain</li>
</ol></li>
<li>Virtual Memory

<ol>
<li>Virtual Memory Access</li>
<li>Page Table &amp; TLB</li>
</ol></li>
<li>Prefetching

<ol>
<li>H/W Prefetching</li>
<li>S/W Prefetching</li>
</ol></li>
<li>Machine-Dependent Optimizations

<ol>
<li>Pointer Code</li>
<li>Instruction-Level Parallelism</li>
<li>Parallel Loop Unrolling</li>
</ol></li>
</ol>

<!--more-->

<hr>

<h2>Data Representation &amp; Alignment</h2>

<ul>
<li>Primitive data type requires K bytes -&gt; address must be multiple of K</li>
<li>Structures align with the <em>largest alignment requirement of any element</em></li>
</ul>

<h2>Cache Performance</h2>

<ul>
<li>Keep working set small (temporal locality)</li>
<li>Use small strides (spacial locality)</li>
</ul>

<h3>Cache Organization</h3>
<div class="highlight"><pre><code class="language-" data-lang="">address: | tag | index | offset |
cache block: | v | tag | data |
S - 2^s sets
E - 2^e blocks/lines per set
B - 2^b bytes per cache block

Cach size = S * E * B bytes
</code></pre></div>
<h3>Cache Performance Metrics</h3>

<ul>
<li>Miss rate</li>
<li>Hit time

<ul>
<li>isLineInCache? + deliver block to CPU (+virtual memory translation)</li>
</ul></li>
<li>Miss penalty</li>
</ul>

<h3>Code Scheduling</h3>

<ul>
<li>Factors

<ul>
<li>Reordering of loops</li>
<li># of read/write operations</li>
</ul></li>
</ul>

<h3>Blocking/Tiling</h3>

<ul>
<li>Traverse array in blocks</li>
<li>Imporves <strong>temporal locality</strong></li>
</ul>

<h3>The Memory Moutain</h3>

<ul>
<li>Measure <strong>read throughput</strong> as a function of <strong>spatial &amp; temporal locality</strong></li>
</ul>

<p><img src="http://cfile22.uf.tistory.com/image/112730164AC0AFAB36962C" alt="Memory Mountain"></p>

<h2>Virtual Memory</h2>

<ul>
<li>Why virtual memory?

<ul>
<li>Capacity/Portability</li>
<li>Security</li>
<li>Sharing</li>
</ul></li>
</ul>

<h3>Virtual Memory Access</h3>

<ul>
<li>Type of cache misses

<ul>
<li>Cold/compulsory miss</li>
<li>Conflict miss

<ul>
<li>Avoided by <em>set-associative caches</em></li>
</ul></li>
<li>Capacity miss *

<ul>
<li>Keep working set within on-chip cache capacity</li>
</ul></li>
</ul></li>
<li>Write

<ul>
<li>Write-back (on write-hit)</li>
<li>Write-allocate (on write-miss)</li>
<li>Write-through</li>
</ul></li>
</ul>

<h3>Page Table &amp; TLB</h3>

<ul>
<li>MMU keep mapping of VA to PA in <strong>page table</strong>

<ul>
<li>Page table kept in main memory, can be cached</li>
</ul></li>
<li><strong>Translation lookaside buffer (TLB)</strong>: cache for page table

<ul>
<li>TLB hit: <code>CPU -&gt; MMU -&gt; TLB -&gt; MMU -&gt; Mem</code></li>
<li>TLB miss: <code>CPU -&gt; MMU -&gt; TLB -&gt; Mem -&gt; TLB -&gt; MMU -&gt; Mem</code></li>
<li>TLB reach: <code>(# TLB entries) * (page size)</code></li>
</ul></li>
<li><strong>Working set</strong> : a set of active virtual pages

<ul>
<li>Page miss: <code>(working set size) &gt; (main mem size)</code> -&gt; <strong>thrashing</strong></li>
<li>TLB miss: <code>(# working set pages) &gt; (# TLB entries)</code></li>
</ul></li>
</ul>

<h2>Prefetching</h2>

<ul>
<li>Bring into cache elements expected to be accessed in future</li>
<li>Effective is:

<ul>
<li>Spare memory bandwidth</li>
<li>Accurate</li>
<li>Timely</li>
<li>Doesn&#39;t displace other in-use data</li>
<li>Latency hidden by prefetched outweighs their cost</li>
</ul></li>
</ul>

<h3>H/W Prefetching</h3>

<ul>
<li>Prefetch adjacent block</li>
<li>Recognize a <em>stream</em>: addresses separated by a <em>stride</em></li>
<li>Prefetch within a page boundary</li>
</ul>

<h3>S/W Prefetching</h3>

<ul>
<li>Insert special <code>prefetch</code> instructions into code

<ul>
<li>Patterns that H/W wouldn&#39;t recognize e.g. linked list</li>
</ul></li>
</ul>

<h2>Machine-Dependent Optimizations</h2>

<h3>Pointer Code</h3>

<ul>
<li>Not necessarily better than array code; some compilers do better job optimizing array code</li>
</ul>

<h3>Instruction-Level Parallelism</h3>

<ul>
<li>Limiting factor

<ul>
<li>Latency of instructions</li>
<li># of functional units available

<ul>
<li>1 load</li>
<li>1 store</li>
<li>2 int (1 may be branch)</li>
<li>1 FP add</li>
<li>1 FP mul/div</li>
</ul></li>
</ul></li>
</ul>

<h3>Parallel Loop Unrolling</h3>

<ol>
<li>Accumulate in 2 different products, combine at end

<ul>
<li><code>(1 * x2 * ... * xn) * (1 * x1 * ... * x_n-1)</code></li>
</ul></li>
<li>Dual product 

<ul>
<li><code>(1 * x1) * (x2 * x3) * ... * (x_n-1 * xn)</code></li>
</ul></li>
</ol>

<ul>
<li>Limitations

<ul>
<li>Need lots of registers to hold sums/products</li>
</ul></li>
</ul>

		</div>

		<ul class="tag-list">
			

			<li class="tag">
				Optimization
			</li>

			

			<li class="tag">
				ECE454
			</li>

			
		</ul>

	</article>

	
		<div id="disqus_thread"></div>
<script>
	var disqus_config = function () {
	    this.page.url = "https://pyliaorachel.github.io";
	    this.page.identifier = "/blog/notes/optimization/2016/10/30/memory-optimization.html";
	};
	(function() {
	    var d = document, s = d.createElement('script');
	    s.src = '//pyliaorachel.disqus.com/embed.js';
	    s.setAttribute('data-timestamp', +new Date());
	    (d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	
</div>
	</div>
</main>
		<footer>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-4 footer-link">
				<a href="mailto:rachel5566kk@gmail.com">
					<span class="icon icon-email">
						<img src="/assets/svg/email-logo.svg" alt="Email Logo">
					</span>
					<span class="username">rachel5566kk@gmail.com</span>
				</a>
			</div>
			<div class="col-md-4 footer-link">
				<a href="https://github.com/pyliaorachel"  target="_blank">
					<span class="icon icon-github">
						<img src="/assets/svg/github-logo.svg" alt="GitHub Logo">
					</span>
					<span class="username">pyliaorachel</span>
				</a>
			</div>
			<div class="col-md-4 footer-link">
				<a href="https://tw.linkedin.com/in/peiyu-liao" target="_blank">
					<span class="icon icon-linkedin">
						<img src="/assets/svg/linkedin-logo.svg" alt="LinkedIn Logo">
					</span>
					<span class="username">Peiyu Liao</span>
				</a>
			</div>
		</div><!-- /.row -->
		<div class="row">
			<div class="footer-copy-right">
				<p>2016	&copy; Liao Peiyu</p>
			</div >
		</div><!-- /.row -->
	</div><!-- /.container-fluid -->
</footer>
		<script type="text/javascript" src="/js/main.js"></script>
		<script type="text/javascript" src="/js/home.js"></script>
		<script id="dsq-count-scr" src="//pyliaorachel.disqus.com/count.js" async></script>
	</body>
</html>